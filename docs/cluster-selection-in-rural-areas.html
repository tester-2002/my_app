<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Cluster selection in Rural areas | NMHS_APP</title>
  <meta name="description" content="Documentation for the NMHS_APP project" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Cluster selection in Rural areas | NMHS_APP" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentation for the NMHS_APP project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cluster selection in Rural areas | NMHS_APP" />
  
  <meta name="twitter:description" content="Documentation for the NMHS_APP project" />
  

<meta name="author" content="Deepan P" />


<meta name="date" content="2024-09-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="cluster-selection-in-urban-areas.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>Introduction</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Rural areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#basic-idea"><i class="fa fa-check"></i>Basic Idea</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#file-structure"><i class="fa fa-check"></i>File structure</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#program-flow-chart"><i class="fa fa-check"></i>Program Flow chart</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-data-collection-and-consolidation-first-pass"><i class="fa fa-check"></i><strong>PHASE 1: Data Collection and Consolidation</strong> <br>(First Pass)</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-output"><i class="fa fa-check"></i>Phase 1 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-proportional-analysis-and-sampling-preparation"><i class="fa fa-check"></i><strong>PHASE 2: Proportional Analysis and Sampling Preparation</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-1"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-1"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-output"><i class="fa fa-check"></i>Phase 2 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-3-systematic-sampling-and-results-generation-second-pass"><i class="fa fa-check"></i><strong>PHASE 3: Systematic Sampling and Results Generation (Second Pass)</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-2"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-2"><i class="fa fa-check"></i>Detailed Procedures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Urban areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#program-flow-chart-1"><i class="fa fa-check"></i>Program Flow chart</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#import-libraries-and-utility-functions"><i class="fa fa-check"></i>Import Libraries and Utility Functions</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#data-download-and-initial-processing"><i class="fa fa-check"></i>Data Download and Initial Processing</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#district-selection-and-filtering"><i class="fa fa-check"></i>District Selection and Filtering</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#exclusion-logic"><i class="fa fa-check"></i>Exclusion Logic</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#why-exclusion-was-done"><i class="fa fa-check"></i>Why Exclusion was done?</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#will-this-exclusion-process-be-avoided-in-some-cases"><i class="fa fa-check"></i>Will this exclusion process be avoided in some cases?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#cluster-calculation-and-proportional-allocation"><i class="fa fa-check"></i>Cluster Calculation and Proportional Allocation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#utility-functions-for-report-generation"><i class="fa fa-check"></i>Utility Functions for Report Generation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#result-summary-and-sampling-preparation"><i class="fa fa-check"></i>Result Summary and Sampling Preparation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#random-cluster-sampling-implementation"><i class="fa fa-check"></i>Random Cluster Sampling Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#two-stage-sampling-process"><i class="fa fa-check"></i>Two-Stage Sampling Process</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#procedure-for-sampling-iv-units"><i class="fa fa-check"></i>Procedure for Sampling IV Units</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#frequency-of-iv-unit-selection-and-block-sampling"><i class="fa fa-check"></i>Frequency of IV Unit Selection and Block Sampling</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#importance-of-exclusion-and-combined-sampling-strategy"><i class="fa fa-check"></i>Importance of Exclusion and Combined Sampling Strategy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#geographic-coordinate-assignment-geocoding"><i class="fa fa-check"></i>Geographic Coordinate Assignment (Geocoding)</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#output-generation-and-final-documentation"><i class="fa fa-check"></i>Output Generation and Final Documentation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>NMHS_APP</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cluster-selection-in-rural-areas" class="section level1 hasAnchor">
<h1><strong>Cluster selection in Rural areas</strong><a href="cluster-selection-in-rural-areas.html#cluster-selection-in-rural-areas" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section discusses the implementation of the app for cluster selection in rural areas.</p>
<div id="basic-idea" class="section level3 hasAnchor">
<h3>Basic Idea<a href="cluster-selection-in-rural-areas.html#basic-idea" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div style="text-align: center;">
<iframe src="PPS_Steps.pdf" width="80%" height="400px">
</iframe>
</div>
</div>
<div id="file-structure" class="section level3 hasAnchor">
<h3>File structure<a href="cluster-selection-in-rural-areas.html#file-structure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="tree">

State xyz /
├── <span class="highlight">Cluster Allocation.xlsm</span>
├── District a /
│   ├── <span class="highlight">PPS.xlsm</span>
│   ├── Block 1 data.xls
│   ├── Block 2 data.xls
│   ├── Block 3 data.xls
│   ├── :
│   └── :
├── District b /
├── District c /
├── :
└── :

</div>
<p><code style="color:red;">Cluster Allocation.xlsm</code> is present in all the state folders, and <code style="color:red;">PPS.xlsm</code> is present in all the district folders under each state. <code style="color:red;">Block 1 data.xls</code> contains the list of Gram Panchayats as shown in below.</p>
<div class="image-container" style="text-align: center">
  <img src="block_image.png"  alt="Block Image" style="width:50%">
</div>
<p><br><br></p>
</div>
<div id="functions" class="section level3 hasAnchor">
<h3>Functions<a href="cluster-selection-in-rural-areas.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="tree">

Cluster ALLocation.xlsm
├── Module1
│   ├── <span class="highlight">func ALLinALL()</span>
│   └── func FilterByColor(PPSWorkbook As Workbook)
└── Module2
    └── <span class="highlight">func CalculateProportions()</span>

PPS.xlsm
├── Module1
│   └── func CopySheetsFromAllWorkbooks()
├── Module2
│   └── <span class="highlight">func TableCooker()</span>
├── Module3
│   └── func CumulativeSumWithFormula()
├── Module4
│   └── <span class="highlight">func RandomSelector()</span>
└── Module5
    └── func LoadTotal()
</div>

<span class="highlight">*</span> highlighted functions are the main tasks where the other functions are subtasks
</div>
<div id="program-flow-chart" class="section level3 hasAnchor">
<h3>Program Flow chart<a href="cluster-selection-in-rural-areas.html#program-flow-chart" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="cluster-selection-in-rural-areas.html#cb1-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;flow-chart2.svg&quot;</span>)</span></code></pre></div>
</details>
<p><img src="flow-chart2.svg" width="40%" style="display: block; margin: auto;" /></p>
</div>
<div id="overview" class="section level2 hasAnchor">
<h2>Overview<a href="cluster-selection-in-rural-areas.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The ALLinALL macro implements a sophisticated three-phase data processing and sampling system designed for multi-directory statistical analysis. The system processes Excel files across multiple folders, consolidates data, calculates proportional distributions, and performs systematic sampling with multiple iterations.</p>
<hr />
</div>
<div id="phase-1-data-collection-and-consolidation-first-pass" class="section level2 hasAnchor">
<h2><strong>PHASE 1: Data Collection and Consolidation</strong> <br>(First Pass)<a href="cluster-selection-in-rural-areas.html#phase-1-data-collection-and-consolidation-first-pass" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="purpose" class="section level3 hasAnchor">
<h3>Purpose<a href="cluster-selection-in-rural-areas.html#purpose" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This phase discovers and processes data files across directory structures, creating a unified dataset for sampling procedure.</p>
</div>
<div id="detailed-procedures" class="section level3 hasAnchor">
<h3>Detailed Procedures<a href="cluster-selection-in-rural-areas.html#detailed-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="directory-scanning-and-setup" class="section level4 hasAnchor">
<h4>1.1 Directory Scanning and Setup<a href="cluster-selection-in-rural-areas.html#directory-scanning-and-setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>currentDirectory = ThisWorkbook.Path
dirName = Mid(currentDirectory, InStrRev(currentDirectory, &quot;\&quot;) + 1)</code></pre>
<ul>
<li><p><strong>Function</strong>: Identifies the current working directory and extracts just the directory name</p></li>
<li><p><strong>Output</strong>: Creates a base reference for grouping data by location</p></li>
<li><p><strong>Data Flow</strong>: Directory name goes to Column A of the main worksheet</p>
<p><img src="images/clipboard-2032140449.png" /></p></li>
</ul>
</div>
<div id="folder-iteration-and-file-discovery" class="section level4 hasAnchor">
<h4>1.2 Folder Iteration and File Discovery<a href="cluster-selection-in-rural-areas.html#folder-iteration-and-file-discovery" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>For Each folder In fileSystem.GetFolder(currentDirectory).SubFolders
    PPSPath = folder.Path &amp; &quot;\&quot; &amp; PPSFile</code></pre>
<ul>
<li><strong>Function</strong>: Systematically searches each subfolder for PPS.xlsm files</li>
<li><strong>Logic</strong>: Uses FileSystemObject for robust file system navigation</li>
<li><strong>Error Handling</strong>: Checks file existence with <code>Dir(PPSPath) &lt;&gt; ""</code></li>
<li><strong>Data Flow</strong>: Folder names populate Column B of main worksheet</li>
</ul>
<p>::: {align=“center”} <img src="images/clipboard-3770752320.png" /> :::</p>
</div>
<div id="tablecooker-execution-core-data-processing" class="section level4 hasAnchor">
<h4>1.3 TableCooker Execution (Core Data Processing)<a href="cluster-selection-in-rural-areas.html#tablecooker-execution-core-data-processing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When a PPS.xlsm file is found, the system executes the `<code>TableCooker</code>` macro:</p>
<div id="sub-process-copysheetsfromallworkbooks" class="section level5 hasAnchor">
<h5>Sub-Process: CopySheetsFromAllWorkbooks<a href="cluster-selection-in-rural-areas.html#sub-process-copysheetsfromallworkbooks" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>fileName = Dir(folderPath &amp; &quot;*.xls&quot;)
Do While fileName &lt;&gt; &quot;&quot;
    For Each ws In sourceWorkbook.Sheets
        ws.Copy After:=currentWorkbook.Sheets(currentWorkbook.Sheets.Count)</code></pre>
<ul>
<li><p><strong>Function</strong>: Discovers and imports all Excel files (.xls) within each folder</p>
<p><img src="images/clipboard-1280808281.png" /></p></li>
<li><p><strong>Logic</strong>: Creates a comprehensive dataset by merging multiple source files <br><br></p>
<div align="center">
<table>
<thead>
<tr class="header">
<th align="right">Sr. No.</th>
<th>Gram Panchayat</th>
<th align="right">TOTAL</th>
<th align="center">C.P</th>
<th align="center">Selection</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td>BIRSIEJ</td>
<td align="right">750</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="right">2</td>
<td>I.C.A.R.</td>
<td align="right">836</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td>INGSAW</td>
<td align="right">1184</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="right">4</td>
<td>ITPATUNG</td>
<td align="right">131</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td>ITSOHPAIR</td>
<td align="right">710</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<p><br><br></p></li>
<li><p><strong>Exclusion Rule</strong>: Skips the current workbook to avoid circular references</p></li>
</ul>
</div>
<div id="sub-process-data-standardization" class="section level5 hasAnchor">
<h5>Sub-Process: Data Standardization<a href="cluster-selection-in-rural-areas.html#sub-process-data-standardization" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>ws.Rows(&quot;1:6&quot;).Delete        &#39; Remove headers
ws.Rows(lastRow - 1 &amp; &quot;:&quot; &amp; lastRow).Delete  &#39; Remove footers</code></pre>
<ul>
<li><strong>Function</strong>: Standardizes data structure across different source files</li>
<li><strong>Rationale</strong>: Removes inconsistent header/footer rows that vary between files</li>
<li><strong>Result</strong>: Clean, uniform data ready for statistical processing</li>
</ul>
</div>
<div id="sub-process-data-consolidation" class="section level5 hasAnchor">
<h5>Sub-Process: Data Consolidation<a href="cluster-selection-in-rural-areas.html#sub-process-data-consolidation" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>usedRange.Copy
combinedSheet.Cells(lastTargetRow, 1).PasteSpecial Paste:=xlPasteValues</code></pre>
<ul>
<li><p><strong>Function</strong>: Merges all processed sheets into a single “CombinedData” sheet</p></li>
<li><p><strong>Method</strong>: Sequential appending maintains data integrity</p></li>
<li><p><strong>Memory Management</strong>: Uses PasteSpecial with values only to optimize performance</p>
<div align="center">
<p><img src="images/clipboard-2452756471.png" /></p>
</div></li>
</ul>
</div>
</div>
<div id="statistical-preprocessing" class="section level4 hasAnchor">
<h4>1.4 Statistical Preprocessing<a href="cluster-selection-in-rural-areas.html#statistical-preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="cumulative-sum-calculation" class="section level5 hasAnchor">
<h5>Cumulative Sum Calculation<a href="cluster-selection-in-rural-areas.html#cumulative-sum-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>Range(&quot;G2&quot;).Value = Range(&quot;F2&quot;).Value
.Range(&quot;G3&quot;, &quot;G&quot; &amp; ws.Rows.Count).Formula = &quot;=&quot; &amp; .Cells(3, &quot;F&quot;).Address &amp; &quot;+&quot; &amp; .Cells(2, &quot;G&quot;).Address</code></pre>
<ul>
<li><p><strong>Function</strong>: Creates running totals essential for systematic sampling</p>
<p><img src="images/clipboard-4087807194.png" /></p></li>
</ul>
</div>
<div id="total-extraction" class="section level5 hasAnchor">
<h5>Total Extraction<a href="cluster-selection-in-rural-areas.html#total-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>total = ws.Cells(lastRow, &quot;G&quot;).Value
ws.Range(&quot;O1&quot;).Value = total</code></pre>
<ul>
<li><p><strong>Function</strong>: Captures the final cumulative total for each dataset</p></li>
<li><p><strong>Storage</strong>: Places total in cell O1 for cross-reference</p>
<p><img src="images/clipboard-2952816995.png" /></p></li>
<li><p><strong>Data Flow</strong>: This total becomes the basis for proportional calculations</p>
<p><img src="images/clipboard-2536831973.png" /></p></li>
</ul>
</div>
</div>
</div>
<div id="phase-1-output" class="section level3 hasAnchor">
<h3>Phase 1 Output<a href="cluster-selection-in-rural-areas.html#phase-1-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Column A</strong>: Directory name (grouping variable)</li>
<li><strong>Column B</strong>: Folder name (district identifier)</li>
<li><strong>Column C</strong>: Total values from each folder’s processed data</li>
<li><strong>Result</strong>: Master inventory of all available data sources with their statistical weights</li>
</ul>
<hr />
</div>
</div>
<div id="phase-2-proportional-analysis-and-sampling-preparation" class="section level2 hasAnchor">
<h2><strong>PHASE 2: Proportional Analysis and Sampling Preparation</strong><a href="cluster-selection-in-rural-areas.html#phase-2-proportional-analysis-and-sampling-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="purpose-1" class="section level3 hasAnchor">
<h3>Purpose<a href="cluster-selection-in-rural-areas.html#purpose-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Calculates proportional distributions and determines sampling allocations based on collected data.</p>
</div>
<div id="detailed-procedures-1" class="section level3 hasAnchor">
<h3>Detailed Procedures<a href="cluster-selection-in-rural-areas.html#detailed-procedures-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="user-input-integration---total-clusters-requested" class="section level4 hasAnchor">
<h4>2.1 User Input Integration - total clusters requested<a href="cluster-selection-in-rural-areas.html#user-input-integration---total-clusters-requested" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>userValue = Application.InputBox(&quot;Enter Total No. of clusters:&quot;, Type:=1)</code></pre>
<ul>
<li><strong>Integration</strong>: Multiplies proportions to determine actual number of clusters for each district</li>
</ul>
</div>
<div id="calculateproportions-function" class="section level4 hasAnchor">
<h4>2.2 CalculateProportions Function<a href="cluster-selection-in-rural-areas.html#calculateproportions-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="proportion-calculation" class="section level5 hasAnchor">
<h5>Proportion Calculation<a href="cluster-selection-in-rural-areas.html#proportion-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>ws.Cells(j, &quot;D&quot;).Value = ws.Cells(j, &quot;C&quot;).Value / sumC
ws.Cells(j, &quot;E&quot;).Value = ws.Cells(j, &quot;D&quot;).Value * userValue</code></pre>
<ul>
<li><p><strong>Column D</strong>: Relative proportion (folder total ÷ directory total)</p></li>
<li><p><strong>Column E</strong>: Absolute allocation (proportion × total clusters requested)</p></li>
<li><p><strong>Column F</strong>: Rounded off values of <code>Column E</code></p>
<p><img src="images/clipboard-3418985296.png" /></p></li>
</ul>
</div>
</div>
</div>
<div id="phase-2-output" class="section level3 hasAnchor">
<h3>Phase 2 Output<a href="cluster-selection-in-rural-areas.html#phase-2-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Column D</strong>: Proportional weights (0-1 scale)</li>
<li><strong>Column E</strong>: Actual cluster counts for sampling</li>
<li><strong>Purpose</strong>: Provides sampling parameters for Phase 3 execution</li>
</ul>
<hr />
</div>
</div>
<div id="phase-3-systematic-sampling-and-results-generation-second-pass" class="section level2 hasAnchor">
<h2><strong>PHASE 3: Systematic Sampling and Results Generation (Second Pass)</strong><a href="cluster-selection-in-rural-areas.html#phase-3-systematic-sampling-and-results-generation-second-pass" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="purpose-2" class="section level3 hasAnchor">
<h3>Purpose<a href="cluster-selection-in-rural-areas.html#purpose-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Executes multiple iterations of systematic sampling across all data sources and generates comprehensive results.</p>
</div>
<div id="detailed-procedures-2" class="section level3 hasAnchor">
<h3>Detailed Procedures<a href="cluster-selection-in-rural-areas.html#detailed-procedures-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="sampling-preparation" class="section level4 hasAnchor">
<h4>3.1 Sampling Preparation<a href="cluster-selection-in-rural-areas.html#sampling-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>Set PPSWorkbook = Workbooks.Open(PPSPath)
valueForMacro = ws.Cells(rowCounter, 5).Value
PPSWorkbook.Sheets(1).Range(&quot;O2&quot;).Value = valueForMacro</code></pre>
<ul>
<li><p><strong>Function</strong>: Reopens each PPS file for sampling</p></li>
<li><p><strong>Parameter Passing</strong>: Transfers calculated sample sizes (Column E) to O2</p></li>
<li><p><strong>Setup</strong>: Prepares the sampling environment with correct parameters</p>
<p><img src="images/clipboard-2513570385.png" /></p></li>
</ul>
</div>
<div id="results-sheet-creation" class="section level4 hasAnchor">
<h4>3.2 Results Sheet Creation<a href="cluster-selection-in-rural-areas.html#results-sheet-creation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>Set wsNew = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
wsNew.Name = folderName</code></pre>
<ul>
<li><p><strong>Function</strong>: Creates dedicated output sheets for each folder</p></li>
<li><p><strong>Organization</strong>: Maintains clear separation of results by data source</p></li>
<li><p><strong>Naming</strong>: Uses folder names for easy identification</p>
<div align="center">
<p><img src="images/clipboard-364020066.png" /> <img src="images/clipboard-4189892156.png" /></p>
</div></li>
</ul>
</div>
<div id="randomselector-algorithm-core-sampling-engine" class="section level4 hasAnchor">
<h4>3.3 RandomSelector Algorithm (Core Sampling Engine)<a href="cluster-selection-in-rural-areas.html#randomselector-algorithm-core-sampling-engine" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="initialization-and-cleanup" class="section level5 hasAnchor">
<h5>Initialization and Cleanup<a href="cluster-selection-in-rural-areas.html#initialization-and-cleanup" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>ws.Columns(&quot;B:B&quot;).Interior.Color = xlNone
Range(&quot;O5:O20&quot;).Delete Shift:=xlUp
userInput = ws.Range(&quot;O2&quot;).Value</code></pre>
<ul>
<li><strong>Reset</strong>: Clears previous color coding and random values</li>
<li><strong>Parameter Loading</strong>: Gets sample size from Phase 2 calculations</li>
<li><strong>Preparation</strong>: Sets up clean environment for new sampling iteration</li>
</ul>
</div>
<div id="sampling-interval-calculation" class="section level5 hasAnchor">
<h5>Sampling Interval Calculation<a href="cluster-selection-in-rural-areas.html#sampling-interval-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>total = ws.Cells(lastRow, &quot;G&quot;).Value
ws.Range(&quot;O3&quot;).Value = total / userInput
O1Value = ws.Range(&quot;O3&quot;).Value</code></pre>
<ul>
<li><p><strong>Function</strong>: Calculates systematic sampling interval</p></li>
<li><p><strong>Formula</strong>: Total population ÷ desired sample size</p>
<p><img src="images/clipboard-667135730.png" /></p></li>
</ul>
</div>
<div id="random-start-generation-and-selection" class="section level5 hasAnchor">
<h5>Random Start Generation and Selection<a href="cluster-selection-in-rural-areas.html#random-start-generation-and-selection" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre class="vba"><code>rand_start = Rnd() * O1Value
Do While counter &lt; userInput
    For i = 2 To lastRow
        If ws.Cells(i, &quot;G&quot;).Value &gt; rand_start Then
            ws.Cells(i, &quot;B&quot;).Interior.Color = RGB(255, 255, 0) &#39; Yellow
            rand_start = rand_start + O1Value
            counter = counter + 1</code></pre>
<ul>
<li><strong>Random Start</strong>: Generates random starting point within first interval</li>
<li><strong>Systematic Selection</strong>: Adds interval size to select subsequent items</li>
<li><strong>Visual Marking</strong>: Colors selected rows yellow for identification</li>
<li><strong>Iteration Control</strong>: Continues until desired sample size reached</li>
</ul>
</div>
</div>
<div id="multi-iteration-processing" class="section level4 hasAnchor">
<h4>3.4 Multi-Iteration Processing<a href="cluster-selection-in-rural-areas.html#multi-iteration-processing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>For iterationcounter = 1 To repeatTimes
    Application.Run &quot;&#39;&quot; &amp; PPSWorkbook.Name &amp; &quot;&#39;!RandomSelector&quot;
    PPSWorkbook.Sheets(1).Range(&quot;M:O&quot;).Copy wsNew.Cells(1, pasteMOColumn)</code></pre>
<ul>
<li><strong>Function</strong>: Runs multiple independent sampling iterations</li>
<li><strong>Output Management</strong>: Places results side-by-side for comparison</li>
</ul>
</div>
<div id="filterbycolor-and-data-extraction" class="section level4 hasAnchor">
<h4>3.5 FilterByColor and Data Extraction<a href="cluster-selection-in-rural-areas.html#filterbycolor-and-data-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre class="vba"><code>ws.Range(&quot;A1:H&quot; &amp; lastRow).AutoFilter field:=2, Criteria1:=RGB(255, 255, 0), Operator:=xlFilterCellColor
Set visibleRange = filteredRange.SpecialCells(xlCellTypeVisible)
visibleRange.Copy wsNew.Cells(1, pasteTableColumn)</code></pre>
<ul>
<li><p><strong>Function</strong>: Isolates selected (yellow) rows from the dataset</p></li>
<li><p><strong>Method</strong>: Uses Excel’s AutoFilter with color criteria</p></li>
<li><p><strong>Extraction</strong>: Copies only visible (selected) rows to results</p></li>
<li><p><strong>Layout</strong>: Arranges multiple iterations horizontally for analysis</p>
<p><img src="images/clipboard-545713547.png" /></p>
<p><img src="images/clipboard-2316106099.png" width="690" height="166" /></p></li>
</ul>
<hr />

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cluster-selection-in-urban-areas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
