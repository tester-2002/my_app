<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Cluster selection in Urban areas | NMHS_APP</title>
  <meta name="description" content="Documentation for the NMHS_APP project" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Cluster selection in Urban areas | NMHS_APP" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentation for the NMHS_APP project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cluster selection in Urban areas | NMHS_APP" />
  
  <meta name="twitter:description" content="Documentation for the NMHS_APP project" />
  

<meta name="author" content="Deepan P" />


<meta name="date" content="2024-09-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cluster-selection-in-rural-areas.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>Introduction</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Rural areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#file-structure"><i class="fa fa-check"></i>File structure</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#program-flow-chart"><i class="fa fa-check"></i>Program Flow chart</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-data-collection-and-consolidation-first-pass"><i class="fa fa-check"></i><strong>PHASE 1: Data Collection and Consolidation</strong> <br>(First Pass)</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-output"><i class="fa fa-check"></i>Phase 1 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-proportional-analysis-and-sampling-preparation"><i class="fa fa-check"></i><strong>PHASE 2: Proportional Analysis and Sampling Preparation</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-1"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-1"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-output"><i class="fa fa-check"></i>Phase 2 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-3-systematic-sampling-and-results-generation-second-pass"><i class="fa fa-check"></i><strong>PHASE 3: Systematic Sampling and Results Generation (Second Pass)</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-2"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-2"><i class="fa fa-check"></i>Detailed Procedures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Urban areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#program-flow-chart-1"><i class="fa fa-check"></i>Program Flow chart</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#import-libraries-and-utility-functions"><i class="fa fa-check"></i>Import Libraries and Utility Functions</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#data-download-and-initial-processing"><i class="fa fa-check"></i>Data Download and Initial Processing</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#district-selection-and-filtering"><i class="fa fa-check"></i>District Selection and Filtering</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#exclusion-logic"><i class="fa fa-check"></i>Exclusion Logic</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#why-exclusion-was-done"><i class="fa fa-check"></i>Why Exclusion was done?</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#will-this-exclusion-process-be-avoided-in-some-cases"><i class="fa fa-check"></i>Will this exclusion process be avoided in some cases?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#cluster-calculation-and-proportional-allocation"><i class="fa fa-check"></i>Cluster Calculation and Proportional Allocation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#utility-functions-for-report-generation"><i class="fa fa-check"></i>Utility Functions for Report Generation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#result-summary-and-sampling-preparation"><i class="fa fa-check"></i>Result Summary and Sampling Preparation</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#random-cluster-sampling-implementation"><i class="fa fa-check"></i>Random Cluster Sampling Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#two-stage-sampling-process"><i class="fa fa-check"></i>Two-Stage Sampling Process</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#procedure-for-sampling-iv-units"><i class="fa fa-check"></i>Procedure for Sampling IV Units</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#frequency-of-iv-unit-selection-and-block-sampling"><i class="fa fa-check"></i>Frequency of IV Unit Selection and Block Sampling</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#importance-of-exclusion-and-combined-sampling-strategy"><i class="fa fa-check"></i>Importance of Exclusion and Combined Sampling Strategy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#geographic-coordinate-assignment-geocoding"><i class="fa fa-check"></i>Geographic Coordinate Assignment (Geocoding)</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#output-generation-and-final-documentation"><i class="fa fa-check"></i>Output Generation and Final Documentation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>NMHS_APP</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cluster-selection-in-urban-areas" class="section level1 hasAnchor">
<h1><strong>Cluster selection in Urban areas</strong><a href="cluster-selection-in-urban-areas.html#cluster-selection-in-urban-areas" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="program-flow-chart-1" class="section level3 hasAnchor">
<h3>Program Flow chart<a href="cluster-selection-in-urban-areas.html#program-flow-chart-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="cluster-selection-in-urban-areas.html#cb1-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;flow-chart.svg&quot;</span>)</span></code></pre></div>
</details>
<p><img src="flow-chart.svg" width="50%" style="display: block; margin: auto;" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="cluster-selection-in-urban-areas.html#cb2-1" tabindex="-1"></a><span class="co"># Install Python packages via pip</span></span>
<span id="cb2-2"><a href="cluster-selection-in-urban-areas.html#cb2-2" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;pip install requests pandas geopy openpyxl geopandas matplotlib numpy reportlab PyPDF2&quot;</span>)</span>
<span id="cb2-3"><a href="cluster-selection-in-urban-areas.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="cluster-selection-in-urban-areas.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="cluster-selection-in-urban-areas.html#cb2-5" tabindex="-1"></a><span class="co"># Download files from Google Drive using gdown</span></span>
<span id="cb2-6"><a href="cluster-selection-in-urban-areas.html#cb2-6" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;gdown https://drive.google.com/uc?id=1BQnzVmLHCfw84z-RnfWbdgcpNIBNgKWc&quot;</span>)</span>
<span id="cb2-7"><a href="cluster-selection-in-urban-areas.html#cb2-7" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;gdown https://drive.google.com/uc?id=18L5b_ya_YxoD7-PCfw8ftzeXU0jh6BIy&quot;</span>)</span>
<span id="cb2-8"><a href="cluster-selection-in-urban-areas.html#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="cluster-selection-in-urban-areas.html#cb2-9" tabindex="-1"></a><span class="co"># Make directory</span></span>
<span id="cb2-10"><a href="cluster-selection-in-urban-areas.html#cb2-10" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;GIS map temp&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-11"><a href="cluster-selection-in-urban-areas.html#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="cluster-selection-in-urban-areas.html#cb2-12" tabindex="-1"></a><span class="co"># Unzip file</span></span>
<span id="cb2-13"><a href="cluster-selection-in-urban-areas.html#cb2-13" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;district_boundries.zip&quot;</span>, <span class="at">exdir =</span> <span class="st">&quot;GIS&quot;</span>)</span>
<span id="cb2-14"><a href="cluster-selection-in-urban-areas.html#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="cluster-selection-in-urban-areas.html#cb2-15" tabindex="-1"></a><span class="co"># Remove zip file</span></span>
<span id="cb2-16"><a href="cluster-selection-in-urban-areas.html#cb2-16" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;district_boundries.zip&quot;</span>)</span>
<span id="cb2-17"><a href="cluster-selection-in-urban-areas.html#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="cluster-selection-in-urban-areas.html#cb2-18" tabindex="-1"></a><span class="co"># Remove folder</span></span>
<span id="cb2-19"><a href="cluster-selection-in-urban-areas.html#cb2-19" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;sample_data&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
</div>
<div id="import-libraries-and-utility-functions" class="section level2 hasAnchor">
<h2>Import Libraries and Utility Functions<a href="cluster-selection-in-urban-areas.html#import-libraries-and-utility-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section imports all necessary libraries for data processing, file operations, geographic analysis, visualization, and PDF generation. It also includes utility functions for:</p>
<ul>
<li><strong>File Download</strong>: Download files from URLs with error handling and progress tracking</li>
<li><strong>Random Filename Generation</strong>: Create unique filenames to avoid conflicts during file operations</li>
</ul>
<p><strong>Key Libraries:</strong> - <code>pandas</code>, <code>numpy</code>: Data manipulation and analysis - <code>geopandas</code>, <code>geopy</code>: Geographic data processing - <code>matplotlib</code>: Data visualization - <code>reportlab</code>, <code>PyPDF2</code>: PDF generation and manipulation - <code>requests</code>: HTTP requests for file downloads - <code>openpyxl</code>: Excel file operations</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="cluster-selection-in-urban-areas.html#cb3-1" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="cluster-selection-in-urban-areas.html#cb3-2" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="cluster-selection-in-urban-areas.html#cb3-3" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb3-4"><a href="cluster-selection-in-urban-areas.html#cb3-4" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb3-5"><a href="cluster-selection-in-urban-areas.html#cb3-5" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-6"><a href="cluster-selection-in-urban-areas.html#cb3-6" tabindex="-1"></a><span class="im">import</span> geopy</span>
<span id="cb3-7"><a href="cluster-selection-in-urban-areas.html#cb3-7" tabindex="-1"></a><span class="im">from</span> openpyxl <span class="im">import</span> Workbook</span>
<span id="cb3-8"><a href="cluster-selection-in-urban-areas.html#cb3-8" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb3-9"><a href="cluster-selection-in-urban-areas.html#cb3-9" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-10"><a href="cluster-selection-in-urban-areas.html#cb3-10" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-11"><a href="cluster-selection-in-urban-areas.html#cb3-11" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb3-12"><a href="cluster-selection-in-urban-areas.html#cb3-12" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-13"><a href="cluster-selection-in-urban-areas.html#cb3-13" tabindex="-1"></a><span class="im">from</span> reportlab.lib <span class="im">import</span> colors</span>
<span id="cb3-14"><a href="cluster-selection-in-urban-areas.html#cb3-14" tabindex="-1"></a><span class="im">from</span> reportlab.lib.pagesizes <span class="im">import</span> A4</span>
<span id="cb3-15"><a href="cluster-selection-in-urban-areas.html#cb3-15" tabindex="-1"></a><span class="im">from</span> reportlab.lib.units <span class="im">import</span> inch</span>
<span id="cb3-16"><a href="cluster-selection-in-urban-areas.html#cb3-16" tabindex="-1"></a><span class="im">from</span> reportlab.pdfgen <span class="im">import</span> canvas</span>
<span id="cb3-17"><a href="cluster-selection-in-urban-areas.html#cb3-17" tabindex="-1"></a><span class="im">from</span> reportlab.pdfbase <span class="im">import</span> pdfmetrics</span>
<span id="cb3-18"><a href="cluster-selection-in-urban-areas.html#cb3-18" tabindex="-1"></a><span class="im">from</span> reportlab.pdfbase.ttfonts <span class="im">import</span> TTFont</span>
<span id="cb3-19"><a href="cluster-selection-in-urban-areas.html#cb3-19" tabindex="-1"></a><span class="im">from</span> reportlab.platypus <span class="im">import</span> Table, TableStyle, SimpleDocTemplate</span>
<span id="cb3-20"><a href="cluster-selection-in-urban-areas.html#cb3-20" tabindex="-1"></a><span class="im">from</span> PyPDF2 <span class="im">import</span> PdfWriter, PdfReader</span>
<span id="cb3-21"><a href="cluster-selection-in-urban-areas.html#cb3-21" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb3-22"><a href="cluster-selection-in-urban-areas.html#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="cluster-selection-in-urban-areas.html#cb3-23" tabindex="-1"></a><span class="co"># Suppress specific warnings to keep output clean</span></span>
<span id="cb3-24"><a href="cluster-selection-in-urban-areas.html#cb3-24" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb3-25"><a href="cluster-selection-in-urban-areas.html#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a href="cluster-selection-in-urban-areas.html#cb3-26" tabindex="-1"></a><span class="kw">def</span> download_file(url, folder_path, filename):</span>
<span id="cb3-27"><a href="cluster-selection-in-urban-areas.html#cb3-27" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-28"><a href="cluster-selection-in-urban-areas.html#cb3-28" tabindex="-1"></a><span class="co">    Download a file from URL and save it to specified folder</span></span>
<span id="cb3-29"><a href="cluster-selection-in-urban-areas.html#cb3-29" tabindex="-1"></a><span class="co">    Returns: filepath if successful, None if failed</span></span>
<span id="cb3-30"><a href="cluster-selection-in-urban-areas.html#cb3-30" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb3-31"><a href="cluster-selection-in-urban-areas.html#cb3-31" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-32"><a href="cluster-selection-in-urban-areas.html#cb3-32" tabindex="-1"></a>        <span class="co"># Create directory if it doesn&#39;t exist</span></span>
<span id="cb3-33"><a href="cluster-selection-in-urban-areas.html#cb3-33" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(folder_path):</span>
<span id="cb3-34"><a href="cluster-selection-in-urban-areas.html#cb3-34" tabindex="-1"></a>            os.makedirs(folder_path)</span>
<span id="cb3-35"><a href="cluster-selection-in-urban-areas.html#cb3-35" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;✓ Created directory: </span><span class="sc">{</span>folder_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-36"><a href="cluster-selection-in-urban-areas.html#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="cluster-selection-in-urban-areas.html#cb3-37" tabindex="-1"></a>        <span class="co"># Download file with streaming to handle large files</span></span>
<span id="cb3-38"><a href="cluster-selection-in-urban-areas.html#cb3-38" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-39"><a href="cluster-selection-in-urban-areas.html#cb3-39" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb3-40"><a href="cluster-selection-in-urban-areas.html#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="cluster-selection-in-urban-areas.html#cb3-41" tabindex="-1"></a>        filepath <span class="op">=</span> os.path.join(folder_path, filename)</span>
<span id="cb3-42"><a href="cluster-selection-in-urban-areas.html#cb3-42" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb3-43"><a href="cluster-selection-in-urban-areas.html#cb3-43" tabindex="-1"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> response.iter_content(chunk_size<span class="op">=</span><span class="dv">8192</span>):</span>
<span id="cb3-44"><a href="cluster-selection-in-urban-areas.html#cb3-44" tabindex="-1"></a>                <span class="bu">file</span>.write(chunk)</span>
<span id="cb3-45"><a href="cluster-selection-in-urban-areas.html#cb3-45" tabindex="-1"></a></span>
<span id="cb3-46"><a href="cluster-selection-in-urban-areas.html#cb3-46" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;✓ File downloaded successfully: </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-47"><a href="cluster-selection-in-urban-areas.html#cb3-47" tabindex="-1"></a>        <span class="cf">return</span> filepath</span>
<span id="cb3-48"><a href="cluster-selection-in-urban-areas.html#cb3-48" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb3-49"><a href="cluster-selection-in-urban-areas.html#cb3-49" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;✗ Error downloading file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-50"><a href="cluster-selection-in-urban-areas.html#cb3-50" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-51"><a href="cluster-selection-in-urban-areas.html#cb3-51" tabindex="-1"></a></span>
<span id="cb3-52"><a href="cluster-selection-in-urban-areas.html#cb3-52" tabindex="-1"></a><span class="kw">def</span> generate_random_filename(length<span class="op">=</span><span class="dv">10</span>, extension<span class="op">=</span><span class="st">&quot;.xlsx&quot;</span>):</span>
<span id="cb3-53"><a href="cluster-selection-in-urban-areas.html#cb3-53" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Generate a random filename to avoid conflicts&quot;&quot;&quot;</span></span>
<span id="cb3-54"><a href="cluster-selection-in-urban-areas.html#cb3-54" tabindex="-1"></a>    characters <span class="op">=</span> string.ascii_letters <span class="op">+</span> string.digits</span>
<span id="cb3-55"><a href="cluster-selection-in-urban-areas.html#cb3-55" tabindex="-1"></a>    random_filename <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(random.choice(characters) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(length)) <span class="op">+</span> extension</span>
<span id="cb3-56"><a href="cluster-selection-in-urban-areas.html#cb3-56" tabindex="-1"></a>    <span class="cf">return</span> random_filename</span></code></pre></div>
</details>
</div>
<div id="data-download-and-initial-processing" class="section level2 hasAnchor">
<h2>Data Download and Initial Processing<a href="cluster-selection-in-urban-areas.html#data-download-and-initial-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step handles the initial data acquisition and preprocessing:</p>
<p><strong>Key Operations:</strong></p>
<p>1. <strong>Download Data</strong>: Downloads UFS (Urban Frame Survey) data from MOSPI website for Goa state</p>
<p>2. <strong>Load Excel File</strong>: Reads the downloaded Excel file into a pandas DataFrame</p>
<p>3. <strong>Clean Headers</strong>: Removes metadata rows and assigns meaningful column names</p>
<p>4. <strong>Extract State Info</strong>: Captures state name and code for later use</p>
<p><strong>Data Structure:</strong></p>
<p>- <code>S_Code</code>, <code>S_Name</code>: State code and name</p>
<p>- <code>D_Code</code>, <code>District</code>: District code and name<br />
- <code>T_Code</code>, <code>Town</code>: Town code and name</p>
<p>- <code>IV_Unit_No</code>, <code>Block_No</code>: Investigation unit and block identifiers</p>
<p>- <code>No_of_Households</code>: Number of households in each block</p>
<p>This creates the foundation dataset for cluster sampling analysis.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="cluster-selection-in-urban-areas.html#cb4-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb4-2"><a href="cluster-selection-in-urban-areas.html#cb4-2" tabindex="-1"></a><span class="co"># STEP 1: DATA DOWNLOAD AND INITIAL PROCESSING</span></span>
<span id="cb4-3"><a href="cluster-selection-in-urban-areas.html#cb4-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb4-4"><a href="cluster-selection-in-urban-areas.html#cb4-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb4-5"><a href="cluster-selection-in-urban-areas.html#cb4-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 1: DOWNLOADING AND LOADING DATA&quot;</span>)</span>
<span id="cb4-6"><a href="cluster-selection-in-urban-areas.html#cb4-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb4-7"><a href="cluster-selection-in-urban-areas.html#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="cluster-selection-in-urban-areas.html#cb4-8" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&quot;https://mospi.gov.in/sites/default/files/publication_reports/UFS/UFS_30_Goa7112023.xlsx&quot;</span></span>
<span id="cb4-9"><a href="cluster-selection-in-urban-areas.html#cb4-9" tabindex="-1"></a>filename <span class="op">=</span> generate_random_filename()</span>
<span id="cb4-10"><a href="cluster-selection-in-urban-areas.html#cb4-10" tabindex="-1"></a>folder_path <span class="op">=</span> <span class="st">&quot;states&quot;</span></span>
<span id="cb4-11"><a href="cluster-selection-in-urban-areas.html#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="cluster-selection-in-urban-areas.html#cb4-12" tabindex="-1"></a><span class="co"># Download the Excel file</span></span>
<span id="cb4-13"><a href="cluster-selection-in-urban-areas.html#cb4-13" tabindex="-1"></a>download_file(url, folder_path<span class="op">=</span>folder_path, filename<span class="op">=</span>filename)</span>
<span id="cb4-14"><a href="cluster-selection-in-urban-areas.html#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="cluster-selection-in-urban-areas.html#cb4-15" tabindex="-1"></a><span class="co"># Load and process the Excel file</span></span>
<span id="cb4-16"><a href="cluster-selection-in-urban-areas.html#cb4-16" tabindex="-1"></a>filepath <span class="op">=</span> os.path.join(folder_path, filename)</span>
<span id="cb4-17"><a href="cluster-selection-in-urban-areas.html#cb4-17" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(filepath)</span>
<span id="cb4-18"><a href="cluster-selection-in-urban-areas.html#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="cluster-selection-in-urban-areas.html#cb4-19" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Initial data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-20"><a href="cluster-selection-in-urban-areas.html#cb4-20" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Initial columns: </span><span class="sc">{</span><span class="bu">list</span>(df.columns)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-21"><a href="cluster-selection-in-urban-areas.html#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="cluster-selection-in-urban-areas.html#cb4-22" tabindex="-1"></a><span class="co"># Remove first 2 rows (likely headers) and limit to first 10 columns</span></span>
<span id="cb4-23"><a href="cluster-selection-in-urban-areas.html#cb4-23" tabindex="-1"></a>df <span class="op">=</span> df.iloc[<span class="dv">2</span>:]</span>
<span id="cb4-24"><a href="cluster-selection-in-urban-areas.html#cb4-24" tabindex="-1"></a>df <span class="op">=</span> df.iloc[:, :<span class="dv">10</span>]</span>
<span id="cb4-25"><a href="cluster-selection-in-urban-areas.html#cb4-25" tabindex="-1"></a></span>
<span id="cb4-26"><a href="cluster-selection-in-urban-areas.html#cb4-26" tabindex="-1"></a><span class="co"># Assign meaningful column names</span></span>
<span id="cb4-27"><a href="cluster-selection-in-urban-areas.html#cb4-27" tabindex="-1"></a>new_column_names <span class="op">=</span> [<span class="st">&#39;S_Code&#39;</span>, <span class="st">&#39;S_Name&#39;</span>, <span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>, <span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;Town&#39;</span>, <span class="st">&#39;Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Block_No&#39;</span>, <span class="st">&#39;No_of_Households&#39;</span>]</span>
<span id="cb4-28"><a href="cluster-selection-in-urban-areas.html#cb4-28" tabindex="-1"></a>df.columns <span class="op">=</span> new_column_names</span>
<span id="cb4-29"><a href="cluster-selection-in-urban-areas.html#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a href="cluster-selection-in-urban-areas.html#cb4-30" tabindex="-1"></a><span class="co"># Extract state information</span></span>
<span id="cb4-31"><a href="cluster-selection-in-urban-areas.html#cb4-31" tabindex="-1"></a>state_name <span class="op">=</span> df.iloc[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb4-32"><a href="cluster-selection-in-urban-areas.html#cb4-32" tabindex="-1"></a>state_code <span class="op">=</span> df.iloc[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb4-33"><a href="cluster-selection-in-urban-areas.html#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="cluster-selection-in-urban-areas.html#cb4-34" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> State Name: </span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-35"><a href="cluster-selection-in-urban-areas.html#cb4-35" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot; State Code: </span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-36"><a href="cluster-selection-in-urban-areas.html#cb4-36" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Processed data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-37"><a href="cluster-selection-in-urban-areas.html#cb4-37" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Sample of processed data:&quot;</span>)</span>
<span id="cb4-38"><a href="cluster-selection-in-urban-areas.html#cb4-38" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code></pre></div>
</details>
<p>🏛️ State Name: Goa 🏛️ State Code: 30 📊 Processed data shape: (1592, 10)</p>
<p><strong>Preprocessed data set:</strong></p>
<table style="width:100%;">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>S_Code</th>
<th>S_Name</th>
<th>D_Code</th>
<th>District</th>
<th>T_Code</th>
<th>Town</th>
<th>IV_Unit_No</th>
<th>Block_No</th>
<th>No_of_Households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>63</td>
</tr>
<tr class="even">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>69</td>
</tr>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>83</td>
</tr>
<tr class="even">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>89</td>
</tr>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>90</td>
</tr>
</tbody>
</table>
</div>
<div id="district-selection-and-filtering" class="section level2 hasAnchor">
<h2>District Selection and Filtering<a href="cluster-selection-in-urban-areas.html#district-selection-and-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step allows users to select specific districts for analysis:</p>
<p><strong>Process:</strong></p>
<p>1. <strong>User Input</strong>: Prompts user to enter district codes separated by spaces</p>
<p>2. <strong>Data Filtering</strong>: Filters the main dataset to include only selected districts</p>
<p>3. <strong>Validation</strong>: Shows which districts are included in the filtered dataset</p>
<p><strong>Purpose:</strong></p>
<p>- Enables targeted analysis for specific geographical areas</p>
<p>- Reduces dataset size for more focused sampling</p>
<p>- Allows comparison between different district combinations</p>
<p><strong>Output:</strong> Filtered dataset containing only the selected districts with summary statistics.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="cluster-selection-in-urban-areas.html#cb5-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb5-2"><a href="cluster-selection-in-urban-areas.html#cb5-2" tabindex="-1"></a><span class="co"># STEP 2: DISTRICT SELECTION AND FILTERING</span></span>
<span id="cb5-3"><a href="cluster-selection-in-urban-areas.html#cb5-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb5-4"><a href="cluster-selection-in-urban-areas.html#cb5-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb5-5"><a href="cluster-selection-in-urban-areas.html#cb5-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 2: DISTRICT SELECTION AND FILTERING&quot;</span>)</span>
<span id="cb5-6"><a href="cluster-selection-in-urban-areas.html#cb5-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb5-7"><a href="cluster-selection-in-urban-areas.html#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="cluster-selection-in-urban-areas.html#cb5-8" tabindex="-1"></a><span class="co"># Get user input for district codes</span></span>
<span id="cb5-9"><a href="cluster-selection-in-urban-areas.html#cb5-9" tabindex="-1"></a>D_Code_list <span class="op">=</span> [<span class="st">&quot;01&quot;</span>,<span class="st">&quot;02&quot;</span>]</span>
<span id="cb5-10"><a href="cluster-selection-in-urban-areas.html#cb5-10" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Selected district codes: </span><span class="sc">{</span>D_Code_list<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-11"><a href="cluster-selection-in-urban-areas.html#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="cluster-selection-in-urban-areas.html#cb5-12" tabindex="-1"></a><span class="co"># Filter data for selected districts</span></span>
<span id="cb5-13"><a href="cluster-selection-in-urban-areas.html#cb5-13" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">&#39;D_Code&#39;</span>].isin(D_Code_list)]</span>
<span id="cb5-14"><a href="cluster-selection-in-urban-areas.html#cb5-14" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Filtered data shape: </span><span class="sc">{</span>filtered_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-15"><a href="cluster-selection-in-urban-areas.html#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="cluster-selection-in-urban-areas.html#cb5-16" tabindex="-1"></a><span class="co"># Show unique districts in filtered data</span></span>
<span id="cb5-17"><a href="cluster-selection-in-urban-areas.html#cb5-17" tabindex="-1"></a>unique_districts <span class="op">=</span> filtered_df[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>]].drop_duplicates()</span>
<span id="cb5-18"><a href="cluster-selection-in-urban-areas.html#cb5-18" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Districts in filtered data:&quot;</span>)</span>
<span id="cb5-19"><a href="cluster-selection-in-urban-areas.html#cb5-19" tabindex="-1"></a>display(unique_districts.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</details>
<p><strong>Selected district codes:</strong> <code>['01', '02']</code><br />
<strong>Filtered data shape:</strong> <code>(1592, 10)</code></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
</tr>
</tbody>
</table>
</div>
<div id="exclusion-logic" class="section level2 hasAnchor">
<h2>Exclusion Logic<a href="cluster-selection-in-urban-areas.html#exclusion-logic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step implements quality control by removing Investigation Units (IV Units) with insufficient data for the sampling process</p>
<p><strong>Quality Criteria:</strong> - <strong>Threshold</strong>: IV Units with fewer than 20 blocks are considered insufficient for reliable sampling - <strong>Analysis Level</strong>: Examines each Town-IV Unit combination within districts</p>
<p><strong>Process:</strong></p>
<p>1. <strong>Frequency Analysis</strong>: Counts blocks per IV Unit in each town</p>
<p>2. <strong>Threshold Application</strong>: Identifies IV Units with &lt;20 blocks</p>
<p>3. <strong>Exclusion Decision</strong>: Removes insufficient IV Units based on <code>Excluder</code> parameter</p>
<p>4. <strong>Data Cleaning</strong>: Creates filtered dataset with only sufficient IV Units</p>
<p><strong>Output:</strong> Clean dataset with only statistically viable IV Units for cluster sampling.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="cluster-selection-in-urban-areas.html#cb6-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb6-2"><a href="cluster-selection-in-urban-areas.html#cb6-2" tabindex="-1"></a><span class="co"># STEP 3: EXCLUSION LOGIC - REMOVE IV UNITS WITH &lt;20 BLOCKS</span></span>
<span id="cb6-3"><a href="cluster-selection-in-urban-areas.html#cb6-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb6-4"><a href="cluster-selection-in-urban-areas.html#cb6-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb6-5"><a href="cluster-selection-in-urban-areas.html#cb6-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 3: APPLYING EXCLUSION LOGIC&quot;</span>)</span>
<span id="cb6-6"><a href="cluster-selection-in-urban-areas.html#cb6-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb6-7"><a href="cluster-selection-in-urban-areas.html#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="cluster-selection-in-urban-areas.html#cb6-8" tabindex="-1"></a><span class="co"># Set exclusion parameter (1 to enable exclusion, 0 to disable)</span></span>
<span id="cb6-9"><a href="cluster-selection-in-urban-areas.html#cb6-9" tabindex="-1"></a>Excluder <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Set to 1 to enable exclusion, 0 to disable</span></span>
<span id="cb6-10"><a href="cluster-selection-in-urban-areas.html#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="cluster-selection-in-urban-areas.html#cb6-11" tabindex="-1"></a>excluded_combinations_by_district <span class="op">=</span> {}</span>
<span id="cb6-12"><a href="cluster-selection-in-urban-areas.html#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="cluster-selection-in-urban-areas.html#cb6-13" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;🔍 Analyzing IV Units by district...&quot;</span>)</span>
<span id="cb6-14"><a href="cluster-selection-in-urban-areas.html#cb6-14" tabindex="-1"></a><span class="cf">for</span> district_code, group <span class="kw">in</span> filtered_df.groupby(<span class="st">&#39;D_Code&#39;</span>):</span>
<span id="cb6-15"><a href="cluster-selection-in-urban-areas.html#cb6-15" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📍 Processing District: </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-16"><a href="cluster-selection-in-urban-areas.html#cb6-16" tabindex="-1"></a></span>
<span id="cb6-17"><a href="cluster-selection-in-urban-areas.html#cb6-17" tabindex="-1"></a>    <span class="co"># Count frequency of each T_Code + IV_Unit_No combination</span></span>
<span id="cb6-18"><a href="cluster-selection-in-urban-areas.html#cb6-18" tabindex="-1"></a>    er <span class="op">=</span> group.groupby([<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb6-19"><a href="cluster-selection-in-urban-areas.html#cb6-19" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   📊 Total T_Code + IV_Unit_No combinations: </span><span class="sc">{</span><span class="bu">len</span>(er)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-20"><a href="cluster-selection-in-urban-areas.html#cb6-20" tabindex="-1"></a></span>
<span id="cb6-21"><a href="cluster-selection-in-urban-areas.html#cb6-21" tabindex="-1"></a>    <span class="co"># Find combinations with less than 20 blocks</span></span>
<span id="cb6-22"><a href="cluster-selection-in-urban-areas.html#cb6-22" tabindex="-1"></a>    excluded_combinations <span class="op">=</span> er[er[<span class="st">&#39;Frequency&#39;</span>] <span class="op">&lt;</span> <span class="dv">20</span>][[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]]</span>
<span id="cb6-23"><a href="cluster-selection-in-urban-areas.html#cb6-23" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   ❌ Combinations with &lt;20 blocks: </span><span class="sc">{</span><span class="bu">len</span>(excluded_combinations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-24"><a href="cluster-selection-in-urban-areas.html#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="cluster-selection-in-urban-areas.html#cb6-25" tabindex="-1"></a>    <span class="co"># Skip if all combinations would be excluded and Excluder is 0</span></span>
<span id="cb6-26"><a href="cluster-selection-in-urban-areas.html#cb6-26" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(excluded_combinations) <span class="op">==</span> er.shape[<span class="dv">0</span>] <span class="kw">and</span> Excluder <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-27"><a href="cluster-selection-in-urban-areas.html#cb6-27" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   ⚠️  All combinations would be excluded, skipping district </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-28"><a href="cluster-selection-in-urban-areas.html#cb6-28" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb6-29"><a href="cluster-selection-in-urban-areas.html#cb6-29" tabindex="-1"></a></span>
<span id="cb6-30"><a href="cluster-selection-in-urban-areas.html#cb6-30" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> excluded_combinations.empty:</span>
<span id="cb6-31"><a href="cluster-selection-in-urban-areas.html#cb6-31" tabindex="-1"></a>        excluded_combinations_by_district[district_code] <span class="op">=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> excluded_combinations.to_records(index<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb6-32"><a href="cluster-selection-in-urban-areas.html#cb6-32" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   🚫 Excluded combinations: </span><span class="sc">{</span>excluded_combinations_by_district[district_code]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-33"><a href="cluster-selection-in-urban-areas.html#cb6-33" tabindex="-1"></a></span>
<span id="cb6-34"><a href="cluster-selection-in-urban-areas.html#cb6-34" tabindex="-1"></a><span class="co"># Create a set of all excluded combinations for filtering</span></span>
<span id="cb6-35"><a href="cluster-selection-in-urban-areas.html#cb6-35" tabindex="-1"></a>excluded_combinations <span class="op">=</span> {</span>
<span id="cb6-36"><a href="cluster-selection-in-urban-areas.html#cb6-36" tabindex="-1"></a>    (d_code, t_code, iv_unit_no)</span>
<span id="cb6-37"><a href="cluster-selection-in-urban-areas.html#cb6-37" tabindex="-1"></a>    <span class="cf">for</span> d_code, combinations <span class="kw">in</span> excluded_combinations_by_district.items()</span>
<span id="cb6-38"><a href="cluster-selection-in-urban-areas.html#cb6-38" tabindex="-1"></a>    <span class="cf">for</span> t_code, iv_unit_no <span class="kw">in</span> combinations</span>
<span id="cb6-39"><a href="cluster-selection-in-urban-areas.html#cb6-39" tabindex="-1"></a>}</span>
<span id="cb6-40"><a href="cluster-selection-in-urban-areas.html#cb6-40" tabindex="-1"></a></span>
<span id="cb6-41"><a href="cluster-selection-in-urban-areas.html#cb6-41" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📊 Total excluded combinations across all districts: </span><span class="sc">{</span><span class="bu">len</span>(excluded_combinations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-42"><a href="cluster-selection-in-urban-areas.html#cb6-42" tabindex="-1"></a></span>
<span id="cb6-43"><a href="cluster-selection-in-urban-areas.html#cb6-43" tabindex="-1"></a><span class="co"># Apply exclusion filter</span></span>
<span id="cb6-44"><a href="cluster-selection-in-urban-areas.html#cb6-44" tabindex="-1"></a>filtered_df1 <span class="op">=</span> filtered_df[</span>
<span id="cb6-45"><a href="cluster-selection-in-urban-areas.html#cb6-45" tabindex="-1"></a>    <span class="op">~</span>filtered_df.set_index([<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).index.isin(excluded_combinations)</span>
<span id="cb6-46"><a href="cluster-selection-in-urban-areas.html#cb6-46" tabindex="-1"></a>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-47"><a href="cluster-selection-in-urban-areas.html#cb6-47" tabindex="-1"></a></span>
<span id="cb6-48"><a href="cluster-selection-in-urban-areas.html#cb6-48" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📊 Data shape after exclusions: </span><span class="sc">{</span>filtered_df1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-49"><a href="cluster-selection-in-urban-areas.html#cb6-49" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📊 Rows removed: </span><span class="sc">{</span><span class="bu">len</span>(filtered_df) <span class="op">-</span> <span class="bu">len</span>(filtered_df1)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<div class="results">
<p>🔍 Analyzing IV Units by district…</p>
<p>📍 <strong>Processing District: 01</strong><br />
📊 Total T_Code + IV_Unit_No combinations: 56<br />
❌ Combinations with &lt;20 blocks: 42<br />
🚫 Excluded combinations:<br />
(‘001’, ‘0001’), (‘002’, ‘0001’), (‘007’, ‘0001’), (‘008’, ‘0001’),<br />
(‘010’, ‘0001’), (‘011’, ‘0001’), (‘012’, ‘0001’), (‘013’, ‘0001’),<br />
(‘014’, ‘0002’), (‘014’, ‘0003’), (‘015’, ‘0001’), (‘016’, ‘0001’),<br />
(‘016’, ‘0002’), (‘016’, ‘0003’), (‘016’, ‘0005’), (‘017’, ‘0001’),<br />
(‘019’, ‘0001’), (‘021’, ‘0001’), (‘022’, ‘0001’), (‘023’, ‘0001’),<br />
(‘024’, ‘0001’), (‘025’, ‘0001’), (‘026’, ‘0001’), (‘027’, ‘0001’),<br />
(‘028’, ‘0001’), (‘029’, ‘0001’), (‘030’, ‘0001’), (‘031’, ‘0001’),<br />
(‘032’, ‘0001’), (‘033’, ‘0001’), (‘034’, ‘0001’), (‘035’, ‘0001’),<br />
(‘038’, ‘0001’), (‘039’, ‘0001’), (‘040’, ‘0001’), (‘042’, ‘0001’),<br />
(‘046’, ‘0001’), (‘048’, ‘0001’), (‘049’, ‘0001’), (‘050’, ‘0001’),<br />
(‘051’, ‘0001’), (‘052’, ‘0001’)</p>
<p>📍 <strong>Processing District: 02</strong><br />
📊 Total T_Code + IV_Unit_No combinations: 29<br />
❌ Combinations with &lt;20 blocks: 11<br />
🚫 Excluded combinations:<br />
(‘001’, ‘0001’), (‘002’, ‘0001’), (‘005’, ‘0001’), (‘009’, ‘0002’),<br />
(‘010’, ‘0002’), (‘011’, ‘0001’), (‘014’, ‘0001’), (‘015’, ‘0001’),<br />
(‘016’, ‘0001’), (‘017’, ‘0001’), (‘018’, ‘0001’)</p>
<p>📊 <strong>Total excluded combinations across all districts:</strong> 53<br />
📊 <strong>Data shape after exclusions:</strong> (890, 10)<br />
📊 <strong>Rows removed:</strong> 702</p>
</div>
<div id="why-exclusion-was-done" class="section level3 hasAnchor">
<h3>Why Exclusion was done?<a href="cluster-selection-in-urban-areas.html#why-exclusion-was-done" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here Column 1 represents the <code>IV units</code> and Column 2 represents the number of blocks in a IV unit.<br />
<img src="images/clipboard-4199608560.jpeg" /></p>
<p>Although IV units are defined as holding 20 to 40 blocks, in many cases they contain far fewer blocks, which may result in an insufficient number of blocks for sampling.</p>
</div>
<div id="will-this-exclusion-process-be-avoided-in-some-cases" class="section level3 hasAnchor">
<h3>Will this exclusion process be avoided in some cases?<a href="cluster-selection-in-urban-areas.html#will-this-exclusion-process-be-avoided-in-some-cases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Yes, in some cases the exclusion process completely eliminates all the IV units in a district, making it impossible to carry out sampling for that district under the general strategy. This occurs when all the IV units have fewer than 20 blocks, and the number of blocks is quite unpredictable—sometimes even as low as one block per IV unit. Therefore, to retain such districts, the exclusion process is avoided.”</p>
<p>However, It is a very rare case.</p>
</div>
</div>
<div id="cluster-calculation-and-proportional-allocation" class="section level2 hasAnchor">
<h2>Cluster Calculation and Proportional Allocation<a href="cluster-selection-in-urban-areas.html#cluster-calculation-and-proportional-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step implements the core statistical methodology for cluster sampling:</p>
<p><strong>Sampling Strategy:</strong></p>
<p>1. <strong>IV unit Count</strong>: Counts unique IV Units per district</p>
<p>2. <strong>Proportional Allocation</strong>: Distributes target clusters based on district size with respect to the number of IV units</p>
<p><strong>Key Calculations:</strong></p>
<p>- <strong>District Proportion</strong> = IV Units in District / Total IV Units</p>
<p>- <strong>Allocated Clusters</strong> = Target Clusters × District Proportion</p>
<p>- <strong>Minimum Allocation</strong>: Each district gets at least 1 cluster (+1 adjustment)</p>
<p><strong>User Input:</strong> Total number of clusters to be selected for the survey</p>
<p><strong>Output:</strong> District-wise cluster allocation plan with verification totals.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="cluster-selection-in-urban-areas.html#cb7-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb7-2"><a href="cluster-selection-in-urban-areas.html#cb7-2" tabindex="-1"></a><span class="co"># STEP 4: CLUSTER CALCULATION AND ALLOCATION</span></span>
<span id="cb7-3"><a href="cluster-selection-in-urban-areas.html#cb7-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb7-4"><a href="cluster-selection-in-urban-areas.html#cb7-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb7-5"><a href="cluster-selection-in-urban-areas.html#cb7-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 4: CLUSTER CALCULATION AND ALLOCATION&quot;</span>)</span>
<span id="cb7-6"><a href="cluster-selection-in-urban-areas.html#cb7-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb7-7"><a href="cluster-selection-in-urban-areas.html#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="cluster-selection-in-urban-areas.html#cb7-8" tabindex="-1"></a><span class="co"># Count unique IV units per district and town</span></span>
<span id="cb7-9"><a href="cluster-selection-in-urban-areas.html#cb7-9" tabindex="-1"></a>g <span class="op">=</span> filtered_df1.iloc[:, :<span class="dv">8</span>].groupby(by<span class="op">=</span>[<span class="st">&quot;D_Code&quot;</span>, <span class="st">&quot;T_Code&quot;</span>])[[<span class="st">&#39;IV_Unit_No&#39;</span>]].nunique()</span>
<span id="cb7-10"><a href="cluster-selection-in-urban-areas.html#cb7-10" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;🔢 IV Units per District-Town combination:&quot;</span>)</span>
<span id="cb7-11"><a href="cluster-selection-in-urban-areas.html#cb7-11" tabindex="-1"></a><span class="bu">print</span>(g.head(<span class="dv">10</span>))</span>
<span id="cb7-12"><a href="cluster-selection-in-urban-areas.html#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="cluster-selection-in-urban-areas.html#cb7-13" tabindex="-1"></a><span class="co"># Sum up total clusters per district</span></span>
<span id="cb7-14"><a href="cluster-selection-in-urban-areas.html#cb7-14" tabindex="-1"></a>unique_iv_unit_counts <span class="op">=</span> g.groupby(by<span class="op">=</span>[<span class="st">&quot;D_Code&quot;</span>]).<span class="bu">sum</span>()</span>
<span id="cb7-15"><a href="cluster-selection-in-urban-areas.html#cb7-15" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📊 Total IV Units per district:&quot;</span>)</span>
<span id="cb7-16"><a href="cluster-selection-in-urban-areas.html#cb7-16" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts)</span>
<span id="cb7-17"><a href="cluster-selection-in-urban-areas.html#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="cluster-selection-in-urban-areas.html#cb7-18" tabindex="-1"></a><span class="co"># Calculate proportions</span></span>
<span id="cb7-19"><a href="cluster-selection-in-urban-areas.html#cb7-19" tabindex="-1"></a>unique_iv_unit_counts_proportion <span class="op">=</span> unique_iv_unit_counts <span class="op">/</span> unique_iv_unit_counts.<span class="bu">sum</span>()</span>
<span id="cb7-20"><a href="cluster-selection-in-urban-areas.html#cb7-20" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;Proportion&#39;</span>] <span class="op">=</span> unique_iv_unit_counts_proportion</span>
<span id="cb7-21"><a href="cluster-selection-in-urban-areas.html#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="cluster-selection-in-urban-areas.html#cb7-22" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📊 District proportions:&quot;</span>)</span>
<span id="cb7-23"><a href="cluster-selection-in-urban-areas.html#cb7-23" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts[[<span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>]])</span>
<span id="cb7-24"><a href="cluster-selection-in-urban-areas.html#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="cluster-selection-in-urban-areas.html#cb7-25" tabindex="-1"></a><span class="co"># Get total number of clusters from user</span></span>
<span id="cb7-26"><a href="cluster-selection-in-urban-areas.html#cb7-26" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Enter the total number of clusters to select: &quot;</span>))</span>
<span id="cb7-27"><a href="cluster-selection-in-urban-areas.html#cb7-27" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🎯 Target total clusters: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-28"><a href="cluster-selection-in-urban-areas.html#cb7-28" tabindex="-1"></a></span>
<span id="cb7-29"><a href="cluster-selection-in-urban-areas.html#cb7-29" tabindex="-1"></a><span class="co"># Allocate clusters proportionally to each district</span></span>
<span id="cb7-30"><a href="cluster-selection-in-urban-areas.html#cb7-30" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>] <span class="op">=</span> (unique_iv_unit_counts_proportion <span class="op">*</span> num_clusters)</span>
<span id="cb7-31"><a href="cluster-selection-in-urban-areas.html#cb7-31" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>] <span class="op">=</span> unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>].<span class="bu">apply</span>(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb7-32"><a href="cluster-selection-in-urban-areas.html#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="cluster-selection-in-urban-areas.html#cb7-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📊 Cluster allocation per district:&quot;</span>)</span>
<span id="cb7-34"><a href="cluster-selection-in-urban-areas.html#cb7-34" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts[[<span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>, <span class="st">&#39;No_of_Cluster&#39;</span>]])</span>
<span id="cb7-35"><a href="cluster-selection-in-urban-areas.html#cb7-35" tabindex="-1"></a></span>
<span id="cb7-36"><a href="cluster-selection-in-urban-areas.html#cb7-36" tabindex="-1"></a><span class="co"># Add district names to results</span></span>
<span id="cb7-37"><a href="cluster-selection-in-urban-areas.html#cb7-37" tabindex="-1"></a>district_names <span class="op">=</span> df[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>]].drop_duplicates()</span>
<span id="cb7-38"><a href="cluster-selection-in-urban-areas.html#cb7-38" tabindex="-1"></a>result <span class="op">=</span> pd.merge(unique_iv_unit_counts, district_names, on<span class="op">=</span><span class="st">&#39;D_Code&#39;</span>, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb7-39"><a href="cluster-selection-in-urban-areas.html#cb7-39" tabindex="-1"></a>result <span class="op">=</span> result[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>, <span class="st">&#39;No_of_Cluster&#39;</span>]]</span>
<span id="cb7-40"><a href="cluster-selection-in-urban-areas.html#cb7-40" tabindex="-1"></a></span>
<span id="cb7-41"><a href="cluster-selection-in-urban-areas.html#cb7-41" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🎯 Final cluster allocation:&quot;</span>)</span>
<span id="cb7-42"><a href="cluster-selection-in-urban-areas.html#cb7-42" tabindex="-1"></a><span class="bu">print</span>(result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb7-43"><a href="cluster-selection-in-urban-areas.html#cb7-43" tabindex="-1"></a></span>
<span id="cb7-44"><a href="cluster-selection-in-urban-areas.html#cb7-44" tabindex="-1"></a><span class="co"># Verify total allocated clusters</span></span>
<span id="cb7-45"><a href="cluster-selection-in-urban-areas.html#cb7-45" tabindex="-1"></a>total_allocated <span class="op">=</span> result[<span class="st">&#39;No_of_Cluster&#39;</span>].<span class="bu">sum</span>()</span>
<span id="cb7-46"><a href="cluster-selection-in-urban-areas.html#cb7-46" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">✅ Total clusters allocated: </span><span class="sc">{</span>total_allocated<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-47"><a href="cluster-selection-in-urban-areas.html#cb7-47" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🎯 Target clusters: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-48"><a href="cluster-selection-in-urban-areas.html#cb7-48" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📊 Difference: </span><span class="sc">{</span>total_allocated <span class="op">-</span> num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<p>📊 <strong>Total IV Units per district</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>IV_Unit_No</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>14</td>
</tr>
<tr class="even">
<td>02</td>
<td>18</td>
</tr>
</tbody>
</table>
<p>📊 <strong>District proportions</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>14</td>
<td>0.4375</td>
</tr>
<tr class="even">
<td>02</td>
<td>18</td>
<td>0.5625</td>
</tr>
</tbody>
</table>
<p>🎯 <strong>Target total clusters:</strong> 131</p>
<p>🎯 <strong>Final cluster allocation</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
<th>No_of_Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
<td>14</td>
<td>0.4375</td>
<td>58</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
<td>18</td>
<td>0.5625</td>
<td>74</td>
</tr>
</tbody>
</table>
<p>✅ <strong>Total clusters allocated:</strong> 132<br />
🎯 <strong>Target clusters:</strong> 131<br />
📊 <strong>Difference:</strong> 1</p>
</div>
<div id="utility-functions-for-report-generation" class="section level2 hasAnchor">
<h2>Utility Functions for Report Generation<a href="cluster-selection-in-urban-areas.html#utility-functions-for-report-generation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section defines helper functions for creating professional output reports:</p>
<p><strong>Excel Generation Functions:</strong> - <code>extract_clusters_to_excel()</code>: Creates multi-sheet Excel workbooks with one sheet per district - Formats data with proper headers and structure</p>
<p><strong>PDF Generation Functions:</strong> - <code>add_text_page()</code>: Adds formatted text content to PDF documents - <code>create_table_pdf()</code>: Generates professional tables with styling - Handles page breaks and font formatting</p>
<p><strong>Data Formatting Functions:</strong> - <code>format_excluded_combinations()</code>: Creates readable summaries of excluded IV Units - Provides clear documentation of data quality decisions</p>
<p><strong>Purpose:</strong> These functions enable automated generation of professional reports for survey planning and documentation, ensuring consistent formatting and comprehensive coverage of sampling decisions.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="cluster-selection-in-urban-areas.html#cb8-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb8-2"><a href="cluster-selection-in-urban-areas.html#cb8-2" tabindex="-1"></a><span class="co"># UTILITY FUNCTIONS FOR EXCEL AND PDF GENERATION</span></span>
<span id="cb8-3"><a href="cluster-selection-in-urban-areas.html#cb8-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb8-4"><a href="cluster-selection-in-urban-areas.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="cluster-selection-in-urban-areas.html#cb8-5" tabindex="-1"></a><span class="kw">def</span> extract_clusters_to_excel(selected_clusters, output_file):</span>
<span id="cb8-6"><a href="cluster-selection-in-urban-areas.html#cb8-6" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create Excel file with separate sheets for each district&quot;&quot;&quot;</span></span>
<span id="cb8-7"><a href="cluster-selection-in-urban-areas.html#cb8-7" tabindex="-1"></a>    workbook <span class="op">=</span> Workbook()</span>
<span id="cb8-8"><a href="cluster-selection-in-urban-areas.html#cb8-8" tabindex="-1"></a>    workbook.remove(workbook.active)  <span class="co"># Remove default sheet</span></span>
<span id="cb8-9"><a href="cluster-selection-in-urban-areas.html#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="cluster-selection-in-urban-areas.html#cb8-10" tabindex="-1"></a>    <span class="cf">for</span> district_code, df <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb8-11"><a href="cluster-selection-in-urban-areas.html#cb8-11" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb8-12"><a href="cluster-selection-in-urban-areas.html#cb8-12" tabindex="-1"></a>            sheet_name <span class="op">=</span> <span class="ss">f&quot;District_</span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb8-13"><a href="cluster-selection-in-urban-areas.html#cb8-13" tabindex="-1"></a>            worksheet <span class="op">=</span> workbook.create_sheet(title<span class="op">=</span>sheet_name)</span>
<span id="cb8-14"><a href="cluster-selection-in-urban-areas.html#cb8-14" tabindex="-1"></a>            <span class="co"># Add headers</span></span>
<span id="cb8-15"><a href="cluster-selection-in-urban-areas.html#cb8-15" tabindex="-1"></a>            worksheet.append(<span class="bu">list</span>(df.columns))</span>
<span id="cb8-16"><a href="cluster-selection-in-urban-areas.html#cb8-16" tabindex="-1"></a>            <span class="co"># Add data</span></span>
<span id="cb8-17"><a href="cluster-selection-in-urban-areas.html#cb8-17" tabindex="-1"></a>            <span class="cf">for</span> row <span class="kw">in</span> df.values.tolist():</span>
<span id="cb8-18"><a href="cluster-selection-in-urban-areas.html#cb8-18" tabindex="-1"></a>                worksheet.append(row)</span>
<span id="cb8-19"><a href="cluster-selection-in-urban-areas.html#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="cluster-selection-in-urban-areas.html#cb8-20" tabindex="-1"></a>    workbook.save(output_file)</span>
<span id="cb8-21"><a href="cluster-selection-in-urban-areas.html#cb8-21" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;✅ Excel file created: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-22"><a href="cluster-selection-in-urban-areas.html#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="cluster-selection-in-urban-areas.html#cb8-23" tabindex="-1"></a><span class="kw">def</span> add_text_page(pdf_canvas, text):</span>
<span id="cb8-24"><a href="cluster-selection-in-urban-areas.html#cb8-24" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Add text content to PDF canvas&quot;&quot;&quot;</span></span>
<span id="cb8-25"><a href="cluster-selection-in-urban-areas.html#cb8-25" tabindex="-1"></a>    pdf_canvas.setFont(<span class="st">&quot;CourierNew&quot;</span>, <span class="dv">12</span>)</span>
<span id="cb8-26"><a href="cluster-selection-in-urban-areas.html#cb8-26" tabindex="-1"></a>    text_lines <span class="op">=</span> text.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb8-27"><a href="cluster-selection-in-urban-areas.html#cb8-27" tabindex="-1"></a>    y_position <span class="op">=</span> <span class="dv">800</span></span>
<span id="cb8-28"><a href="cluster-selection-in-urban-areas.html#cb8-28" tabindex="-1"></a></span>
<span id="cb8-29"><a href="cluster-selection-in-urban-areas.html#cb8-29" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> text_lines:</span>
<span id="cb8-30"><a href="cluster-selection-in-urban-areas.html#cb8-30" tabindex="-1"></a>        <span class="cf">if</span> y_position <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb8-31"><a href="cluster-selection-in-urban-areas.html#cb8-31" tabindex="-1"></a>            pdf_canvas.showPage()</span>
<span id="cb8-32"><a href="cluster-selection-in-urban-areas.html#cb8-32" tabindex="-1"></a>            pdf_canvas.setFont(<span class="st">&quot;CourierNew&quot;</span>, <span class="dv">12</span>)</span>
<span id="cb8-33"><a href="cluster-selection-in-urban-areas.html#cb8-33" tabindex="-1"></a>            y_position <span class="op">=</span> <span class="dv">800</span></span>
<span id="cb8-34"><a href="cluster-selection-in-urban-areas.html#cb8-34" tabindex="-1"></a>        pdf_canvas.drawString(<span class="dv">72</span>, y_position, line)</span>
<span id="cb8-35"><a href="cluster-selection-in-urban-areas.html#cb8-35" tabindex="-1"></a>        y_position <span class="op">-=</span> <span class="dv">14</span></span>
<span id="cb8-36"><a href="cluster-selection-in-urban-areas.html#cb8-36" tabindex="-1"></a></span>
<span id="cb8-37"><a href="cluster-selection-in-urban-areas.html#cb8-37" tabindex="-1"></a>    pdf_canvas.showPage()</span>
<span id="cb8-38"><a href="cluster-selection-in-urban-areas.html#cb8-38" tabindex="-1"></a></span>
<span id="cb8-39"><a href="cluster-selection-in-urban-areas.html#cb8-39" tabindex="-1"></a><span class="kw">def</span> create_table_pdf(df, output_path):</span>
<span id="cb8-40"><a href="cluster-selection-in-urban-areas.html#cb8-40" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create PDF with table from DataFrame&quot;&quot;&quot;</span></span>
<span id="cb8-41"><a href="cluster-selection-in-urban-areas.html#cb8-41" tabindex="-1"></a>    doc <span class="op">=</span> SimpleDocTemplate(output_path, pagesize<span class="op">=</span>A4)</span>
<span id="cb8-42"><a href="cluster-selection-in-urban-areas.html#cb8-42" tabindex="-1"></a>    table_data <span class="op">=</span> [df.columns.tolist()] <span class="op">+</span> df.values.tolist()</span>
<span id="cb8-43"><a href="cluster-selection-in-urban-areas.html#cb8-43" tabindex="-1"></a>    table <span class="op">=</span> Table(table_data)</span>
<span id="cb8-44"><a href="cluster-selection-in-urban-areas.html#cb8-44" tabindex="-1"></a></span>
<span id="cb8-45"><a href="cluster-selection-in-urban-areas.html#cb8-45" tabindex="-1"></a>    style <span class="op">=</span> TableStyle([</span>
<span id="cb8-46"><a href="cluster-selection-in-urban-areas.html#cb8-46" tabindex="-1"></a>        (<span class="st">&#39;BACKGROUND&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), colors.grey),</span>
<span id="cb8-47"><a href="cluster-selection-in-urban-areas.html#cb8-47" tabindex="-1"></a>        (<span class="st">&#39;TEXTCOLOR&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), colors.whitesmoke),</span>
<span id="cb8-48"><a href="cluster-selection-in-urban-areas.html#cb8-48" tabindex="-1"></a>        (<span class="st">&#39;ALIGN&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">&#39;CENTER&#39;</span>),</span>
<span id="cb8-49"><a href="cluster-selection-in-urban-areas.html#cb8-49" tabindex="-1"></a>        (<span class="st">&#39;FONTNAME&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="st">&#39;CourierNew&#39;</span>),</span>
<span id="cb8-50"><a href="cluster-selection-in-urban-areas.html#cb8-50" tabindex="-1"></a>        (<span class="st">&#39;FONTNAME&#39;</span>, (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">&#39;CourierNew&#39;</span>),</span>
<span id="cb8-51"><a href="cluster-selection-in-urban-areas.html#cb8-51" tabindex="-1"></a>        (<span class="st">&#39;BOTTOMPADDING&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">12</span>),</span>
<span id="cb8-52"><a href="cluster-selection-in-urban-areas.html#cb8-52" tabindex="-1"></a>        (<span class="st">&#39;BACKGROUND&#39;</span>, (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), colors.white),</span>
<span id="cb8-53"><a href="cluster-selection-in-urban-areas.html#cb8-53" tabindex="-1"></a>        (<span class="st">&#39;GRID&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="dv">1</span>, colors.black),</span>
<span id="cb8-54"><a href="cluster-selection-in-urban-areas.html#cb8-54" tabindex="-1"></a>    ])</span>
<span id="cb8-55"><a href="cluster-selection-in-urban-areas.html#cb8-55" tabindex="-1"></a></span>
<span id="cb8-56"><a href="cluster-selection-in-urban-areas.html#cb8-56" tabindex="-1"></a>    table.setStyle(style)</span>
<span id="cb8-57"><a href="cluster-selection-in-urban-areas.html#cb8-57" tabindex="-1"></a>    doc.build([table])</span>
<span id="cb8-58"><a href="cluster-selection-in-urban-areas.html#cb8-58" tabindex="-1"></a></span>
<span id="cb8-59"><a href="cluster-selection-in-urban-areas.html#cb8-59" tabindex="-1"></a><span class="kw">def</span> format_excluded_combinations(excluded_dict):</span>
<span id="cb8-60"><a href="cluster-selection-in-urban-areas.html#cb8-60" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Format excluded combinations for display&quot;&quot;&quot;</span></span>
<span id="cb8-61"><a href="cluster-selection-in-urban-areas.html#cb8-61" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> excluded_dict:</span>
<span id="cb8-62"><a href="cluster-selection-in-urban-areas.html#cb8-62" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;No IV Units were excluded based on the frequency criteria.</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb8-63"><a href="cluster-selection-in-urban-areas.html#cb8-63" tabindex="-1"></a></span>
<span id="cb8-64"><a href="cluster-selection-in-urban-areas.html#cb8-64" tabindex="-1"></a>    formatted_text <span class="op">=</span> <span class="st">&quot;District wise excluded IV Units:</span><span class="ch">\n\n</span><span class="st">&quot;</span></span>
<span id="cb8-65"><a href="cluster-selection-in-urban-areas.html#cb8-65" tabindex="-1"></a>    <span class="cf">for</span> district, exclusions <span class="kw">in</span> excluded_dict.items():</span>
<span id="cb8-66"><a href="cluster-selection-in-urban-areas.html#cb8-66" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="ss">f&quot;District Code: </span><span class="sc">{</span>district<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb8-67"><a href="cluster-selection-in-urban-areas.html#cb8-67" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;Town_Code   || IV_Unit_No</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb8-68"><a href="cluster-selection-in-urban-areas.html#cb8-68" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">25</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb8-69"><a href="cluster-selection-in-urban-areas.html#cb8-69" tabindex="-1"></a>        <span class="cf">for</span> town_code, iv_unit_no <span class="kw">in</span> exclusions:</span>
<span id="cb8-70"><a href="cluster-selection-in-urban-areas.html#cb8-70" tabindex="-1"></a>            formatted_text <span class="op">+=</span> <span class="ss">f&quot;</span><span class="sc">{</span>town_code<span class="sc">:&lt;10}</span><span class="ss"> || </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb8-71"><a href="cluster-selection-in-urban-areas.html#cb8-71" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb8-72"><a href="cluster-selection-in-urban-areas.html#cb8-72" tabindex="-1"></a>    <span class="cf">return</span> formatted_text</span></code></pre></div>
</details>
<div class="results">
<p>📋 <strong>RESULT SUMMARY</strong></p>
<ul>
<li><strong>State Name:</strong> Goa<br />
</li>
<li><strong>State Code:</strong> 30<br />
</li>
<li><strong>District Codes:</strong> 01, 02<br />
</li>
<li><strong>Total Clusters Requested:</strong> 131<br />
</li>
<li><strong>Total Clusters Allocated:</strong> 132<br />
</li>
<li><strong>Exclusion Applied:</strong> Yes</li>
</ul>
</div>
<hr />
<p>📊 <strong>Cluster Allocation by District</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
<th>No_of_Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
<td>14</td>
<td>0.4375</td>
<td>58</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
<td>18</td>
<td>0.5625</td>
<td>74</td>
</tr>
</tbody>
</table>
</div>
<div id="result-summary-and-sampling-preparation" class="section level2 hasAnchor">
<h2>Result Summary and Sampling Preparation<a href="cluster-selection-in-urban-areas.html#result-summary-and-sampling-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step creates a comprehensive summary of the sampling plan and prepares for execution:</p>
<p><strong>Summary Components:</strong></p>
<p>1. <strong>Metadata</strong>: State name, state code, selected districts</p>
<p>2. <strong>Allocation Summary</strong>: Target vs. allocated clusters</p>
<p>3. <strong>Quality Control</strong>: Documentation of exclusions applied</p>
<p>4. <strong>District Breakdown</strong>: Detailed allocation table</p>
<p><strong>Iteration Setup:</strong></p>
<p>- <strong>Multiple Samples</strong>: Allows generation of multiple independent samples</p>
<p>- <strong>Reproducibility</strong>: Each iteration creates a different random sample</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="cluster-selection-in-urban-areas.html#cb9-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb9-2"><a href="cluster-selection-in-urban-areas.html#cb9-2" tabindex="-1"></a><span class="co"># STEP 5: PREPARE RESULT SUMMARY</span></span>
<span id="cb9-3"><a href="cluster-selection-in-urban-areas.html#cb9-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb9-4"><a href="cluster-selection-in-urban-areas.html#cb9-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb9-5"><a href="cluster-selection-in-urban-areas.html#cb9-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 5: PREPARING RESULT SUMMARY&quot;</span>)</span>
<span id="cb9-6"><a href="cluster-selection-in-urban-areas.html#cb9-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb9-7"><a href="cluster-selection-in-urban-areas.html#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="cluster-selection-in-urban-areas.html#cb9-8" tabindex="-1"></a>result_string <span class="op">=</span> []</span>
<span id="cb9-9"><a href="cluster-selection-in-urban-areas.html#cb9-9" tabindex="-1"></a>result_string.append(<span class="st">&#39;</span><span class="ch">\n\n</span><span class="st">RESULT SUMMARY&#39;</span>)</span>
<span id="cb9-10"><a href="cluster-selection-in-urban-areas.html#cb9-10" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;State Name: </span><span class="sc">{</span>df<span class="sc">.</span>iloc[<span class="dv">0</span>, <span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-11"><a href="cluster-selection-in-urban-areas.html#cb9-11" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;State Code: </span><span class="sc">{</span>df<span class="sc">.</span>iloc[<span class="dv">0</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-12"><a href="cluster-selection-in-urban-areas.html#cb9-12" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;District Codes: </span><span class="sc">{</span><span class="st">&quot; &quot;</span><span class="sc">.</span>join(D_Code_list)<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-13"><a href="cluster-selection-in-urban-areas.html#cb9-13" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Total Clusters Requested: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-14"><a href="cluster-selection-in-urban-areas.html#cb9-14" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Total Clusters Allocated: </span><span class="sc">{</span>total_allocated<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-15"><a href="cluster-selection-in-urban-areas.html#cb9-15" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Exclusion Applied: </span><span class="sc">{</span><span class="st">&quot;Yes&quot;</span> <span class="cf">if</span> Excluder <span class="cf">else</span> <span class="st">&quot;No&quot;</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-16"><a href="cluster-selection-in-urban-areas.html#cb9-16" tabindex="-1"></a>result_string.append(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;-&#39;</span><span class="op">*</span><span class="dv">55</span>)</span>
<span id="cb9-17"><a href="cluster-selection-in-urban-areas.html#cb9-17" tabindex="-1"></a>result_string.append(result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb9-18"><a href="cluster-selection-in-urban-areas.html#cb9-18" tabindex="-1"></a></span>
<span id="cb9-19"><a href="cluster-selection-in-urban-areas.html#cb9-19" tabindex="-1"></a>final_result <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(result_string)</span>
<span id="cb9-20"><a href="cluster-selection-in-urban-areas.html#cb9-20" tabindex="-1"></a><span class="bu">print</span>(final_result)</span>
<span id="cb9-21"><a href="cluster-selection-in-urban-areas.html#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="cluster-selection-in-urban-areas.html#cb9-22" tabindex="-1"></a><span class="co"># Get number of sample iterations from user</span></span>
<span id="cb9-23"><a href="cluster-selection-in-urban-areas.html#cb9-23" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Enter number of sample iterations to generate (usually 1): &quot;</span>) <span class="kw">or</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb9-24"><a href="cluster-selection-in-urban-areas.html#cb9-24" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🔄 Will generate </span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss"> independent sample(s)&quot;</span>)</span></code></pre></div>
</details>
</div>
<div id="random-cluster-sampling-implementation" class="section level2 hasAnchor">
<h2>Random Cluster Sampling Implementation<a href="cluster-selection-in-urban-areas.html#random-cluster-sampling-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="two-stage-sampling-process" class="section level3 hasAnchor">
<h3>Two-Stage Sampling Process<a href="cluster-selection-in-urban-areas.html#two-stage-sampling-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Stage 1: IV Unit Selection</strong><br />
- Random selection of IV Units from each district<br />
- Uses allocated cluster counts from Step 4<br />
- Implements replacement logic when needed</p>
<p><strong>Stage 2: Block Selection</strong><br />
- Within selected IV Units, randomly samples UFS blocks<br />
- Ensures actual sample size matches allocation</p>
<hr />
</div>
<div id="procedure-for-sampling-iv-units" class="section level3 hasAnchor">
<h3>Procedure for Sampling IV Units<a href="cluster-selection-in-urban-areas.html#procedure-for-sampling-iv-units" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><strong>When sufficient IV units are available</strong>
<ul>
<li>If the number of IV units (<code>num_iv_units</code>) is greater than or equal to the required number of clusters (<code>num_clusters_for_district</code>),<br />
</li>
<li>A random sample of the required size is drawn <strong>without replacement</strong>, ensuring no IV unit is selected more than once.</li>
</ul></li>
<li><strong>When insufficient IV units are available</strong>
<ul>
<li>If the number of available IV units is less than the required number of clusters,<br />
</li>
<li>First, all available IV units are selected <strong>without replacement</strong>.<br />
</li>
<li>Then, the remaining IV units needed to reach the required number of clusters are drawn <strong>with replacement</strong>, allowing some IV units to be selected more than once.</li>
</ul></li>
</ol>
<hr />
</div>
<div id="frequency-of-iv-unit-selection-and-block-sampling" class="section level3 hasAnchor">
<h3>Frequency of IV Unit Selection and Block Sampling<a href="cluster-selection-in-urban-areas.html#frequency-of-iv-unit-selection-and-block-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The frequency of IV unit selection determines how many blocks must be sampled from that IV unit.<br />
</li>
<li><strong>Without replacement case:</strong> When there are enough IV units, only one block is sampled per IV unit.<br />
</li>
<li><strong>With replacement case:</strong> Since some IV units are selected more than once, multiple blocks must be sampled from those IV units.</li>
</ul>
<p>For each IV unit selected:<br />
- The total number of blocks available is checked.<br />
- If the number of available blocks is <strong>greater than or equal</strong> to the required frequency, exactly that many blocks are sampled <strong>without replacement</strong>.<br />
- If the number of available blocks is <strong>less than</strong> the required frequency, all available blocks are taken. However, this did not occur in any case, as having a minimum of 20 blocks per IV unit was sufficient in all situations.</p>
</div>
<div id="importance-of-exclusion-and-combined-sampling-strategy" class="section level3 hasAnchor">
<h3>Importance of Exclusion and Combined Sampling Strategy<a href="cluster-selection-in-urban-areas.html#importance-of-exclusion-and-combined-sampling-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The <strong>exclusion condition</strong> defined earlier is essential, because if an IV unit does not have enough blocks, proper sampling cannot be carried out.<br />
</li>
<li>The <strong>combination of with- and without-replacement sampling</strong> ensures maximum representativeness of IV units.<br />
</li>
<li>In some cases, this approach includes <strong>all IV units</strong> in the sampling process, improving district coverage.</li>
</ul>
<p><strong>Output:</strong> Dictionary of selected clusters organized by district, ready for geocoding and reporting.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="cluster-selection-in-urban-areas.html#cb10-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb10-2"><a href="cluster-selection-in-urban-areas.html#cb10-2" tabindex="-1"></a><span class="co"># STEP 6: CLUSTER SAMPLING AND REPORT GENERATION</span></span>
<span id="cb10-3"><a href="cluster-selection-in-urban-areas.html#cb10-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb10-4"><a href="cluster-selection-in-urban-areas.html#cb10-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb10-5"><a href="cluster-selection-in-urban-areas.html#cb10-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 6: CLUSTER SAMPLING AND REPORT GENERATION&quot;</span>)</span>
<span id="cb10-6"><a href="cluster-selection-in-urban-areas.html#cb10-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb10-7"><a href="cluster-selection-in-urban-areas.html#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="cluster-selection-in-urban-areas.html#cb10-8" tabindex="-1"></a><span class="cf">for</span> z <span class="kw">in</span> <span class="bu">range</span>(multiplier):</span>
<span id="cb10-9"><a href="cluster-selection-in-urban-areas.html#cb10-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔄 Processing iteration </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-10"><a href="cluster-selection-in-urban-areas.html#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="cluster-selection-in-urban-areas.html#cb10-11" tabindex="-1"></a>    selected_clusters <span class="op">=</span> {}</span>
<span id="cb10-12"><a href="cluster-selection-in-urban-areas.html#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="cluster-selection-in-urban-areas.html#cb10-13" tabindex="-1"></a>    <span class="co"># Sample clusters for each district</span></span>
<span id="cb10-14"><a href="cluster-selection-in-urban-areas.html#cb10-14" tabindex="-1"></a>    <span class="cf">for</span> district_code, row <span class="kw">in</span> unique_iv_unit_counts.iterrows():</span>
<span id="cb10-15"><a href="cluster-selection-in-urban-areas.html#cb10-15" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📍 Sampling for District: </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-16"><a href="cluster-selection-in-urban-areas.html#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="cluster-selection-in-urban-areas.html#cb10-17" tabindex="-1"></a>        num_clusters_for_district <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">&#39;No_of_Cluster&#39;</span>])</span>
<span id="cb10-18"><a href="cluster-selection-in-urban-areas.html#cb10-18" tabindex="-1"></a>        num_iv_units <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">&#39;IV_Unit_No&#39;</span>])</span>
<span id="cb10-19"><a href="cluster-selection-in-urban-areas.html#cb10-19" tabindex="-1"></a></span>
<span id="cb10-20"><a href="cluster-selection-in-urban-areas.html#cb10-20" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   🎯 Target clusters: </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-21"><a href="cluster-selection-in-urban-areas.html#cb10-21" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   📊 Available IV units: </span><span class="sc">{</span>num_iv_units<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-22"><a href="cluster-selection-in-urban-areas.html#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="cluster-selection-in-urban-areas.html#cb10-23" tabindex="-1"></a>        <span class="co"># Get data for this district</span></span>
<span id="cb10-24"><a href="cluster-selection-in-urban-areas.html#cb10-24" tabindex="-1"></a>        district_df <span class="op">=</span> filtered_df1[filtered_df1[<span class="st">&#39;D_Code&#39;</span>] <span class="op">==</span> district_code]</span>
<span id="cb10-25"><a href="cluster-selection-in-urban-areas.html#cb10-25" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   📊 District data rows: </span><span class="sc">{</span><span class="bu">len</span>(district_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-26"><a href="cluster-selection-in-urban-areas.html#cb10-26" tabindex="-1"></a></span>
<span id="cb10-27"><a href="cluster-selection-in-urban-areas.html#cb10-27" tabindex="-1"></a>        <span class="co"># Get unique IV units in this district</span></span>
<span id="cb10-28"><a href="cluster-selection-in-urban-areas.html#cb10-28" tabindex="-1"></a>        unique_df <span class="op">=</span> district_df.drop_duplicates(subset<span class="op">=</span>[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>])[[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]]</span>
<span id="cb10-29"><a href="cluster-selection-in-urban-areas.html#cb10-29" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   📊 Unique IV units available: </span><span class="sc">{</span><span class="bu">len</span>(unique_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-30"><a href="cluster-selection-in-urban-areas.html#cb10-30" tabindex="-1"></a></span>
<span id="cb10-31"><a href="cluster-selection-in-urban-areas.html#cb10-31" tabindex="-1"></a>        <span class="co"># Sample IV units (with or without replacement)</span></span>
<span id="cb10-32"><a href="cluster-selection-in-urban-areas.html#cb10-32" tabindex="-1"></a>        <span class="cf">if</span> num_iv_units <span class="op">&gt;=</span> num_clusters_for_district:</span>
<span id="cb10-33"><a href="cluster-selection-in-urban-areas.html#cb10-33" tabindex="-1"></a>            sampled_df <span class="op">=</span> unique_df.sample(n<span class="op">=</span>num_clusters_for_district, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-34"><a href="cluster-selection-in-urban-areas.html#cb10-34" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   ✅ Sampled </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss"> IV units without replacement&quot;</span>)</span>
<span id="cb10-35"><a href="cluster-selection-in-urban-areas.html#cb10-35" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-36"><a href="cluster-selection-in-urban-areas.html#cb10-36" tabindex="-1"></a>            sampled_df <span class="op">=</span> pd.concat([</span>
<span id="cb10-37"><a href="cluster-selection-in-urban-areas.html#cb10-37" tabindex="-1"></a>                unique_df.sample(n<span class="op">=</span>unique_df.shape[<span class="dv">0</span>], replace<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb10-38"><a href="cluster-selection-in-urban-areas.html#cb10-38" tabindex="-1"></a>                unique_df.sample(n<span class="op">=</span>num_clusters_for_district <span class="op">-</span> unique_df.shape[<span class="dv">0</span>], replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-39"><a href="cluster-selection-in-urban-areas.html#cb10-39" tabindex="-1"></a>            ])</span>
<span id="cb10-40"><a href="cluster-selection-in-urban-areas.html#cb10-40" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   ⚠️  Sampled with replacement (needed </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss">, had </span><span class="sc">{</span>num_iv_units<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb10-41"><a href="cluster-selection-in-urban-areas.html#cb10-41" tabindex="-1"></a></span>
<span id="cb10-42"><a href="cluster-selection-in-urban-areas.html#cb10-42" tabindex="-1"></a>        <span class="co"># Count frequency of selected IV units</span></span>
<span id="cb10-43"><a href="cluster-selection-in-urban-areas.html#cb10-43" tabindex="-1"></a>        frequency_df <span class="op">=</span> sampled_df.groupby([<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb10-44"><a href="cluster-selection-in-urban-areas.html#cb10-44" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   📊 IV unit frequency distribution:&quot;</span>)</span>
<span id="cb10-45"><a href="cluster-selection-in-urban-areas.html#cb10-45" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;      </span><span class="sc">{</span>frequency_df<span class="sc">.</span>to_string(index<span class="op">=</span><span class="va">False</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-46"><a href="cluster-selection-in-urban-areas.html#cb10-46" tabindex="-1"></a></span>
<span id="cb10-47"><a href="cluster-selection-in-urban-areas.html#cb10-47" tabindex="-1"></a>        <span class="co"># Sample UFS blocks from selected IV units</span></span>
<span id="cb10-48"><a href="cluster-selection-in-urban-areas.html#cb10-48" tabindex="-1"></a>        UFS_samples <span class="op">=</span> []</span>
<span id="cb10-49"><a href="cluster-selection-in-urban-areas.html#cb10-49" tabindex="-1"></a>        <span class="cf">for</span> _, row2 <span class="kw">in</span> frequency_df.iterrows():</span>
<span id="cb10-50"><a href="cluster-selection-in-urban-areas.html#cb10-50" tabindex="-1"></a>            t_code <span class="op">=</span> row2[<span class="st">&#39;T_Code&#39;</span>]</span>
<span id="cb10-51"><a href="cluster-selection-in-urban-areas.html#cb10-51" tabindex="-1"></a>            iv_unit_no <span class="op">=</span> row2[<span class="st">&#39;IV_Unit_No&#39;</span>]</span>
<span id="cb10-52"><a href="cluster-selection-in-urban-areas.html#cb10-52" tabindex="-1"></a>            freq <span class="op">=</span> row2[<span class="st">&#39;Frequency&#39;</span>]</span>
<span id="cb10-53"><a href="cluster-selection-in-urban-areas.html#cb10-53" tabindex="-1"></a></span>
<span id="cb10-54"><a href="cluster-selection-in-urban-areas.html#cb10-54" tabindex="-1"></a>            <span class="co"># Get all blocks for this IV unit</span></span>
<span id="cb10-55"><a href="cluster-selection-in-urban-areas.html#cb10-55" tabindex="-1"></a>            available_blocks <span class="op">=</span> district_df[(district_df[<span class="st">&#39;T_Code&#39;</span>] <span class="op">==</span> t_code) <span class="op">&amp;</span> (district_df[<span class="st">&#39;IV_Unit_No&#39;</span>] <span class="op">==</span> iv_unit_no)]</span>
<span id="cb10-56"><a href="cluster-selection-in-urban-areas.html#cb10-56" tabindex="-1"></a>            N <span class="op">=</span> available_blocks.shape[<span class="dv">0</span>]</span>
<span id="cb10-57"><a href="cluster-selection-in-urban-areas.html#cb10-57" tabindex="-1"></a></span>
<span id="cb10-58"><a href="cluster-selection-in-urban-areas.html#cb10-58" tabindex="-1"></a>            <span class="co"># Sample blocks (cannot sample more than available)</span></span>
<span id="cb10-59"><a href="cluster-selection-in-urban-areas.html#cb10-59" tabindex="-1"></a>            <span class="cf">if</span> N <span class="op">&lt;</span> freq:</span>
<span id="cb10-60"><a href="cluster-selection-in-urban-areas.html#cb10-60" tabindex="-1"></a>                UFS_sample <span class="op">=</span> available_blocks.sample(n<span class="op">=</span>N, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-61"><a href="cluster-selection-in-urban-areas.html#cb10-61" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   ⚠️  Town </span><span class="sc">{</span>t_code<span class="sc">}</span><span class="ss">, IV </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ss">: sampled </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> blocks (needed </span><span class="sc">{</span>freq<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb10-62"><a href="cluster-selection-in-urban-areas.html#cb10-62" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-63"><a href="cluster-selection-in-urban-areas.html#cb10-63" tabindex="-1"></a>                UFS_sample <span class="op">=</span> available_blocks.sample(n<span class="op">=</span>freq, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-64"><a href="cluster-selection-in-urban-areas.html#cb10-64" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   ✅ Town </span><span class="sc">{</span>t_code<span class="sc">}</span><span class="ss">, IV </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ss">: sampled </span><span class="sc">{</span>freq<span class="sc">}</span><span class="ss"> blocks from </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> available&quot;</span>)</span>
<span id="cb10-65"><a href="cluster-selection-in-urban-areas.html#cb10-65" tabindex="-1"></a></span>
<span id="cb10-66"><a href="cluster-selection-in-urban-areas.html#cb10-66" tabindex="-1"></a>            UFS_samples.append(UFS_sample)</span>
<span id="cb10-67"><a href="cluster-selection-in-urban-areas.html#cb10-67" tabindex="-1"></a></span>
<span id="cb10-68"><a href="cluster-selection-in-urban-areas.html#cb10-68" tabindex="-1"></a>        <span class="co"># Combine all samples for this district</span></span>
<span id="cb10-69"><a href="cluster-selection-in-urban-areas.html#cb10-69" tabindex="-1"></a>        selected_clusters[district_code] <span class="op">=</span> pd.concat(UFS_samples, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-70"><a href="cluster-selection-in-urban-areas.html#cb10-70" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   📊 Total selected blocks for district: </span><span class="sc">{</span><span class="bu">len</span>(selected_clusters[district_code])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-71"><a href="cluster-selection-in-urban-areas.html#cb10-71" tabindex="-1"></a>        </span>
<span id="cb10-72"><a href="cluster-selection-in-urban-areas.html#cb10-72" tabindex="-1"></a>    <span class="co"># Show summary of this iteration</span></span>
<span id="cb10-73"><a href="cluster-selection-in-urban-areas.html#cb10-73" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">✅ ITERATION </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> SAMPLING COMPLETE&quot;</span>)</span>
<span id="cb10-74"><a href="cluster-selection-in-urban-areas.html#cb10-74" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📊 Summary of selected clusters:&quot;</span>)</span>
<span id="cb10-75"><a href="cluster-selection-in-urban-areas.html#cb10-75" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb10-76"><a href="cluster-selection-in-urban-areas.html#cb10-76" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(df_dist)<span class="sc">}</span><span class="ss"> clusters selected&quot;</span>)</span></code></pre></div>
</details>
<p>🔄 Sampling Iteration Results</p>
<p><strong>Number of iterations:</strong> 1</p>
<hr />
<p>📍 <strong>District 01 — North Goa</strong></p>
<ul>
<li>🎯 <strong>Target clusters:</strong> 58<br />
</li>
<li>📊 <strong>Available IV units:</strong> 14<br />
</li>
<li>📊 <strong>District data rows:</strong> 370<br />
</li>
<li>📊 <strong>Unique IV units available:</strong> 14<br />
</li>
<li>⚠️ Sampled <strong>with replacement</strong> (needed 58, had 14)</li>
</ul>
<p>📊 <strong>IV Unit Frequency Distribution (Result of SRS)</strong></p>
<table>
<thead>
<tr class="header">
<th>T_Code</th>
<th>IV_Unit_No</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>003</td>
<td>0001</td>
<td>1</td>
</tr>
<tr class="even">
<td>004</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>005</td>
<td>0001</td>
<td>2</td>
</tr>
<tr class="even">
<td>006</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>014</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="odd">
<td>016</td>
<td>0004</td>
<td>5</td>
</tr>
<tr class="even">
<td>018</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="odd">
<td>020</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>036</td>
<td>0001</td>
<td>2</td>
</tr>
<tr class="odd">
<td>037</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="even">
<td>041</td>
<td>0001</td>
<td>8</td>
</tr>
<tr class="odd">
<td>043</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="even">
<td>047</td>
<td>0001</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>✅ <strong>Block Sampling Summary</strong><br />
- Town 003, IV 0001 → 1 / 20 blocks<br />
- Town 004, IV 0001 → 3 / 23 blocks<br />
- Town 005, IV 0001 → 2 / 28 blocks<br />
- Town 006, IV 0001 → 7 / 20 blocks<br />
- Town 009, IV 0001 → 5 / 23 blocks<br />
- Town 014, IV 0001 → 4 / 31 blocks<br />
- Town 016, IV 0004 → 5 / 32 blocks<br />
- Town 018, IV 0001 → 7 / 39 blocks<br />
- Town 020, IV 0001 → 5 / 29 blocks<br />
- Town 036, IV 0001 → 2 / 30 blocks<br />
- Town 037, IV 0001 → 3 / 21 blocks<br />
- Town 041, IV 0001 → 8 / 29 blocks<br />
- Town 043, IV 0001 → 4 / 25 blocks<br />
- Town 047, IV 0001 → 2 / 20 blocks</p>
<p>📊 <strong>Total selected blocks:</strong> 58</p>
<hr />
<p>📍 <strong>District 02 — South Goa</strong></p>
<ul>
<li>🎯 <strong>Target clusters:</strong> 74<br />
</li>
<li>📊 <strong>Available IV units:</strong> 18<br />
</li>
<li>📊 <strong>District data rows:</strong> 520<br />
</li>
<li>📊 <strong>Unique IV units available:</strong> 18<br />
</li>
<li>⚠️ Sampled <strong>with replacement</strong> (needed 74, had 18)</li>
</ul>
<p>📊 <strong>IV Unit Frequency Distribution (Result of SRS)</strong></p>
<table>
<thead>
<tr class="header">
<th>T_Code</th>
<th>IV_Unit_No</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>003</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="even">
<td>004</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="odd">
<td>006</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="even">
<td>007</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>008</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="even">
<td>009</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0003</td>
<td>6</td>
</tr>
<tr class="even">
<td>009</td>
<td>0004</td>
<td>4</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0005</td>
<td>2</td>
</tr>
<tr class="even">
<td>009</td>
<td>0006</td>
<td>4</td>
</tr>
<tr class="odd">
<td>010</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>010</td>
<td>0003</td>
<td>5</td>
</tr>
<tr class="odd">
<td>010</td>
<td>0004</td>
<td>7</td>
</tr>
<tr class="even">
<td>010</td>
<td>0005</td>
<td>1</td>
</tr>
<tr class="odd">
<td>012</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>013</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>019</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>021</td>
<td>0001</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>✅ <strong>Block Sampling Summary</strong><br />
- Town 003, IV 0001 → 3 / 23 blocks<br />
- Town 004, IV 0001 → 4 / 21 blocks<br />
- Town 006, IV 0001 → 7 / 25 blocks<br />
- Town 007, IV 0001 → 3 / 31 blocks<br />
- Town 008, IV 0001 → 4 / 24 blocks<br />
- Town 009, IV 0001 → 3 / 32 blocks<br />
- Town 009, IV 0003 → 6 / 25 blocks<br />
- Town 009, IV 0004 → 4 / 46 blocks<br />
- Town 009, IV 0005 → 2 / 29 blocks<br />
- Town 009, IV 0006 → 4 / 33 blocks<br />
- Town 010, IV 0001 → 5 / 32 blocks<br />
- Town 010, IV 0003 → 5 / 24 blocks<br />
- Town 010, IV 0004 → 7 / 38 blocks<br />
- Town 010, IV 0005 → 1 / 32 blocks<br />
- Town 012, IV 0001 → 5 / 22 blocks<br />
- Town 013, IV 0001 → 3 / 30 blocks<br />
- Town 019, IV 0001 → 5 / 29 blocks<br />
- Town 021, IV 0001 → 3 / 24 blocks</p>
<p>📊 <strong>Total selected blocks:</strong> 74</p>
</div>
</div>
<div id="geographic-coordinate-assignment-geocoding" class="section level2 hasAnchor">
<h2>Geographic Coordinate Assignment (Geocoding)<a href="cluster-selection-in-urban-areas.html#geographic-coordinate-assignment-geocoding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step adds spatial coordinates to enable mapping and geographic analysis:</p>
<p><strong>Geocoding Process:</strong></p>
<p>1. <strong>Location Query</strong>: Constructs queries using “Town, District, State” format</p>
<p>2. <strong>Service Provider</strong>: Uses ArcGIS geocoding service via geopy library</p>
<p>3. <strong>Coordinate Extraction</strong>: Retrieves latitude and longitude for each location</p>
<p>4. <strong>Error Handling</strong>: Manages failed geocoding attempts gracefully</p>
<p><strong>Data Enhancement:</strong> - <strong>Spatial Coordinates</strong>: Adds <code>Latitude</code> and <code>Longitude</code> columns - <strong>Quality Reporting</strong>: Tracks successful vs. failed geocoding attempts - <strong>Coverage Analysis</strong>: Reports geocoding success rates by district</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="cluster-selection-in-urban-areas.html#cb11-1" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb11-2"><a href="cluster-selection-in-urban-areas.html#cb11-2" tabindex="-1"></a>    <span class="co"># STEP 7: GEOCODING</span></span>
<span id="cb11-3"><a href="cluster-selection-in-urban-areas.html#cb11-3" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb11-4"><a href="cluster-selection-in-urban-areas.html#cb11-4" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🌍 STEP 7: GEOCODING SELECTED LOCATIONS&quot;</span>)</span>
<span id="cb11-5"><a href="cluster-selection-in-urban-areas.html#cb11-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb11-6"><a href="cluster-selection-in-urban-areas.html#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="cluster-selection-in-urban-areas.html#cb11-7" tabindex="-1"></a>    locator <span class="op">=</span> geopy.geocoders.ArcGIS(user_agent<span class="op">=</span><span class="st">&quot;mygeocoder&quot;</span>)</span>
<span id="cb11-8"><a href="cluster-selection-in-urban-areas.html#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="cluster-selection-in-urban-areas.html#cb11-9" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb11-10"><a href="cluster-selection-in-urban-areas.html#cb11-10" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df_dist.empty:</span>
<span id="cb11-11"><a href="cluster-selection-in-urban-areas.html#cb11-11" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📍 Geocoding for District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb11-12"><a href="cluster-selection-in-urban-areas.html#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="cluster-selection-in-urban-areas.html#cb11-13" tabindex="-1"></a>            <span class="cf">for</span> index, row <span class="kw">in</span> df_dist.iterrows():</span>
<span id="cb11-14"><a href="cluster-selection-in-urban-areas.html#cb11-14" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb11-15"><a href="cluster-selection-in-urban-areas.html#cb11-15" tabindex="-1"></a>                    <span class="co"># Create location query using town, district, and state</span></span>
<span id="cb11-16"><a href="cluster-selection-in-urban-areas.html#cb11-16" tabindex="-1"></a>                    location_query <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>row[<span class="st">&#39;District&#39;</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb11-17"><a href="cluster-selection-in-urban-areas.html#cb11-17" tabindex="-1"></a>                    location <span class="op">=</span> locator.geocode(location_query)</span>
<span id="cb11-18"><a href="cluster-selection-in-urban-areas.html#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="cluster-selection-in-urban-areas.html#cb11-19" tabindex="-1"></a>                    <span class="cf">if</span> location:</span>
<span id="cb11-20"><a href="cluster-selection-in-urban-areas.html#cb11-20" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> location.latitude</span>
<span id="cb11-21"><a href="cluster-selection-in-urban-areas.html#cb11-21" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> location.longitude</span>
<span id="cb11-22"><a href="cluster-selection-in-urban-areas.html#cb11-22" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;   ✅ </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: (</span><span class="sc">{</span>location<span class="sc">.</span>latitude<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>location<span class="sc">.</span>longitude<span class="sc">:.4f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb11-23"><a href="cluster-selection-in-urban-areas.html#cb11-23" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb11-24"><a href="cluster-selection-in-urban-areas.html#cb11-24" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-25"><a href="cluster-selection-in-urban-areas.html#cb11-25" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-26"><a href="cluster-selection-in-urban-areas.html#cb11-26" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;   ❌ </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: Location not found&quot;</span>)</span>
<span id="cb11-27"><a href="cluster-selection-in-urban-areas.html#cb11-27" tabindex="-1"></a></span>
<span id="cb11-28"><a href="cluster-selection-in-urban-areas.html#cb11-28" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb11-29"><a href="cluster-selection-in-urban-areas.html#cb11-29" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;   ❌ Error geocoding </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-30"><a href="cluster-selection-in-urban-areas.html#cb11-30" tabindex="-1"></a>                    df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-31"><a href="cluster-selection-in-urban-areas.html#cb11-31" tabindex="-1"></a>                    df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-32"><a href="cluster-selection-in-urban-areas.html#cb11-32" tabindex="-1"></a>                    </span>
<span id="cb11-33"><a href="cluster-selection-in-urban-areas.html#cb11-33" tabindex="-1"></a>            <span class="co"># Show geocoding summary for this district</span></span>
<span id="cb11-34"><a href="cluster-selection-in-urban-areas.html#cb11-34" tabindex="-1"></a>            geocoded_count <span class="op">=</span> df_dist[<span class="st">&#39;Latitude&#39;</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb11-35"><a href="cluster-selection-in-urban-areas.html#cb11-35" tabindex="-1"></a>            total_count <span class="op">=</span> <span class="bu">len</span>(df_dist)</span>
<span id="cb11-36"><a href="cluster-selection-in-urban-areas.html#cb11-36" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   📊 Geocoded </span><span class="sc">{</span>geocoded_count<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total_count<span class="sc">}</span><span class="ss"> locations (</span><span class="sc">{</span>geocoded_count<span class="op">/</span>total_count<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span></code></pre></div>
</details>
</div>
<div id="output-generation-and-final-documentation" class="section level2 hasAnchor">
<h2>Output Generation and Final Documentation<a href="cluster-selection-in-urban-areas.html#output-generation-and-final-documentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This final step generates comprehensive outputs and provides project completion summary:</p>
<p><strong>Output Files Generated:</strong></p>
<p>1. <strong>Excel Reports</strong>: Multi-sheet workbooks with one sheet per district - Contains all selected cluster details - Includes geographic coordinates - Formatted for field use</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Directory Structure</strong>: Creates organized folder system
<ul>
<li><code>map/</code>: Reserved for mapping outputs</li>
<li><code>temp/</code>: Temporary processing files</li>
<li><code>GIS/</code>: Geospatial data files</li>
</ul></li>
</ol>
<p><strong>Quality Assurance:</strong> - <strong>Sample Verification</strong>: Displays sample of selected clusters - <strong>Count Validation</strong>: Verifies cluster counts match allocation - <strong>Coordinate Check</strong>: Shows geocoding success rates</p>
<p><strong>Final Summary:</strong> - <strong>Iteration Tracking</strong>: Documents number of independent samples generated - <strong>File Naming</strong>: Uses standardized naming convention with state identifiers - <strong>Performance Metrics</strong>: Reports total clusters and processing statistics</p>
<p><strong>Deliverables:</strong> Ready-to-use cluster sampling results for urban survey implementation, complete with coordinates and detailed documentation for field teams.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="cluster-selection-in-urban-areas.html#cb12-1" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb12-2"><a href="cluster-selection-in-urban-areas.html#cb12-2" tabindex="-1"></a>    <span class="co"># STEP 8: GENERATE OUTPUT FILES</span></span>
<span id="cb12-3"><a href="cluster-selection-in-urban-areas.html#cb12-3" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb12-4"><a href="cluster-selection-in-urban-areas.html#cb12-4" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📄 STEP 8: GENERATING OUTPUT FILES&quot;</span>)</span>
<span id="cb12-5"><a href="cluster-selection-in-urban-areas.html#cb12-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb12-6"><a href="cluster-selection-in-urban-areas.html#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="cluster-selection-in-urban-areas.html#cb12-7" tabindex="-1"></a>    <span class="co"># Generate Excel output</span></span>
<span id="cb12-8"><a href="cluster-selection-in-urban-areas.html#cb12-8" tabindex="-1"></a>    excel_filename <span class="op">=</span> <span class="ss">f&quot;Urban Report[EXCEL-</span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">]-</span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">.xlsx&quot;</span></span>
<span id="cb12-9"><a href="cluster-selection-in-urban-areas.html#cb12-9" tabindex="-1"></a>    extract_clusters_to_excel(selected_clusters, output_file<span class="op">=</span>excel_filename)</span>
<span id="cb12-10"><a href="cluster-selection-in-urban-areas.html#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="cluster-selection-in-urban-areas.html#cb12-11" tabindex="-1"></a>    <span class="co"># Create directories if they don&#39;t exist</span></span>
<span id="cb12-12"><a href="cluster-selection-in-urban-areas.html#cb12-12" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;map&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-13"><a href="cluster-selection-in-urban-areas.html#cb12-13" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;temp&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-14"><a href="cluster-selection-in-urban-areas.html#cb12-14" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;GIS&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-15"><a href="cluster-selection-in-urban-areas.html#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="cluster-selection-in-urban-areas.html#cb12-16" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">✅ PROCESSING COMPLETE FOR ITERATION </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-17"><a href="cluster-selection-in-urban-areas.html#cb12-17" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;📊 Summary of selected clusters:&quot;</span>)</span>
<span id="cb12-18"><a href="cluster-selection-in-urban-areas.html#cb12-18" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb12-19"><a href="cluster-selection-in-urban-areas.html#cb12-19" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(df_dist)<span class="sc">}</span><span class="ss"> clusters selected&quot;</span>)</span>
<span id="cb12-20"><a href="cluster-selection-in-urban-areas.html#cb12-20" tabindex="-1"></a></span>
<span id="cb12-21"><a href="cluster-selection-in-urban-areas.html#cb12-21" tabindex="-1"></a>    <span class="co"># Display first few selected clusters for verification</span></span>
<span id="cb12-22"><a href="cluster-selection-in-urban-areas.html#cb12-22" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔍 Sample of selected clusters:&quot;</span>)</span>
<span id="cb12-23"><a href="cluster-selection-in-urban-areas.html#cb12-23" tabindex="-1"></a>    sample_df <span class="op">=</span> pd.concat(selected_clusters.values()).head(<span class="dv">10</span>)</span>
<span id="cb12-24"><a href="cluster-selection-in-urban-areas.html#cb12-24" tabindex="-1"></a>    <span class="bu">print</span>(sample_df[[<span class="st">&#39;District&#39;</span>, <span class="st">&#39;Town&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Block_No&#39;</span>, <span class="st">&#39;Latitude&#39;</span>, <span class="st">&#39;Longitude&#39;</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb12-25"><a href="cluster-selection-in-urban-areas.html#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="cluster-selection-in-urban-areas.html#cb12-26" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🎉 ALL ITERATIONS COMPLETED!&quot;</span>)</span>
<span id="cb12-27"><a href="cluster-selection-in-urban-areas.html#cb12-27" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📁 Output files generated with prefix: Urban Report[EXCEL]-</span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-28"><a href="cluster-selection-in-urban-areas.html#cb12-28" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📊 Total sample iterations: </span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-29"><a href="cluster-selection-in-urban-areas.html#cb12-29" tabindex="-1"></a></span>
<span id="cb12-30"><a href="cluster-selection-in-urban-areas.html#cb12-30" tabindex="-1"></a><span class="co"># Final summary</span></span>
<span id="cb12-31"><a href="cluster-selection-in-urban-areas.html#cb12-31" tabindex="-1"></a>total_clusters_generated <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">len</span>(df_dist) <span class="cf">for</span> df_dist <span class="kw">in</span> selected_clusters.values())</span>
<span id="cb12-32"><a href="cluster-selection-in-urban-areas.html#cb12-32" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📈 Clusters per iteration: ~</span><span class="sc">{</span>total_clusters_generated<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb12-33"><a href="cluster-selection-in-urban-areas.html#cb12-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📈 Total clusters across all iterations: ~</span><span class="sc">{</span>total_clusters_generated <span class="op">*</span> multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<div style="text-align: center;">
<iframe src="Urban Report[PDF-1]-Goa_30.pdf" width="100%" height="400px">
</iframe>
<iframe src="figure.html" width="100%" height="400px frameborder="0"></iframe>

</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cluster-selection-in-rural-areas.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
