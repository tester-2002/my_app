<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Cluster selection in Urban areas | NMHS_APP</title>
  <meta name="description" content="Documentation for the NMHS_APP project" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Cluster selection in Urban areas | NMHS_APP" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentation for the NMHS_APP project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cluster selection in Urban areas | NMHS_APP" />
  
  <meta name="twitter:description" content="Documentation for the NMHS_APP project" />
  

<meta name="author" content="Deepan P" />


<meta name="date" content="2024-09-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cluster-selection-in-rural-areas.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>Introduction</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Rural areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#file-structure"><i class="fa fa-check"></i>File structure</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#program-flow-chart"><i class="fa fa-check"></i>Program Flow chart</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-data-collection-and-consolidation-first-pass"><i class="fa fa-check"></i><strong>PHASE 1: Data Collection and Consolidation</strong> <br>(First Pass)</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-1-output"><i class="fa fa-check"></i>Phase 1 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-proportional-analysis-and-sampling-preparation"><i class="fa fa-check"></i><strong>PHASE 2: Proportional Analysis and Sampling Preparation</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-1"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-1"><i class="fa fa-check"></i>Detailed Procedures</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-2-output"><i class="fa fa-check"></i>Phase 2 Output</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#phase-3-systematic-sampling-and-results-generation-second-pass"><i class="fa fa-check"></i><strong>PHASE 3: Systematic Sampling and Results Generation (Second Pass)</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#purpose-2"><i class="fa fa-check"></i>Purpose</a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-rural-areas.html"><a href="cluster-selection-in-rural-areas.html#detailed-procedures-2"><i class="fa fa-check"></i>Detailed Procedures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html"><i class="fa fa-check"></i><strong>Cluster selection in Urban areas</strong></a>
<ul>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#program-flow-chart-1"><i class="fa fa-check"></i><strong>Program Flow chart</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#import-libraries-and-utility-functions"><i class="fa fa-check"></i><strong>Import Libraries and Utility Functions</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#data-download-and-initial-processing"><i class="fa fa-check"></i><strong>Data Download and Initial Processing</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#district-selection-and-filtering"><i class="fa fa-check"></i><strong>District Selection and Filtering</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#exclusion-logic"><i class="fa fa-check"></i><strong>Exclusion Logic</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#cluster-calculation-and-proportional-allocation"><i class="fa fa-check"></i><strong>Cluster Calculation and Proportional Allocation</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#utility-functions-for-report-generation"><i class="fa fa-check"></i><strong>Utility Functions for Report Generation</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#result-summary-and-sampling-preparation"><i class="fa fa-check"></i><strong>Result Summary and Sampling Preparation</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#random-cluster-sampling-implementation"><i class="fa fa-check"></i><strong>Random Cluster Sampling Implementation</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#geographic-coordinate-assignment-geocoding"><i class="fa fa-check"></i><strong>Geographic Coordinate Assignment (Geocoding)</strong></a></li>
<li class="chapter" data-level="" data-path="cluster-selection-in-urban-areas.html"><a href="cluster-selection-in-urban-areas.html#output-generation-and-final-documentation"><i class="fa fa-check"></i><strong>Output Generation and Final Documentation</strong></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>NMHS_APP</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cluster-selection-in-urban-areas" class="section level1 hasAnchor">
<h1><strong>Cluster selection in Urban areas</strong><a href="cluster-selection-in-urban-areas.html#cluster-selection-in-urban-areas" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="program-flow-chart-1" class="section level3 hasAnchor">
<h3><strong>Program Flow chart</strong><a href="cluster-selection-in-urban-areas.html#program-flow-chart-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cluster-selection-in-urban-areas.html#cb18-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;flow-chart.svg&quot;</span>)</span></code></pre></div>
</details>
<p><img src="flow-chart.svg" width="50%" style="display: block; margin: auto;" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="cluster-selection-in-urban-areas.html#cb19-1" tabindex="-1"></a><span class="co"># Install Python packages via pip</span></span>
<span id="cb19-2"><a href="cluster-selection-in-urban-areas.html#cb19-2" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;pip install requests pandas geopy openpyxl geopandas matplotlib numpy reportlab PyPDF2&quot;</span>)</span>
<span id="cb19-3"><a href="cluster-selection-in-urban-areas.html#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="cluster-selection-in-urban-areas.html#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="cluster-selection-in-urban-areas.html#cb19-5" tabindex="-1"></a><span class="co"># Download files from Google Drive using gdown</span></span>
<span id="cb19-6"><a href="cluster-selection-in-urban-areas.html#cb19-6" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;gdown https://drive.google.com/uc?id=1BQnzVmLHCfw84z-RnfWbdgcpNIBNgKWc&quot;</span>)</span>
<span id="cb19-7"><a href="cluster-selection-in-urban-areas.html#cb19-7" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;gdown https://drive.google.com/uc?id=18L5b_ya_YxoD7-PCfw8ftzeXU0jh6BIy&quot;</span>)</span>
<span id="cb19-8"><a href="cluster-selection-in-urban-areas.html#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="cluster-selection-in-urban-areas.html#cb19-9" tabindex="-1"></a><span class="co"># Make directory</span></span>
<span id="cb19-10"><a href="cluster-selection-in-urban-areas.html#cb19-10" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;GIS map temp&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-11"><a href="cluster-selection-in-urban-areas.html#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="cluster-selection-in-urban-areas.html#cb19-12" tabindex="-1"></a><span class="co"># Unzip file</span></span>
<span id="cb19-13"><a href="cluster-selection-in-urban-areas.html#cb19-13" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;district_boundries.zip&quot;</span>, <span class="at">exdir =</span> <span class="st">&quot;GIS&quot;</span>)</span>
<span id="cb19-14"><a href="cluster-selection-in-urban-areas.html#cb19-14" tabindex="-1"></a></span>
<span id="cb19-15"><a href="cluster-selection-in-urban-areas.html#cb19-15" tabindex="-1"></a><span class="co"># Remove zip file</span></span>
<span id="cb19-16"><a href="cluster-selection-in-urban-areas.html#cb19-16" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;district_boundries.zip&quot;</span>)</span>
<span id="cb19-17"><a href="cluster-selection-in-urban-areas.html#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="cluster-selection-in-urban-areas.html#cb19-18" tabindex="-1"></a><span class="co"># Remove folder</span></span>
<span id="cb19-19"><a href="cluster-selection-in-urban-areas.html#cb19-19" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;sample_data&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
</div>
<div id="import-libraries-and-utility-functions" class="section level2 hasAnchor">
<h2><strong>Import Libraries and Utility Functions</strong><a href="cluster-selection-in-urban-areas.html#import-libraries-and-utility-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section imports all necessary libraries for data processing, file operations, geographic analysis, visualization, and PDF generation. It also includes utility functions for:</p>
<ul>
<li><strong>File Download</strong>: Download files from URLs with error handling and progress tracking</li>
<li><strong>Random Filename Generation</strong>: Create unique filenames to avoid conflicts during file operations</li>
</ul>
<p><strong>Key Libraries:</strong> - <code>pandas</code>, <code>numpy</code>: Data manipulation and analysis - <code>geopandas</code>, <code>geopy</code>: Geographic data processing - <code>matplotlib</code>: Data visualization - <code>reportlab</code>, <code>PyPDF2</code>: PDF generation and manipulation - <code>requests</code>: HTTP requests for file downloads - <code>openpyxl</code>: Excel file operations</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="cluster-selection-in-urban-areas.html#cb20-1" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb20-2"><a href="cluster-selection-in-urban-areas.html#cb20-2" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb20-3"><a href="cluster-selection-in-urban-areas.html#cb20-3" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb20-4"><a href="cluster-selection-in-urban-areas.html#cb20-4" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb20-5"><a href="cluster-selection-in-urban-areas.html#cb20-5" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-6"><a href="cluster-selection-in-urban-areas.html#cb20-6" tabindex="-1"></a><span class="im">import</span> geopy</span>
<span id="cb20-7"><a href="cluster-selection-in-urban-areas.html#cb20-7" tabindex="-1"></a><span class="im">from</span> openpyxl <span class="im">import</span> Workbook</span>
<span id="cb20-8"><a href="cluster-selection-in-urban-areas.html#cb20-8" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb20-9"><a href="cluster-selection-in-urban-areas.html#cb20-9" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-10"><a href="cluster-selection-in-urban-areas.html#cb20-10" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-11"><a href="cluster-selection-in-urban-areas.html#cb20-11" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb20-12"><a href="cluster-selection-in-urban-areas.html#cb20-12" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb20-13"><a href="cluster-selection-in-urban-areas.html#cb20-13" tabindex="-1"></a><span class="im">from</span> reportlab.lib <span class="im">import</span> colors</span>
<span id="cb20-14"><a href="cluster-selection-in-urban-areas.html#cb20-14" tabindex="-1"></a><span class="im">from</span> reportlab.lib.pagesizes <span class="im">import</span> A4</span>
<span id="cb20-15"><a href="cluster-selection-in-urban-areas.html#cb20-15" tabindex="-1"></a><span class="im">from</span> reportlab.lib.units <span class="im">import</span> inch</span>
<span id="cb20-16"><a href="cluster-selection-in-urban-areas.html#cb20-16" tabindex="-1"></a><span class="im">from</span> reportlab.pdfgen <span class="im">import</span> canvas</span>
<span id="cb20-17"><a href="cluster-selection-in-urban-areas.html#cb20-17" tabindex="-1"></a><span class="im">from</span> reportlab.pdfbase <span class="im">import</span> pdfmetrics</span>
<span id="cb20-18"><a href="cluster-selection-in-urban-areas.html#cb20-18" tabindex="-1"></a><span class="im">from</span> reportlab.pdfbase.ttfonts <span class="im">import</span> TTFont</span>
<span id="cb20-19"><a href="cluster-selection-in-urban-areas.html#cb20-19" tabindex="-1"></a><span class="im">from</span> reportlab.platypus <span class="im">import</span> Table, TableStyle, SimpleDocTemplate</span>
<span id="cb20-20"><a href="cluster-selection-in-urban-areas.html#cb20-20" tabindex="-1"></a><span class="im">from</span> PyPDF2 <span class="im">import</span> PdfWriter, PdfReader</span>
<span id="cb20-21"><a href="cluster-selection-in-urban-areas.html#cb20-21" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb20-22"><a href="cluster-selection-in-urban-areas.html#cb20-22" tabindex="-1"></a></span>
<span id="cb20-23"><a href="cluster-selection-in-urban-areas.html#cb20-23" tabindex="-1"></a><span class="co"># Suppress specific warnings to keep output clean</span></span>
<span id="cb20-24"><a href="cluster-selection-in-urban-areas.html#cb20-24" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb20-25"><a href="cluster-selection-in-urban-areas.html#cb20-25" tabindex="-1"></a></span>
<span id="cb20-26"><a href="cluster-selection-in-urban-areas.html#cb20-26" tabindex="-1"></a><span class="kw">def</span> download_file(url, folder_path, filename):</span>
<span id="cb20-27"><a href="cluster-selection-in-urban-areas.html#cb20-27" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb20-28"><a href="cluster-selection-in-urban-areas.html#cb20-28" tabindex="-1"></a><span class="co">    Download a file from URL and save it to specified folder</span></span>
<span id="cb20-29"><a href="cluster-selection-in-urban-areas.html#cb20-29" tabindex="-1"></a><span class="co">    Returns: filepath if successful, None if failed</span></span>
<span id="cb20-30"><a href="cluster-selection-in-urban-areas.html#cb20-30" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb20-31"><a href="cluster-selection-in-urban-areas.html#cb20-31" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-32"><a href="cluster-selection-in-urban-areas.html#cb20-32" tabindex="-1"></a>        <span class="co"># Create directory if it doesn&#39;t exist</span></span>
<span id="cb20-33"><a href="cluster-selection-in-urban-areas.html#cb20-33" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(folder_path):</span>
<span id="cb20-34"><a href="cluster-selection-in-urban-areas.html#cb20-34" tabindex="-1"></a>            os.makedirs(folder_path)</span>
<span id="cb20-35"><a href="cluster-selection-in-urban-areas.html#cb20-35" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;‚úì Created directory: </span><span class="sc">{</span>folder_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-36"><a href="cluster-selection-in-urban-areas.html#cb20-36" tabindex="-1"></a></span>
<span id="cb20-37"><a href="cluster-selection-in-urban-areas.html#cb20-37" tabindex="-1"></a>        <span class="co"># Download file with streaming to handle large files</span></span>
<span id="cb20-38"><a href="cluster-selection-in-urban-areas.html#cb20-38" tabindex="-1"></a>        response <span class="op">=</span> requests.get(url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-39"><a href="cluster-selection-in-urban-areas.html#cb20-39" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb20-40"><a href="cluster-selection-in-urban-areas.html#cb20-40" tabindex="-1"></a></span>
<span id="cb20-41"><a href="cluster-selection-in-urban-areas.html#cb20-41" tabindex="-1"></a>        filepath <span class="op">=</span> os.path.join(folder_path, filename)</span>
<span id="cb20-42"><a href="cluster-selection-in-urban-areas.html#cb20-42" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb20-43"><a href="cluster-selection-in-urban-areas.html#cb20-43" tabindex="-1"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> response.iter_content(chunk_size<span class="op">=</span><span class="dv">8192</span>):</span>
<span id="cb20-44"><a href="cluster-selection-in-urban-areas.html#cb20-44" tabindex="-1"></a>                <span class="bu">file</span>.write(chunk)</span>
<span id="cb20-45"><a href="cluster-selection-in-urban-areas.html#cb20-45" tabindex="-1"></a></span>
<span id="cb20-46"><a href="cluster-selection-in-urban-areas.html#cb20-46" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;‚úì File downloaded successfully: </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-47"><a href="cluster-selection-in-urban-areas.html#cb20-47" tabindex="-1"></a>        <span class="cf">return</span> filepath</span>
<span id="cb20-48"><a href="cluster-selection-in-urban-areas.html#cb20-48" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb20-49"><a href="cluster-selection-in-urban-areas.html#cb20-49" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;‚úó Error downloading file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-50"><a href="cluster-selection-in-urban-areas.html#cb20-50" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb20-51"><a href="cluster-selection-in-urban-areas.html#cb20-51" tabindex="-1"></a></span>
<span id="cb20-52"><a href="cluster-selection-in-urban-areas.html#cb20-52" tabindex="-1"></a><span class="kw">def</span> generate_random_filename(length<span class="op">=</span><span class="dv">10</span>, extension<span class="op">=</span><span class="st">&quot;.xlsx&quot;</span>):</span>
<span id="cb20-53"><a href="cluster-selection-in-urban-areas.html#cb20-53" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Generate a random filename to avoid conflicts&quot;&quot;&quot;</span></span>
<span id="cb20-54"><a href="cluster-selection-in-urban-areas.html#cb20-54" tabindex="-1"></a>    characters <span class="op">=</span> string.ascii_letters <span class="op">+</span> string.digits</span>
<span id="cb20-55"><a href="cluster-selection-in-urban-areas.html#cb20-55" tabindex="-1"></a>    random_filename <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(random.choice(characters) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(length)) <span class="op">+</span> extension</span>
<span id="cb20-56"><a href="cluster-selection-in-urban-areas.html#cb20-56" tabindex="-1"></a>    <span class="cf">return</span> random_filename</span></code></pre></div>
</details>
</div>
<div id="data-download-and-initial-processing" class="section level2 hasAnchor">
<h2><strong>Data Download and Initial Processing</strong><a href="cluster-selection-in-urban-areas.html#data-download-and-initial-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step handles the initial data acquisition and preprocessing:</p>
<p><strong>Key Operations:</strong></p>
<p>1. <strong>Download Data</strong>: Downloads UFS (Urban Frame Survey) data from MOSPI website for Goa state</p>
<p>2. <strong>Load Excel File</strong>: Reads the downloaded Excel file into a pandas DataFrame</p>
<p>3. <strong>Clean Headers</strong>: Removes metadata rows and assigns meaningful column names</p>
<p>4. <strong>Extract State Info</strong>: Captures state name and code for later use</p>
<p><strong>Data Structure:</strong></p>
<p>- <code>S_Code</code>, <code>S_Name</code>: State code and name</p>
<p>- <code>D_Code</code>, <code>District</code>: District code and name<br />
- <code>T_Code</code>, <code>Town</code>: Town code and name</p>
<p>- <code>IV_Unit_No</code>, <code>Block_No</code>: Investigation unit and block identifiers</p>
<p>- <code>No_of_Households</code>: Number of households in each block</p>
<p>This creates the foundation dataset for cluster sampling analysis.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="cluster-selection-in-urban-areas.html#cb21-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb21-2"><a href="cluster-selection-in-urban-areas.html#cb21-2" tabindex="-1"></a><span class="co"># STEP 1: DATA DOWNLOAD AND INITIAL PROCESSING</span></span>
<span id="cb21-3"><a href="cluster-selection-in-urban-areas.html#cb21-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb21-4"><a href="cluster-selection-in-urban-areas.html#cb21-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb21-5"><a href="cluster-selection-in-urban-areas.html#cb21-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 1: DOWNLOADING AND LOADING DATA&quot;</span>)</span>
<span id="cb21-6"><a href="cluster-selection-in-urban-areas.html#cb21-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb21-7"><a href="cluster-selection-in-urban-areas.html#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="cluster-selection-in-urban-areas.html#cb21-8" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&quot;https://mospi.gov.in/sites/default/files/publication_reports/UFS/UFS_30_Goa7112023.xlsx&quot;</span></span>
<span id="cb21-9"><a href="cluster-selection-in-urban-areas.html#cb21-9" tabindex="-1"></a>filename <span class="op">=</span> generate_random_filename()</span>
<span id="cb21-10"><a href="cluster-selection-in-urban-areas.html#cb21-10" tabindex="-1"></a>folder_path <span class="op">=</span> <span class="st">&quot;states&quot;</span></span>
<span id="cb21-11"><a href="cluster-selection-in-urban-areas.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="cluster-selection-in-urban-areas.html#cb21-12" tabindex="-1"></a><span class="co"># Download the Excel file</span></span>
<span id="cb21-13"><a href="cluster-selection-in-urban-areas.html#cb21-13" tabindex="-1"></a>download_file(url, folder_path<span class="op">=</span>folder_path, filename<span class="op">=</span>filename)</span>
<span id="cb21-14"><a href="cluster-selection-in-urban-areas.html#cb21-14" tabindex="-1"></a></span>
<span id="cb21-15"><a href="cluster-selection-in-urban-areas.html#cb21-15" tabindex="-1"></a><span class="co"># Load and process the Excel file</span></span>
<span id="cb21-16"><a href="cluster-selection-in-urban-areas.html#cb21-16" tabindex="-1"></a>filepath <span class="op">=</span> os.path.join(folder_path, filename)</span>
<span id="cb21-17"><a href="cluster-selection-in-urban-areas.html#cb21-17" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(filepath)</span>
<span id="cb21-18"><a href="cluster-selection-in-urban-areas.html#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="cluster-selection-in-urban-areas.html#cb21-19" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Initial data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-20"><a href="cluster-selection-in-urban-areas.html#cb21-20" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Initial columns: </span><span class="sc">{</span><span class="bu">list</span>(df.columns)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-21"><a href="cluster-selection-in-urban-areas.html#cb21-21" tabindex="-1"></a></span>
<span id="cb21-22"><a href="cluster-selection-in-urban-areas.html#cb21-22" tabindex="-1"></a><span class="co"># Remove first 2 rows (likely headers) and limit to first 10 columns</span></span>
<span id="cb21-23"><a href="cluster-selection-in-urban-areas.html#cb21-23" tabindex="-1"></a>df <span class="op">=</span> df.iloc[<span class="dv">2</span>:]</span>
<span id="cb21-24"><a href="cluster-selection-in-urban-areas.html#cb21-24" tabindex="-1"></a>df <span class="op">=</span> df.iloc[:, :<span class="dv">10</span>]</span>
<span id="cb21-25"><a href="cluster-selection-in-urban-areas.html#cb21-25" tabindex="-1"></a></span>
<span id="cb21-26"><a href="cluster-selection-in-urban-areas.html#cb21-26" tabindex="-1"></a><span class="co"># Assign meaningful column names</span></span>
<span id="cb21-27"><a href="cluster-selection-in-urban-areas.html#cb21-27" tabindex="-1"></a>new_column_names <span class="op">=</span> [<span class="st">&#39;S_Code&#39;</span>, <span class="st">&#39;S_Name&#39;</span>, <span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>, <span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;Town&#39;</span>, <span class="st">&#39;Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Block_No&#39;</span>, <span class="st">&#39;No_of_Households&#39;</span>]</span>
<span id="cb21-28"><a href="cluster-selection-in-urban-areas.html#cb21-28" tabindex="-1"></a>df.columns <span class="op">=</span> new_column_names</span>
<span id="cb21-29"><a href="cluster-selection-in-urban-areas.html#cb21-29" tabindex="-1"></a></span>
<span id="cb21-30"><a href="cluster-selection-in-urban-areas.html#cb21-30" tabindex="-1"></a><span class="co"># Extract state information</span></span>
<span id="cb21-31"><a href="cluster-selection-in-urban-areas.html#cb21-31" tabindex="-1"></a>state_name <span class="op">=</span> df.iloc[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb21-32"><a href="cluster-selection-in-urban-areas.html#cb21-32" tabindex="-1"></a>state_code <span class="op">=</span> df.iloc[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb21-33"><a href="cluster-selection-in-urban-areas.html#cb21-33" tabindex="-1"></a></span>
<span id="cb21-34"><a href="cluster-selection-in-urban-areas.html#cb21-34" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> State Name: </span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-35"><a href="cluster-selection-in-urban-areas.html#cb21-35" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot; State Code: </span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-36"><a href="cluster-selection-in-urban-areas.html#cb21-36" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Processed data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-37"><a href="cluster-selection-in-urban-areas.html#cb21-37" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Sample of processed data:&quot;</span>)</span>
<span id="cb21-38"><a href="cluster-selection-in-urban-areas.html#cb21-38" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code></pre></div>
</details>
<p>üèõÔ∏è State Name: Goa üèõÔ∏è State Code: 30 üìä Processed data shape: (1592, 10)</p>
<p><strong>Preprocessed data set:</strong></p>
<table style="width:100%;">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>S_Code</th>
<th>S_Name</th>
<th>D_Code</th>
<th>District</th>
<th>T_Code</th>
<th>Town</th>
<th>IV_Unit_No</th>
<th>Block_No</th>
<th>No_of_Households</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>63</td>
</tr>
<tr class="even">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>69</td>
</tr>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>83</td>
</tr>
<tr class="even">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>89</td>
</tr>
<tr class="odd">
<td>30</td>
<td>Goa</td>
<td>01</td>
<td>North Goa</td>
<td>001</td>
<td>Aldona</td>
<td>17</td>
<td>0001</td>
<td>90</td>
</tr>
</tbody>
</table>
</div>
<div id="district-selection-and-filtering" class="section level2 hasAnchor">
<h2><strong>District Selection and Filtering</strong><a href="cluster-selection-in-urban-areas.html#district-selection-and-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step allows users to select specific districts for analysis:</p>
<p><strong>Process:</strong></p>
<p>1. <strong>User Input</strong>: Prompts user to enter district codes separated by spaces</p>
<p>2. <strong>Data Filtering</strong>: Filters the main dataset to include only selected districts</p>
<p>3. <strong>Validation</strong>: Shows which districts are included in the filtered dataset</p>
<p><strong>Purpose:</strong></p>
<p>- Enables targeted analysis for specific geographical areas</p>
<p>- Reduces dataset size for more focused sampling</p>
<p>- Allows comparison between different district combinations</p>
<p><strong>Output:</strong> Filtered dataset containing only the selected districts with summary statistics.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="cluster-selection-in-urban-areas.html#cb22-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb22-2"><a href="cluster-selection-in-urban-areas.html#cb22-2" tabindex="-1"></a><span class="co"># STEP 2: DISTRICT SELECTION AND FILTERING</span></span>
<span id="cb22-3"><a href="cluster-selection-in-urban-areas.html#cb22-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb22-4"><a href="cluster-selection-in-urban-areas.html#cb22-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb22-5"><a href="cluster-selection-in-urban-areas.html#cb22-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 2: DISTRICT SELECTION AND FILTERING&quot;</span>)</span>
<span id="cb22-6"><a href="cluster-selection-in-urban-areas.html#cb22-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb22-7"><a href="cluster-selection-in-urban-areas.html#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="cluster-selection-in-urban-areas.html#cb22-8" tabindex="-1"></a><span class="co"># Get user input for district codes</span></span>
<span id="cb22-9"><a href="cluster-selection-in-urban-areas.html#cb22-9" tabindex="-1"></a>D_Code_list <span class="op">=</span> [<span class="st">&quot;01&quot;</span>,<span class="st">&quot;02&quot;</span>]</span>
<span id="cb22-10"><a href="cluster-selection-in-urban-areas.html#cb22-10" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Selected district codes: </span><span class="sc">{</span>D_Code_list<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb22-11"><a href="cluster-selection-in-urban-areas.html#cb22-11" tabindex="-1"></a></span>
<span id="cb22-12"><a href="cluster-selection-in-urban-areas.html#cb22-12" tabindex="-1"></a><span class="co"># Filter data for selected districts</span></span>
<span id="cb22-13"><a href="cluster-selection-in-urban-areas.html#cb22-13" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">&#39;D_Code&#39;</span>].isin(D_Code_list)]</span>
<span id="cb22-14"><a href="cluster-selection-in-urban-areas.html#cb22-14" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Filtered data shape: </span><span class="sc">{</span>filtered_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb22-15"><a href="cluster-selection-in-urban-areas.html#cb22-15" tabindex="-1"></a></span>
<span id="cb22-16"><a href="cluster-selection-in-urban-areas.html#cb22-16" tabindex="-1"></a><span class="co"># Show unique districts in filtered data</span></span>
<span id="cb22-17"><a href="cluster-selection-in-urban-areas.html#cb22-17" tabindex="-1"></a>unique_districts <span class="op">=</span> filtered_df[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>]].drop_duplicates()</span>
<span id="cb22-18"><a href="cluster-selection-in-urban-areas.html#cb22-18" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Districts in filtered data:&quot;</span>)</span>
<span id="cb22-19"><a href="cluster-selection-in-urban-areas.html#cb22-19" tabindex="-1"></a>display(unique_districts.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</details>
<p><strong>Selected district codes:</strong> <code>['01', '02']</code><br />
<strong>Filtered data shape:</strong> <code>(1592, 10)</code></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
</tr>
</tbody>
</table>
</div>
<div id="exclusion-logic" class="section level2 hasAnchor">
<h2><strong>Exclusion Logic</strong><a href="cluster-selection-in-urban-areas.html#exclusion-logic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step implements quality control by removing Investigation Units (IV Units) with insufficient data for the sampling process</p>
<p><strong>Quality Criteria:</strong> - <strong>Threshold</strong>: IV Units with fewer than 20 blocks are considered insufficient for reliable sampling - <strong>Analysis Level</strong>: Examines each Town-IV Unit combination within districts</p>
<p><strong>Process:</strong></p>
<p>1. <strong>Frequency Analysis</strong>: Counts blocks per IV Unit in each town</p>
<p>2. <strong>Threshold Application</strong>: Identifies IV Units with &lt;20 blocks</p>
<p>3. <strong>Exclusion Decision</strong>: Removes insufficient IV Units based on <code>Excluder</code> parameter</p>
<p>4. <strong>Data Cleaning</strong>: Creates filtered dataset with only sufficient IV Units</p>
<p><strong>Output:</strong> Clean dataset with only statistically viable IV Units for cluster sampling.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="cluster-selection-in-urban-areas.html#cb23-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb23-2"><a href="cluster-selection-in-urban-areas.html#cb23-2" tabindex="-1"></a><span class="co"># STEP 3: EXCLUSION LOGIC - REMOVE IV UNITS WITH &lt;20 BLOCKS</span></span>
<span id="cb23-3"><a href="cluster-selection-in-urban-areas.html#cb23-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb23-4"><a href="cluster-selection-in-urban-areas.html#cb23-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb23-5"><a href="cluster-selection-in-urban-areas.html#cb23-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 3: APPLYING EXCLUSION LOGIC&quot;</span>)</span>
<span id="cb23-6"><a href="cluster-selection-in-urban-areas.html#cb23-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb23-7"><a href="cluster-selection-in-urban-areas.html#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="cluster-selection-in-urban-areas.html#cb23-8" tabindex="-1"></a><span class="co"># Set exclusion parameter (1 to enable exclusion, 0 to disable)</span></span>
<span id="cb23-9"><a href="cluster-selection-in-urban-areas.html#cb23-9" tabindex="-1"></a>Excluder <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Set to 1 to enable exclusion, 0 to disable</span></span>
<span id="cb23-10"><a href="cluster-selection-in-urban-areas.html#cb23-10" tabindex="-1"></a></span>
<span id="cb23-11"><a href="cluster-selection-in-urban-areas.html#cb23-11" tabindex="-1"></a>excluded_combinations_by_district <span class="op">=</span> {}</span>
<span id="cb23-12"><a href="cluster-selection-in-urban-areas.html#cb23-12" tabindex="-1"></a></span>
<span id="cb23-13"><a href="cluster-selection-in-urban-areas.html#cb23-13" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;üîç Analyzing IV Units by district...&quot;</span>)</span>
<span id="cb23-14"><a href="cluster-selection-in-urban-areas.html#cb23-14" tabindex="-1"></a><span class="cf">for</span> district_code, group <span class="kw">in</span> filtered_df.groupby(<span class="st">&#39;D_Code&#39;</span>):</span>
<span id="cb23-15"><a href="cluster-selection-in-urban-areas.html#cb23-15" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìç Processing District: </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-16"><a href="cluster-selection-in-urban-areas.html#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="cluster-selection-in-urban-areas.html#cb23-17" tabindex="-1"></a>    <span class="co"># Count frequency of each T_Code + IV_Unit_No combination</span></span>
<span id="cb23-18"><a href="cluster-selection-in-urban-areas.html#cb23-18" tabindex="-1"></a>    er <span class="op">=</span> group.groupby([<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb23-19"><a href="cluster-selection-in-urban-areas.html#cb23-19" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   üìä Total T_Code + IV_Unit_No combinations: </span><span class="sc">{</span><span class="bu">len</span>(er)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-20"><a href="cluster-selection-in-urban-areas.html#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="cluster-selection-in-urban-areas.html#cb23-21" tabindex="-1"></a>    <span class="co"># Find combinations with less than 20 blocks</span></span>
<span id="cb23-22"><a href="cluster-selection-in-urban-areas.html#cb23-22" tabindex="-1"></a>    excluded_combinations <span class="op">=</span> er[er[<span class="st">&#39;Frequency&#39;</span>] <span class="op">&lt;</span> <span class="dv">20</span>][[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]]</span>
<span id="cb23-23"><a href="cluster-selection-in-urban-areas.html#cb23-23" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   ‚ùå Combinations with &lt;20 blocks: </span><span class="sc">{</span><span class="bu">len</span>(excluded_combinations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-24"><a href="cluster-selection-in-urban-areas.html#cb23-24" tabindex="-1"></a></span>
<span id="cb23-25"><a href="cluster-selection-in-urban-areas.html#cb23-25" tabindex="-1"></a>    <span class="co"># Skip if all combinations would be excluded and Excluder is 0</span></span>
<span id="cb23-26"><a href="cluster-selection-in-urban-areas.html#cb23-26" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(excluded_combinations) <span class="op">==</span> er.shape[<span class="dv">0</span>] <span class="kw">and</span> Excluder <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-27"><a href="cluster-selection-in-urban-areas.html#cb23-27" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   ‚ö†Ô∏è  All combinations would be excluded, skipping district </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-28"><a href="cluster-selection-in-urban-areas.html#cb23-28" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb23-29"><a href="cluster-selection-in-urban-areas.html#cb23-29" tabindex="-1"></a></span>
<span id="cb23-30"><a href="cluster-selection-in-urban-areas.html#cb23-30" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> excluded_combinations.empty:</span>
<span id="cb23-31"><a href="cluster-selection-in-urban-areas.html#cb23-31" tabindex="-1"></a>        excluded_combinations_by_district[district_code] <span class="op">=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> excluded_combinations.to_records(index<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb23-32"><a href="cluster-selection-in-urban-areas.html#cb23-32" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üö´ Excluded combinations: </span><span class="sc">{</span>excluded_combinations_by_district[district_code]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-33"><a href="cluster-selection-in-urban-areas.html#cb23-33" tabindex="-1"></a></span>
<span id="cb23-34"><a href="cluster-selection-in-urban-areas.html#cb23-34" tabindex="-1"></a><span class="co"># Create a set of all excluded combinations for filtering</span></span>
<span id="cb23-35"><a href="cluster-selection-in-urban-areas.html#cb23-35" tabindex="-1"></a>excluded_combinations <span class="op">=</span> {</span>
<span id="cb23-36"><a href="cluster-selection-in-urban-areas.html#cb23-36" tabindex="-1"></a>    (d_code, t_code, iv_unit_no)</span>
<span id="cb23-37"><a href="cluster-selection-in-urban-areas.html#cb23-37" tabindex="-1"></a>    <span class="cf">for</span> d_code, combinations <span class="kw">in</span> excluded_combinations_by_district.items()</span>
<span id="cb23-38"><a href="cluster-selection-in-urban-areas.html#cb23-38" tabindex="-1"></a>    <span class="cf">for</span> t_code, iv_unit_no <span class="kw">in</span> combinations</span>
<span id="cb23-39"><a href="cluster-selection-in-urban-areas.html#cb23-39" tabindex="-1"></a>}</span>
<span id="cb23-40"><a href="cluster-selection-in-urban-areas.html#cb23-40" tabindex="-1"></a></span>
<span id="cb23-41"><a href="cluster-selection-in-urban-areas.html#cb23-41" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìä Total excluded combinations across all districts: </span><span class="sc">{</span><span class="bu">len</span>(excluded_combinations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-42"><a href="cluster-selection-in-urban-areas.html#cb23-42" tabindex="-1"></a></span>
<span id="cb23-43"><a href="cluster-selection-in-urban-areas.html#cb23-43" tabindex="-1"></a><span class="co"># Apply exclusion filter</span></span>
<span id="cb23-44"><a href="cluster-selection-in-urban-areas.html#cb23-44" tabindex="-1"></a>filtered_df1 <span class="op">=</span> filtered_df[</span>
<span id="cb23-45"><a href="cluster-selection-in-urban-areas.html#cb23-45" tabindex="-1"></a>    <span class="op">~</span>filtered_df.set_index([<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).index.isin(excluded_combinations)</span>
<span id="cb23-46"><a href="cluster-selection-in-urban-areas.html#cb23-46" tabindex="-1"></a>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-47"><a href="cluster-selection-in-urban-areas.html#cb23-47" tabindex="-1"></a></span>
<span id="cb23-48"><a href="cluster-selection-in-urban-areas.html#cb23-48" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìä Data shape after exclusions: </span><span class="sc">{</span>filtered_df1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb23-49"><a href="cluster-selection-in-urban-areas.html#cb23-49" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìä Rows removed: </span><span class="sc">{</span><span class="bu">len</span>(filtered_df) <span class="op">-</span> <span class="bu">len</span>(filtered_df1)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<div class="results">
<p>üîç Analyzing IV Units by district‚Ä¶</p>
<p>üìç <strong>Processing District: 01</strong><br />
üìä Total T_Code + IV_Unit_No combinations: 56<br />
‚ùå Combinations with &lt;20 blocks: 42<br />
üö´ Excluded combinations:<br />
(‚Äò001‚Äô, ‚Äò0001‚Äô), (‚Äò002‚Äô, ‚Äò0001‚Äô), (‚Äò007‚Äô, ‚Äò0001‚Äô), (‚Äò008‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò010‚Äô, ‚Äò0001‚Äô), (‚Äò011‚Äô, ‚Äò0001‚Äô), (‚Äò012‚Äô, ‚Äò0001‚Äô), (‚Äò013‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò014‚Äô, ‚Äò0002‚Äô), (‚Äò014‚Äô, ‚Äò0003‚Äô), (‚Äò015‚Äô, ‚Äò0001‚Äô), (‚Äò016‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò016‚Äô, ‚Äò0002‚Äô), (‚Äò016‚Äô, ‚Äò0003‚Äô), (‚Äò016‚Äô, ‚Äò0005‚Äô), (‚Äò017‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò019‚Äô, ‚Äò0001‚Äô), (‚Äò021‚Äô, ‚Äò0001‚Äô), (‚Äò022‚Äô, ‚Äò0001‚Äô), (‚Äò023‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò024‚Äô, ‚Äò0001‚Äô), (‚Äò025‚Äô, ‚Äò0001‚Äô), (‚Äò026‚Äô, ‚Äò0001‚Äô), (‚Äò027‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò028‚Äô, ‚Äò0001‚Äô), (‚Äò029‚Äô, ‚Äò0001‚Äô), (‚Äò030‚Äô, ‚Äò0001‚Äô), (‚Äò031‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò032‚Äô, ‚Äò0001‚Äô), (‚Äò033‚Äô, ‚Äò0001‚Äô), (‚Äò034‚Äô, ‚Äò0001‚Äô), (‚Äò035‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò038‚Äô, ‚Äò0001‚Äô), (‚Äò039‚Äô, ‚Äò0001‚Äô), (‚Äò040‚Äô, ‚Äò0001‚Äô), (‚Äò042‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò046‚Äô, ‚Äò0001‚Äô), (‚Äò048‚Äô, ‚Äò0001‚Äô), (‚Äò049‚Äô, ‚Äò0001‚Äô), (‚Äò050‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò051‚Äô, ‚Äò0001‚Äô), (‚Äò052‚Äô, ‚Äò0001‚Äô)</p>
<p>üìç <strong>Processing District: 02</strong><br />
üìä Total T_Code + IV_Unit_No combinations: 29<br />
‚ùå Combinations with &lt;20 blocks: 11<br />
üö´ Excluded combinations:<br />
(‚Äò001‚Äô, ‚Äò0001‚Äô), (‚Äò002‚Äô, ‚Äò0001‚Äô), (‚Äò005‚Äô, ‚Äò0001‚Äô), (‚Äò009‚Äô, ‚Äò0002‚Äô),<br />
(‚Äò010‚Äô, ‚Äò0002‚Äô), (‚Äò011‚Äô, ‚Äò0001‚Äô), (‚Äò014‚Äô, ‚Äò0001‚Äô), (‚Äò015‚Äô, ‚Äò0001‚Äô),<br />
(‚Äò016‚Äô, ‚Äò0001‚Äô), (‚Äò017‚Äô, ‚Äò0001‚Äô), (‚Äò018‚Äô, ‚Äò0001‚Äô)</p>
<p>üìä <strong>Total excluded combinations across all districts:</strong> 53<br />
üìä <strong>Data shape after exclusions:</strong> (890, 10)<br />
üìä <strong>Rows removed:</strong> 702</p>
</div>
</div>
<div id="cluster-calculation-and-proportional-allocation" class="section level2 hasAnchor">
<h2><strong>Cluster Calculation and Proportional Allocation</strong><a href="cluster-selection-in-urban-areas.html#cluster-calculation-and-proportional-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step implements the core statistical methodology for cluster sampling:</p>
<p><strong>Sampling Strategy:</strong></p>
<p>1. <strong>IV unit Count</strong>: Counts unique IV Units per district</p>
<p>2. <strong>Proportional Allocation</strong>: Distributes target clusters based on district size with respect to the number of IV units</p>
<p><strong>Key Calculations:</strong></p>
<p>- <strong>District Proportion</strong> = IV Units in District / Total IV Units</p>
<p>- <strong>Allocated Clusters</strong> = Target Clusters √ó District Proportion</p>
<p>- <strong>Minimum Allocation</strong>: Each district gets at least 1 cluster (+1 adjustment)</p>
<p><strong>User Input:</strong> Total number of clusters to be selected for the survey</p>
<p><strong>Output:</strong> District-wise cluster allocation plan with verification totals.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="cluster-selection-in-urban-areas.html#cb24-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb24-2"><a href="cluster-selection-in-urban-areas.html#cb24-2" tabindex="-1"></a><span class="co"># STEP 4: CLUSTER CALCULATION AND ALLOCATION</span></span>
<span id="cb24-3"><a href="cluster-selection-in-urban-areas.html#cb24-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb24-4"><a href="cluster-selection-in-urban-areas.html#cb24-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb24-5"><a href="cluster-selection-in-urban-areas.html#cb24-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 4: CLUSTER CALCULATION AND ALLOCATION&quot;</span>)</span>
<span id="cb24-6"><a href="cluster-selection-in-urban-areas.html#cb24-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb24-7"><a href="cluster-selection-in-urban-areas.html#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="cluster-selection-in-urban-areas.html#cb24-8" tabindex="-1"></a><span class="co"># Count unique IV units per district and town</span></span>
<span id="cb24-9"><a href="cluster-selection-in-urban-areas.html#cb24-9" tabindex="-1"></a>g <span class="op">=</span> filtered_df1.iloc[:, :<span class="dv">8</span>].groupby(by<span class="op">=</span>[<span class="st">&quot;D_Code&quot;</span>, <span class="st">&quot;T_Code&quot;</span>])[[<span class="st">&#39;IV_Unit_No&#39;</span>]].nunique()</span>
<span id="cb24-10"><a href="cluster-selection-in-urban-areas.html#cb24-10" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;üî¢ IV Units per District-Town combination:&quot;</span>)</span>
<span id="cb24-11"><a href="cluster-selection-in-urban-areas.html#cb24-11" tabindex="-1"></a><span class="bu">print</span>(g.head(<span class="dv">10</span>))</span>
<span id="cb24-12"><a href="cluster-selection-in-urban-areas.html#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a href="cluster-selection-in-urban-areas.html#cb24-13" tabindex="-1"></a><span class="co"># Sum up total clusters per district</span></span>
<span id="cb24-14"><a href="cluster-selection-in-urban-areas.html#cb24-14" tabindex="-1"></a>unique_iv_unit_counts <span class="op">=</span> g.groupby(by<span class="op">=</span>[<span class="st">&quot;D_Code&quot;</span>]).<span class="bu">sum</span>()</span>
<span id="cb24-15"><a href="cluster-selection-in-urban-areas.html#cb24-15" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìä Total IV Units per district:&quot;</span>)</span>
<span id="cb24-16"><a href="cluster-selection-in-urban-areas.html#cb24-16" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts)</span>
<span id="cb24-17"><a href="cluster-selection-in-urban-areas.html#cb24-17" tabindex="-1"></a></span>
<span id="cb24-18"><a href="cluster-selection-in-urban-areas.html#cb24-18" tabindex="-1"></a><span class="co"># Calculate proportions</span></span>
<span id="cb24-19"><a href="cluster-selection-in-urban-areas.html#cb24-19" tabindex="-1"></a>unique_iv_unit_counts_proportion <span class="op">=</span> unique_iv_unit_counts <span class="op">/</span> unique_iv_unit_counts.<span class="bu">sum</span>()</span>
<span id="cb24-20"><a href="cluster-selection-in-urban-areas.html#cb24-20" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;Proportion&#39;</span>] <span class="op">=</span> unique_iv_unit_counts_proportion</span>
<span id="cb24-21"><a href="cluster-selection-in-urban-areas.html#cb24-21" tabindex="-1"></a></span>
<span id="cb24-22"><a href="cluster-selection-in-urban-areas.html#cb24-22" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìä District proportions:&quot;</span>)</span>
<span id="cb24-23"><a href="cluster-selection-in-urban-areas.html#cb24-23" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts[[<span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>]])</span>
<span id="cb24-24"><a href="cluster-selection-in-urban-areas.html#cb24-24" tabindex="-1"></a></span>
<span id="cb24-25"><a href="cluster-selection-in-urban-areas.html#cb24-25" tabindex="-1"></a><span class="co"># Get total number of clusters from user</span></span>
<span id="cb24-26"><a href="cluster-selection-in-urban-areas.html#cb24-26" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Enter the total number of clusters to select: &quot;</span>))</span>
<span id="cb24-27"><a href="cluster-selection-in-urban-areas.html#cb24-27" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üéØ Target total clusters: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb24-28"><a href="cluster-selection-in-urban-areas.html#cb24-28" tabindex="-1"></a></span>
<span id="cb24-29"><a href="cluster-selection-in-urban-areas.html#cb24-29" tabindex="-1"></a><span class="co"># Allocate clusters proportionally to each district</span></span>
<span id="cb24-30"><a href="cluster-selection-in-urban-areas.html#cb24-30" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>] <span class="op">=</span> (unique_iv_unit_counts_proportion <span class="op">*</span> num_clusters)</span>
<span id="cb24-31"><a href="cluster-selection-in-urban-areas.html#cb24-31" tabindex="-1"></a>unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>] <span class="op">=</span> unique_iv_unit_counts[<span class="st">&#39;No_of_Cluster&#39;</span>].<span class="bu">apply</span>(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb24-32"><a href="cluster-selection-in-urban-areas.html#cb24-32" tabindex="-1"></a></span>
<span id="cb24-33"><a href="cluster-selection-in-urban-areas.html#cb24-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìä Cluster allocation per district:&quot;</span>)</span>
<span id="cb24-34"><a href="cluster-selection-in-urban-areas.html#cb24-34" tabindex="-1"></a><span class="bu">print</span>(unique_iv_unit_counts[[<span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>, <span class="st">&#39;No_of_Cluster&#39;</span>]])</span>
<span id="cb24-35"><a href="cluster-selection-in-urban-areas.html#cb24-35" tabindex="-1"></a></span>
<span id="cb24-36"><a href="cluster-selection-in-urban-areas.html#cb24-36" tabindex="-1"></a><span class="co"># Add district names to results</span></span>
<span id="cb24-37"><a href="cluster-selection-in-urban-areas.html#cb24-37" tabindex="-1"></a>district_names <span class="op">=</span> df[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>]].drop_duplicates()</span>
<span id="cb24-38"><a href="cluster-selection-in-urban-areas.html#cb24-38" tabindex="-1"></a>result <span class="op">=</span> pd.merge(unique_iv_unit_counts, district_names, on<span class="op">=</span><span class="st">&#39;D_Code&#39;</span>, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb24-39"><a href="cluster-selection-in-urban-areas.html#cb24-39" tabindex="-1"></a>result <span class="op">=</span> result[[<span class="st">&#39;D_Code&#39;</span>, <span class="st">&#39;District&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Proportion&#39;</span>, <span class="st">&#39;No_of_Cluster&#39;</span>]]</span>
<span id="cb24-40"><a href="cluster-selection-in-urban-areas.html#cb24-40" tabindex="-1"></a></span>
<span id="cb24-41"><a href="cluster-selection-in-urban-areas.html#cb24-41" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéØ Final cluster allocation:&quot;</span>)</span>
<span id="cb24-42"><a href="cluster-selection-in-urban-areas.html#cb24-42" tabindex="-1"></a><span class="bu">print</span>(result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb24-43"><a href="cluster-selection-in-urban-areas.html#cb24-43" tabindex="-1"></a></span>
<span id="cb24-44"><a href="cluster-selection-in-urban-areas.html#cb24-44" tabindex="-1"></a><span class="co"># Verify total allocated clusters</span></span>
<span id="cb24-45"><a href="cluster-selection-in-urban-areas.html#cb24-45" tabindex="-1"></a>total_allocated <span class="op">=</span> result[<span class="st">&#39;No_of_Cluster&#39;</span>].<span class="bu">sum</span>()</span>
<span id="cb24-46"><a href="cluster-selection-in-urban-areas.html#cb24-46" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">‚úÖ Total clusters allocated: </span><span class="sc">{</span>total_allocated<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb24-47"><a href="cluster-selection-in-urban-areas.html#cb24-47" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üéØ Target clusters: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb24-48"><a href="cluster-selection-in-urban-areas.html#cb24-48" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìä Difference: </span><span class="sc">{</span>total_allocated <span class="op">-</span> num_clusters<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<p>üìä <strong>Total IV Units per district</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>IV_Unit_No</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>14</td>
</tr>
<tr class="even">
<td>02</td>
<td>18</td>
</tr>
</tbody>
</table>
<p>üìä <strong>District proportions</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>14</td>
<td>0.4375</td>
</tr>
<tr class="even">
<td>02</td>
<td>18</td>
<td>0.5625</td>
</tr>
</tbody>
</table>
<p>üéØ <strong>Target total clusters:</strong> 131</p>
<p>üéØ <strong>Final cluster allocation</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
<th>No_of_Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
<td>14</td>
<td>0.4375</td>
<td>58</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
<td>18</td>
<td>0.5625</td>
<td>74</td>
</tr>
</tbody>
</table>
<p>‚úÖ <strong>Total clusters allocated:</strong> 132<br />
üéØ <strong>Target clusters:</strong> 131<br />
üìä <strong>Difference:</strong> 1</p>
</div>
<div id="utility-functions-for-report-generation" class="section level2 hasAnchor">
<h2><strong>Utility Functions for Report Generation</strong><a href="cluster-selection-in-urban-areas.html#utility-functions-for-report-generation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section defines helper functions for creating professional output reports:</p>
<p><strong>Excel Generation Functions:</strong> - <code>extract_clusters_to_excel()</code>: Creates multi-sheet Excel workbooks with one sheet per district - Formats data with proper headers and structure</p>
<p><strong>PDF Generation Functions:</strong> - <code>add_text_page()</code>: Adds formatted text content to PDF documents - <code>create_table_pdf()</code>: Generates professional tables with styling - Handles page breaks and font formatting</p>
<p><strong>Data Formatting Functions:</strong> - <code>format_excluded_combinations()</code>: Creates readable summaries of excluded IV Units - Provides clear documentation of data quality decisions</p>
<p><strong>Purpose:</strong> These functions enable automated generation of professional reports for survey planning and documentation, ensuring consistent formatting and comprehensive coverage of sampling decisions.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="cluster-selection-in-urban-areas.html#cb25-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb25-2"><a href="cluster-selection-in-urban-areas.html#cb25-2" tabindex="-1"></a><span class="co"># UTILITY FUNCTIONS FOR EXCEL AND PDF GENERATION</span></span>
<span id="cb25-3"><a href="cluster-selection-in-urban-areas.html#cb25-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb25-4"><a href="cluster-selection-in-urban-areas.html#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="cluster-selection-in-urban-areas.html#cb25-5" tabindex="-1"></a><span class="kw">def</span> extract_clusters_to_excel(selected_clusters, output_file):</span>
<span id="cb25-6"><a href="cluster-selection-in-urban-areas.html#cb25-6" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create Excel file with separate sheets for each district&quot;&quot;&quot;</span></span>
<span id="cb25-7"><a href="cluster-selection-in-urban-areas.html#cb25-7" tabindex="-1"></a>    workbook <span class="op">=</span> Workbook()</span>
<span id="cb25-8"><a href="cluster-selection-in-urban-areas.html#cb25-8" tabindex="-1"></a>    workbook.remove(workbook.active)  <span class="co"># Remove default sheet</span></span>
<span id="cb25-9"><a href="cluster-selection-in-urban-areas.html#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="cluster-selection-in-urban-areas.html#cb25-10" tabindex="-1"></a>    <span class="cf">for</span> district_code, df <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb25-11"><a href="cluster-selection-in-urban-areas.html#cb25-11" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb25-12"><a href="cluster-selection-in-urban-areas.html#cb25-12" tabindex="-1"></a>            sheet_name <span class="op">=</span> <span class="ss">f&quot;District_</span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb25-13"><a href="cluster-selection-in-urban-areas.html#cb25-13" tabindex="-1"></a>            worksheet <span class="op">=</span> workbook.create_sheet(title<span class="op">=</span>sheet_name)</span>
<span id="cb25-14"><a href="cluster-selection-in-urban-areas.html#cb25-14" tabindex="-1"></a>            <span class="co"># Add headers</span></span>
<span id="cb25-15"><a href="cluster-selection-in-urban-areas.html#cb25-15" tabindex="-1"></a>            worksheet.append(<span class="bu">list</span>(df.columns))</span>
<span id="cb25-16"><a href="cluster-selection-in-urban-areas.html#cb25-16" tabindex="-1"></a>            <span class="co"># Add data</span></span>
<span id="cb25-17"><a href="cluster-selection-in-urban-areas.html#cb25-17" tabindex="-1"></a>            <span class="cf">for</span> row <span class="kw">in</span> df.values.tolist():</span>
<span id="cb25-18"><a href="cluster-selection-in-urban-areas.html#cb25-18" tabindex="-1"></a>                worksheet.append(row)</span>
<span id="cb25-19"><a href="cluster-selection-in-urban-areas.html#cb25-19" tabindex="-1"></a></span>
<span id="cb25-20"><a href="cluster-selection-in-urban-areas.html#cb25-20" tabindex="-1"></a>    workbook.save(output_file)</span>
<span id="cb25-21"><a href="cluster-selection-in-urban-areas.html#cb25-21" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;‚úÖ Excel file created: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb25-22"><a href="cluster-selection-in-urban-areas.html#cb25-22" tabindex="-1"></a></span>
<span id="cb25-23"><a href="cluster-selection-in-urban-areas.html#cb25-23" tabindex="-1"></a><span class="kw">def</span> add_text_page(pdf_canvas, text):</span>
<span id="cb25-24"><a href="cluster-selection-in-urban-areas.html#cb25-24" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Add text content to PDF canvas&quot;&quot;&quot;</span></span>
<span id="cb25-25"><a href="cluster-selection-in-urban-areas.html#cb25-25" tabindex="-1"></a>    pdf_canvas.setFont(<span class="st">&quot;CourierNew&quot;</span>, <span class="dv">12</span>)</span>
<span id="cb25-26"><a href="cluster-selection-in-urban-areas.html#cb25-26" tabindex="-1"></a>    text_lines <span class="op">=</span> text.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb25-27"><a href="cluster-selection-in-urban-areas.html#cb25-27" tabindex="-1"></a>    y_position <span class="op">=</span> <span class="dv">800</span></span>
<span id="cb25-28"><a href="cluster-selection-in-urban-areas.html#cb25-28" tabindex="-1"></a></span>
<span id="cb25-29"><a href="cluster-selection-in-urban-areas.html#cb25-29" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> text_lines:</span>
<span id="cb25-30"><a href="cluster-selection-in-urban-areas.html#cb25-30" tabindex="-1"></a>        <span class="cf">if</span> y_position <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb25-31"><a href="cluster-selection-in-urban-areas.html#cb25-31" tabindex="-1"></a>            pdf_canvas.showPage()</span>
<span id="cb25-32"><a href="cluster-selection-in-urban-areas.html#cb25-32" tabindex="-1"></a>            pdf_canvas.setFont(<span class="st">&quot;CourierNew&quot;</span>, <span class="dv">12</span>)</span>
<span id="cb25-33"><a href="cluster-selection-in-urban-areas.html#cb25-33" tabindex="-1"></a>            y_position <span class="op">=</span> <span class="dv">800</span></span>
<span id="cb25-34"><a href="cluster-selection-in-urban-areas.html#cb25-34" tabindex="-1"></a>        pdf_canvas.drawString(<span class="dv">72</span>, y_position, line)</span>
<span id="cb25-35"><a href="cluster-selection-in-urban-areas.html#cb25-35" tabindex="-1"></a>        y_position <span class="op">-=</span> <span class="dv">14</span></span>
<span id="cb25-36"><a href="cluster-selection-in-urban-areas.html#cb25-36" tabindex="-1"></a></span>
<span id="cb25-37"><a href="cluster-selection-in-urban-areas.html#cb25-37" tabindex="-1"></a>    pdf_canvas.showPage()</span>
<span id="cb25-38"><a href="cluster-selection-in-urban-areas.html#cb25-38" tabindex="-1"></a></span>
<span id="cb25-39"><a href="cluster-selection-in-urban-areas.html#cb25-39" tabindex="-1"></a><span class="kw">def</span> create_table_pdf(df, output_path):</span>
<span id="cb25-40"><a href="cluster-selection-in-urban-areas.html#cb25-40" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create PDF with table from DataFrame&quot;&quot;&quot;</span></span>
<span id="cb25-41"><a href="cluster-selection-in-urban-areas.html#cb25-41" tabindex="-1"></a>    doc <span class="op">=</span> SimpleDocTemplate(output_path, pagesize<span class="op">=</span>A4)</span>
<span id="cb25-42"><a href="cluster-selection-in-urban-areas.html#cb25-42" tabindex="-1"></a>    table_data <span class="op">=</span> [df.columns.tolist()] <span class="op">+</span> df.values.tolist()</span>
<span id="cb25-43"><a href="cluster-selection-in-urban-areas.html#cb25-43" tabindex="-1"></a>    table <span class="op">=</span> Table(table_data)</span>
<span id="cb25-44"><a href="cluster-selection-in-urban-areas.html#cb25-44" tabindex="-1"></a></span>
<span id="cb25-45"><a href="cluster-selection-in-urban-areas.html#cb25-45" tabindex="-1"></a>    style <span class="op">=</span> TableStyle([</span>
<span id="cb25-46"><a href="cluster-selection-in-urban-areas.html#cb25-46" tabindex="-1"></a>        (<span class="st">&#39;BACKGROUND&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), colors.grey),</span>
<span id="cb25-47"><a href="cluster-selection-in-urban-areas.html#cb25-47" tabindex="-1"></a>        (<span class="st">&#39;TEXTCOLOR&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), colors.whitesmoke),</span>
<span id="cb25-48"><a href="cluster-selection-in-urban-areas.html#cb25-48" tabindex="-1"></a>        (<span class="st">&#39;ALIGN&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">&#39;CENTER&#39;</span>),</span>
<span id="cb25-49"><a href="cluster-selection-in-urban-areas.html#cb25-49" tabindex="-1"></a>        (<span class="st">&#39;FONTNAME&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="st">&#39;CourierNew&#39;</span>),</span>
<span id="cb25-50"><a href="cluster-selection-in-urban-areas.html#cb25-50" tabindex="-1"></a>        (<span class="st">&#39;FONTNAME&#39;</span>, (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">&#39;CourierNew&#39;</span>),</span>
<span id="cb25-51"><a href="cluster-selection-in-urban-areas.html#cb25-51" tabindex="-1"></a>        (<span class="st">&#39;BOTTOMPADDING&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">12</span>),</span>
<span id="cb25-52"><a href="cluster-selection-in-urban-areas.html#cb25-52" tabindex="-1"></a>        (<span class="st">&#39;BACKGROUND&#39;</span>, (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), colors.white),</span>
<span id="cb25-53"><a href="cluster-selection-in-urban-areas.html#cb25-53" tabindex="-1"></a>        (<span class="st">&#39;GRID&#39;</span>, (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="dv">1</span>, colors.black),</span>
<span id="cb25-54"><a href="cluster-selection-in-urban-areas.html#cb25-54" tabindex="-1"></a>    ])</span>
<span id="cb25-55"><a href="cluster-selection-in-urban-areas.html#cb25-55" tabindex="-1"></a></span>
<span id="cb25-56"><a href="cluster-selection-in-urban-areas.html#cb25-56" tabindex="-1"></a>    table.setStyle(style)</span>
<span id="cb25-57"><a href="cluster-selection-in-urban-areas.html#cb25-57" tabindex="-1"></a>    doc.build([table])</span>
<span id="cb25-58"><a href="cluster-selection-in-urban-areas.html#cb25-58" tabindex="-1"></a></span>
<span id="cb25-59"><a href="cluster-selection-in-urban-areas.html#cb25-59" tabindex="-1"></a><span class="kw">def</span> format_excluded_combinations(excluded_dict):</span>
<span id="cb25-60"><a href="cluster-selection-in-urban-areas.html#cb25-60" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Format excluded combinations for display&quot;&quot;&quot;</span></span>
<span id="cb25-61"><a href="cluster-selection-in-urban-areas.html#cb25-61" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> excluded_dict:</span>
<span id="cb25-62"><a href="cluster-selection-in-urban-areas.html#cb25-62" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;No IV Units were excluded based on the frequency criteria.</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb25-63"><a href="cluster-selection-in-urban-areas.html#cb25-63" tabindex="-1"></a></span>
<span id="cb25-64"><a href="cluster-selection-in-urban-areas.html#cb25-64" tabindex="-1"></a>    formatted_text <span class="op">=</span> <span class="st">&quot;District wise excluded IV Units:</span><span class="ch">\n\n</span><span class="st">&quot;</span></span>
<span id="cb25-65"><a href="cluster-selection-in-urban-areas.html#cb25-65" tabindex="-1"></a>    <span class="cf">for</span> district, exclusions <span class="kw">in</span> excluded_dict.items():</span>
<span id="cb25-66"><a href="cluster-selection-in-urban-areas.html#cb25-66" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="ss">f&quot;District Code: </span><span class="sc">{</span>district<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb25-67"><a href="cluster-selection-in-urban-areas.html#cb25-67" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;Town_Code   || IV_Unit_No</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb25-68"><a href="cluster-selection-in-urban-areas.html#cb25-68" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">25</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb25-69"><a href="cluster-selection-in-urban-areas.html#cb25-69" tabindex="-1"></a>        <span class="cf">for</span> town_code, iv_unit_no <span class="kw">in</span> exclusions:</span>
<span id="cb25-70"><a href="cluster-selection-in-urban-areas.html#cb25-70" tabindex="-1"></a>            formatted_text <span class="op">+=</span> <span class="ss">f&quot;</span><span class="sc">{</span>town_code<span class="sc">:&lt;10}</span><span class="ss"> || </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb25-71"><a href="cluster-selection-in-urban-areas.html#cb25-71" tabindex="-1"></a>        formatted_text <span class="op">+=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb25-72"><a href="cluster-selection-in-urban-areas.html#cb25-72" tabindex="-1"></a>    <span class="cf">return</span> formatted_text</span></code></pre></div>
</details>
<div class="results">
<p>üìã <strong>RESULT SUMMARY</strong></p>
<ul>
<li><strong>State Name:</strong> Goa<br />
</li>
<li><strong>State Code:</strong> 30<br />
</li>
<li><strong>District Codes:</strong> 01, 02<br />
</li>
<li><strong>Total Clusters Requested:</strong> 131<br />
</li>
<li><strong>Total Clusters Allocated:</strong> 132<br />
</li>
<li><strong>Exclusion Applied:</strong> Yes</li>
</ul>
</div>
<hr />
<p>üìä <strong>Cluster Allocation by District</strong></p>
<table>
<thead>
<tr class="header">
<th>D_Code</th>
<th>District</th>
<th>IV_Unit_No</th>
<th>Proportion</th>
<th>No_of_Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01</td>
<td>North Goa</td>
<td>14</td>
<td>0.4375</td>
<td>58</td>
</tr>
<tr class="even">
<td>02</td>
<td>South Goa</td>
<td>18</td>
<td>0.5625</td>
<td>74</td>
</tr>
</tbody>
</table>
</div>
<div id="result-summary-and-sampling-preparation" class="section level2 hasAnchor">
<h2><strong>Result Summary and Sampling Preparation</strong><a href="cluster-selection-in-urban-areas.html#result-summary-and-sampling-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step creates a comprehensive summary of the sampling plan and prepares for execution:</p>
<p><strong>Summary Components:</strong></p>
<p>1. <strong>Metadata</strong>: State name, state code, selected districts</p>
<p>2. <strong>Allocation Summary</strong>: Target vs.¬†allocated clusters</p>
<p>3. <strong>Quality Control</strong>: Documentation of exclusions applied</p>
<p>4. <strong>District Breakdown</strong>: Detailed allocation table</p>
<p><strong>Iteration Setup:</strong></p>
<p>- <strong>Multiple Samples</strong>: Allows generation of multiple independent samples</p>
<p>- <strong>Reproducibility</strong>: Each iteration creates a different random sample</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="cluster-selection-in-urban-areas.html#cb26-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb26-2"><a href="cluster-selection-in-urban-areas.html#cb26-2" tabindex="-1"></a><span class="co"># STEP 5: PREPARE RESULT SUMMARY</span></span>
<span id="cb26-3"><a href="cluster-selection-in-urban-areas.html#cb26-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb26-4"><a href="cluster-selection-in-urban-areas.html#cb26-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb26-5"><a href="cluster-selection-in-urban-areas.html#cb26-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 5: PREPARING RESULT SUMMARY&quot;</span>)</span>
<span id="cb26-6"><a href="cluster-selection-in-urban-areas.html#cb26-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb26-7"><a href="cluster-selection-in-urban-areas.html#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="cluster-selection-in-urban-areas.html#cb26-8" tabindex="-1"></a>result_string <span class="op">=</span> []</span>
<span id="cb26-9"><a href="cluster-selection-in-urban-areas.html#cb26-9" tabindex="-1"></a>result_string.append(<span class="st">&#39;</span><span class="ch">\n\n</span><span class="st">RESULT SUMMARY&#39;</span>)</span>
<span id="cb26-10"><a href="cluster-selection-in-urban-areas.html#cb26-10" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;State Name: </span><span class="sc">{</span>df<span class="sc">.</span>iloc[<span class="dv">0</span>, <span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-11"><a href="cluster-selection-in-urban-areas.html#cb26-11" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;State Code: </span><span class="sc">{</span>df<span class="sc">.</span>iloc[<span class="dv">0</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-12"><a href="cluster-selection-in-urban-areas.html#cb26-12" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;District Codes: </span><span class="sc">{</span><span class="st">&quot; &quot;</span><span class="sc">.</span>join(D_Code_list)<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-13"><a href="cluster-selection-in-urban-areas.html#cb26-13" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Total Clusters Requested: </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-14"><a href="cluster-selection-in-urban-areas.html#cb26-14" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Total Clusters Allocated: </span><span class="sc">{</span>total_allocated<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-15"><a href="cluster-selection-in-urban-areas.html#cb26-15" tabindex="-1"></a>result_string.append(<span class="ss">f&#39;Exclusion Applied: </span><span class="sc">{</span><span class="st">&quot;Yes&quot;</span> <span class="cf">if</span> Excluder <span class="cf">else</span> <span class="st">&quot;No&quot;</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb26-16"><a href="cluster-selection-in-urban-areas.html#cb26-16" tabindex="-1"></a>result_string.append(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;-&#39;</span><span class="op">*</span><span class="dv">55</span>)</span>
<span id="cb26-17"><a href="cluster-selection-in-urban-areas.html#cb26-17" tabindex="-1"></a>result_string.append(result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-18"><a href="cluster-selection-in-urban-areas.html#cb26-18" tabindex="-1"></a></span>
<span id="cb26-19"><a href="cluster-selection-in-urban-areas.html#cb26-19" tabindex="-1"></a>final_result <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(result_string)</span>
<span id="cb26-20"><a href="cluster-selection-in-urban-areas.html#cb26-20" tabindex="-1"></a><span class="bu">print</span>(final_result)</span>
<span id="cb26-21"><a href="cluster-selection-in-urban-areas.html#cb26-21" tabindex="-1"></a></span>
<span id="cb26-22"><a href="cluster-selection-in-urban-areas.html#cb26-22" tabindex="-1"></a><span class="co"># Get number of sample iterations from user</span></span>
<span id="cb26-23"><a href="cluster-selection-in-urban-areas.html#cb26-23" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Enter number of sample iterations to generate (usually 1): &quot;</span>) <span class="kw">or</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb26-24"><a href="cluster-selection-in-urban-areas.html#cb26-24" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üîÑ Will generate </span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss"> independent sample(s)&quot;</span>)</span></code></pre></div>
</details>
</div>
<div id="random-cluster-sampling-implementation" class="section level2 hasAnchor">
<h2><strong>Random Cluster Sampling Implementation</strong><a href="cluster-selection-in-urban-areas.html#random-cluster-sampling-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is the core sampling execution step that implements probability-based cluster selection:</p>
<p><strong>Two-Stage Sampling Process:</strong></p>
<p><strong>Stage 1: IV Unit Selection</strong> - Random selection of IV Units from each district - Uses allocated cluster counts from Step 4 - Implements replacement logic when needed</p>
<p><strong>Stage 2: Block Selection</strong><br />
- Within selected IV Units, randomly samples UFS blocks - Ensures actual sample size matches allocation</p>
<p><strong>Sampling Features:</strong> - <strong>Without Replacement</strong>: Preferred method when sufficient IV Units available - <strong>With Replacement</strong>: Used when target clusters exceed available IV Units - <strong>Proportional Allocation</strong>: Maintains district-level representativeness - <strong>Frequency Tracking</strong>: Documents how often each IV Unit is selected</p>
<p><strong>Output:</strong> Dictionary of selected clusters organized by district, ready for geocoding and reporting.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="cluster-selection-in-urban-areas.html#cb27-1" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb27-2"><a href="cluster-selection-in-urban-areas.html#cb27-2" tabindex="-1"></a><span class="co"># STEP 6: CLUSTER SAMPLING AND REPORT GENERATION</span></span>
<span id="cb27-3"><a href="cluster-selection-in-urban-areas.html#cb27-3" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb27-4"><a href="cluster-selection-in-urban-areas.html#cb27-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb27-5"><a href="cluster-selection-in-urban-areas.html#cb27-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;STEP 6: CLUSTER SAMPLING AND REPORT GENERATION&quot;</span>)</span>
<span id="cb27-6"><a href="cluster-selection-in-urban-areas.html#cb27-6" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb27-7"><a href="cluster-selection-in-urban-areas.html#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="cluster-selection-in-urban-areas.html#cb27-8" tabindex="-1"></a><span class="cf">for</span> z <span class="kw">in</span> <span class="bu">range</span>(multiplier):</span>
<span id="cb27-9"><a href="cluster-selection-in-urban-areas.html#cb27-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÑ Processing iteration </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-10"><a href="cluster-selection-in-urban-areas.html#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="cluster-selection-in-urban-areas.html#cb27-11" tabindex="-1"></a>    selected_clusters <span class="op">=</span> {}</span>
<span id="cb27-12"><a href="cluster-selection-in-urban-areas.html#cb27-12" tabindex="-1"></a></span>
<span id="cb27-13"><a href="cluster-selection-in-urban-areas.html#cb27-13" tabindex="-1"></a>    <span class="co"># Sample clusters for each district</span></span>
<span id="cb27-14"><a href="cluster-selection-in-urban-areas.html#cb27-14" tabindex="-1"></a>    <span class="cf">for</span> district_code, row <span class="kw">in</span> unique_iv_unit_counts.iterrows():</span>
<span id="cb27-15"><a href="cluster-selection-in-urban-areas.html#cb27-15" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìç Sampling for District: </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-16"><a href="cluster-selection-in-urban-areas.html#cb27-16" tabindex="-1"></a></span>
<span id="cb27-17"><a href="cluster-selection-in-urban-areas.html#cb27-17" tabindex="-1"></a>        num_clusters_for_district <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">&#39;No_of_Cluster&#39;</span>])</span>
<span id="cb27-18"><a href="cluster-selection-in-urban-areas.html#cb27-18" tabindex="-1"></a>        num_iv_units <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">&#39;IV_Unit_No&#39;</span>])</span>
<span id="cb27-19"><a href="cluster-selection-in-urban-areas.html#cb27-19" tabindex="-1"></a></span>
<span id="cb27-20"><a href="cluster-selection-in-urban-areas.html#cb27-20" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üéØ Target clusters: </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-21"><a href="cluster-selection-in-urban-areas.html#cb27-21" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üìä Available IV units: </span><span class="sc">{</span>num_iv_units<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-22"><a href="cluster-selection-in-urban-areas.html#cb27-22" tabindex="-1"></a></span>
<span id="cb27-23"><a href="cluster-selection-in-urban-areas.html#cb27-23" tabindex="-1"></a>        <span class="co"># Get data for this district</span></span>
<span id="cb27-24"><a href="cluster-selection-in-urban-areas.html#cb27-24" tabindex="-1"></a>        district_df <span class="op">=</span> filtered_df1[filtered_df1[<span class="st">&#39;D_Code&#39;</span>] <span class="op">==</span> district_code]</span>
<span id="cb27-25"><a href="cluster-selection-in-urban-areas.html#cb27-25" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üìä District data rows: </span><span class="sc">{</span><span class="bu">len</span>(district_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-26"><a href="cluster-selection-in-urban-areas.html#cb27-26" tabindex="-1"></a></span>
<span id="cb27-27"><a href="cluster-selection-in-urban-areas.html#cb27-27" tabindex="-1"></a>        <span class="co"># Get unique IV units in this district</span></span>
<span id="cb27-28"><a href="cluster-selection-in-urban-areas.html#cb27-28" tabindex="-1"></a>        unique_df <span class="op">=</span> district_df.drop_duplicates(subset<span class="op">=</span>[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>])[[<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]]</span>
<span id="cb27-29"><a href="cluster-selection-in-urban-areas.html#cb27-29" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üìä Unique IV units available: </span><span class="sc">{</span><span class="bu">len</span>(unique_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-30"><a href="cluster-selection-in-urban-areas.html#cb27-30" tabindex="-1"></a></span>
<span id="cb27-31"><a href="cluster-selection-in-urban-areas.html#cb27-31" tabindex="-1"></a>        <span class="co"># Sample IV units (with or without replacement)</span></span>
<span id="cb27-32"><a href="cluster-selection-in-urban-areas.html#cb27-32" tabindex="-1"></a>        <span class="cf">if</span> num_iv_units <span class="op">&gt;=</span> num_clusters_for_district:</span>
<span id="cb27-33"><a href="cluster-selection-in-urban-areas.html#cb27-33" tabindex="-1"></a>            sampled_df <span class="op">=</span> unique_df.sample(n<span class="op">=</span>num_clusters_for_district, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-34"><a href="cluster-selection-in-urban-areas.html#cb27-34" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   ‚úÖ Sampled </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss"> IV units without replacement&quot;</span>)</span>
<span id="cb27-35"><a href="cluster-selection-in-urban-areas.html#cb27-35" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb27-36"><a href="cluster-selection-in-urban-areas.html#cb27-36" tabindex="-1"></a>            sampled_df <span class="op">=</span> pd.concat([</span>
<span id="cb27-37"><a href="cluster-selection-in-urban-areas.html#cb27-37" tabindex="-1"></a>                unique_df.sample(n<span class="op">=</span>unique_df.shape[<span class="dv">0</span>], replace<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb27-38"><a href="cluster-selection-in-urban-areas.html#cb27-38" tabindex="-1"></a>                unique_df.sample(n<span class="op">=</span>num_clusters_for_district <span class="op">-</span> unique_df.shape[<span class="dv">0</span>], replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-39"><a href="cluster-selection-in-urban-areas.html#cb27-39" tabindex="-1"></a>            ])</span>
<span id="cb27-40"><a href="cluster-selection-in-urban-areas.html#cb27-40" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   ‚ö†Ô∏è  Sampled with replacement (needed </span><span class="sc">{</span>num_clusters_for_district<span class="sc">}</span><span class="ss">, had </span><span class="sc">{</span>num_iv_units<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb27-41"><a href="cluster-selection-in-urban-areas.html#cb27-41" tabindex="-1"></a></span>
<span id="cb27-42"><a href="cluster-selection-in-urban-areas.html#cb27-42" tabindex="-1"></a>        <span class="co"># Count frequency of selected IV units</span></span>
<span id="cb27-43"><a href="cluster-selection-in-urban-areas.html#cb27-43" tabindex="-1"></a>        frequency_df <span class="op">=</span> sampled_df.groupby([<span class="st">&#39;T_Code&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb27-44"><a href="cluster-selection-in-urban-areas.html#cb27-44" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üìä IV unit frequency distribution:&quot;</span>)</span>
<span id="cb27-45"><a href="cluster-selection-in-urban-areas.html#cb27-45" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;      </span><span class="sc">{</span>frequency_df<span class="sc">.</span>to_string(index<span class="op">=</span><span class="va">False</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-46"><a href="cluster-selection-in-urban-areas.html#cb27-46" tabindex="-1"></a></span>
<span id="cb27-47"><a href="cluster-selection-in-urban-areas.html#cb27-47" tabindex="-1"></a>        <span class="co"># Sample UFS blocks from selected IV units</span></span>
<span id="cb27-48"><a href="cluster-selection-in-urban-areas.html#cb27-48" tabindex="-1"></a>        UFS_samples <span class="op">=</span> []</span>
<span id="cb27-49"><a href="cluster-selection-in-urban-areas.html#cb27-49" tabindex="-1"></a>        <span class="cf">for</span> _, row2 <span class="kw">in</span> frequency_df.iterrows():</span>
<span id="cb27-50"><a href="cluster-selection-in-urban-areas.html#cb27-50" tabindex="-1"></a>            t_code <span class="op">=</span> row2[<span class="st">&#39;T_Code&#39;</span>]</span>
<span id="cb27-51"><a href="cluster-selection-in-urban-areas.html#cb27-51" tabindex="-1"></a>            iv_unit_no <span class="op">=</span> row2[<span class="st">&#39;IV_Unit_No&#39;</span>]</span>
<span id="cb27-52"><a href="cluster-selection-in-urban-areas.html#cb27-52" tabindex="-1"></a>            freq <span class="op">=</span> row2[<span class="st">&#39;Frequency&#39;</span>]</span>
<span id="cb27-53"><a href="cluster-selection-in-urban-areas.html#cb27-53" tabindex="-1"></a></span>
<span id="cb27-54"><a href="cluster-selection-in-urban-areas.html#cb27-54" tabindex="-1"></a>            <span class="co"># Get all blocks for this IV unit</span></span>
<span id="cb27-55"><a href="cluster-selection-in-urban-areas.html#cb27-55" tabindex="-1"></a>            available_blocks <span class="op">=</span> district_df[(district_df[<span class="st">&#39;T_Code&#39;</span>] <span class="op">==</span> t_code) <span class="op">&amp;</span> (district_df[<span class="st">&#39;IV_Unit_No&#39;</span>] <span class="op">==</span> iv_unit_no)]</span>
<span id="cb27-56"><a href="cluster-selection-in-urban-areas.html#cb27-56" tabindex="-1"></a>            N <span class="op">=</span> available_blocks.shape[<span class="dv">0</span>]</span>
<span id="cb27-57"><a href="cluster-selection-in-urban-areas.html#cb27-57" tabindex="-1"></a></span>
<span id="cb27-58"><a href="cluster-selection-in-urban-areas.html#cb27-58" tabindex="-1"></a>            <span class="co"># Sample blocks (cannot sample more than available)</span></span>
<span id="cb27-59"><a href="cluster-selection-in-urban-areas.html#cb27-59" tabindex="-1"></a>            <span class="cf">if</span> N <span class="op">&lt;</span> freq:</span>
<span id="cb27-60"><a href="cluster-selection-in-urban-areas.html#cb27-60" tabindex="-1"></a>                UFS_sample <span class="op">=</span> available_blocks.sample(n<span class="op">=</span>N, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-61"><a href="cluster-selection-in-urban-areas.html#cb27-61" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   ‚ö†Ô∏è  Town </span><span class="sc">{</span>t_code<span class="sc">}</span><span class="ss">, IV </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ss">: sampled </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> blocks (needed </span><span class="sc">{</span>freq<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb27-62"><a href="cluster-selection-in-urban-areas.html#cb27-62" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb27-63"><a href="cluster-selection-in-urban-areas.html#cb27-63" tabindex="-1"></a>                UFS_sample <span class="op">=</span> available_blocks.sample(n<span class="op">=</span>freq, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-64"><a href="cluster-selection-in-urban-areas.html#cb27-64" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   ‚úÖ Town </span><span class="sc">{</span>t_code<span class="sc">}</span><span class="ss">, IV </span><span class="sc">{</span>iv_unit_no<span class="sc">}</span><span class="ss">: sampled </span><span class="sc">{</span>freq<span class="sc">}</span><span class="ss"> blocks from </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> available&quot;</span>)</span>
<span id="cb27-65"><a href="cluster-selection-in-urban-areas.html#cb27-65" tabindex="-1"></a></span>
<span id="cb27-66"><a href="cluster-selection-in-urban-areas.html#cb27-66" tabindex="-1"></a>            UFS_samples.append(UFS_sample)</span>
<span id="cb27-67"><a href="cluster-selection-in-urban-areas.html#cb27-67" tabindex="-1"></a></span>
<span id="cb27-68"><a href="cluster-selection-in-urban-areas.html#cb27-68" tabindex="-1"></a>        <span class="co"># Combine all samples for this district</span></span>
<span id="cb27-69"><a href="cluster-selection-in-urban-areas.html#cb27-69" tabindex="-1"></a>        selected_clusters[district_code] <span class="op">=</span> pd.concat(UFS_samples, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-70"><a href="cluster-selection-in-urban-areas.html#cb27-70" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   üìä Total selected blocks for district: </span><span class="sc">{</span><span class="bu">len</span>(selected_clusters[district_code])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-71"><a href="cluster-selection-in-urban-areas.html#cb27-71" tabindex="-1"></a>        </span>
<span id="cb27-72"><a href="cluster-selection-in-urban-areas.html#cb27-72" tabindex="-1"></a>    <span class="co"># Show summary of this iteration</span></span>
<span id="cb27-73"><a href="cluster-selection-in-urban-areas.html#cb27-73" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">‚úÖ ITERATION </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> SAMPLING COMPLETE&quot;</span>)</span>
<span id="cb27-74"><a href="cluster-selection-in-urban-areas.html#cb27-74" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;üìä Summary of selected clusters:&quot;</span>)</span>
<span id="cb27-75"><a href="cluster-selection-in-urban-areas.html#cb27-75" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb27-76"><a href="cluster-selection-in-urban-areas.html#cb27-76" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(df_dist)<span class="sc">}</span><span class="ss"> clusters selected&quot;</span>)</span></code></pre></div>
</details>
<p>üîÑ Sampling Iteration Results</p>
<p><strong>Number of iterations:</strong> 1</p>
<hr />
<p>üìç <strong>District 01 ‚Äî North Goa</strong></p>
<ul>
<li>üéØ <strong>Target clusters:</strong> 58<br />
</li>
<li>üìä <strong>Available IV units:</strong> 14<br />
</li>
<li>üìä <strong>District data rows:</strong> 370<br />
</li>
<li>üìä <strong>Unique IV units available:</strong> 14<br />
</li>
<li>‚ö†Ô∏è Sampled <strong>with replacement</strong> (needed 58, had 14)</li>
</ul>
<p>üìä <strong>IV Unit Frequency Distribution (Result of SRS)</strong></p>
<table>
<thead>
<tr class="header">
<th>T_Code</th>
<th>IV_Unit_No</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>003</td>
<td>0001</td>
<td>1</td>
</tr>
<tr class="even">
<td>004</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>005</td>
<td>0001</td>
<td>2</td>
</tr>
<tr class="even">
<td>006</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>014</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="odd">
<td>016</td>
<td>0004</td>
<td>5</td>
</tr>
<tr class="even">
<td>018</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="odd">
<td>020</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>036</td>
<td>0001</td>
<td>2</td>
</tr>
<tr class="odd">
<td>037</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="even">
<td>041</td>
<td>0001</td>
<td>8</td>
</tr>
<tr class="odd">
<td>043</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="even">
<td>047</td>
<td>0001</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>‚úÖ <strong>Block Sampling Summary</strong><br />
- Town 003, IV 0001 ‚Üí 1 / 20 blocks<br />
- Town 004, IV 0001 ‚Üí 3 / 23 blocks<br />
- Town 005, IV 0001 ‚Üí 2 / 28 blocks<br />
- Town 006, IV 0001 ‚Üí 7 / 20 blocks<br />
- Town 009, IV 0001 ‚Üí 5 / 23 blocks<br />
- Town 014, IV 0001 ‚Üí 4 / 31 blocks<br />
- Town 016, IV 0004 ‚Üí 5 / 32 blocks<br />
- Town 018, IV 0001 ‚Üí 7 / 39 blocks<br />
- Town 020, IV 0001 ‚Üí 5 / 29 blocks<br />
- Town 036, IV 0001 ‚Üí 2 / 30 blocks<br />
- Town 037, IV 0001 ‚Üí 3 / 21 blocks<br />
- Town 041, IV 0001 ‚Üí 8 / 29 blocks<br />
- Town 043, IV 0001 ‚Üí 4 / 25 blocks<br />
- Town 047, IV 0001 ‚Üí 2 / 20 blocks</p>
<p>üìä <strong>Total selected blocks:</strong> 58</p>
<hr />
<p>üìç <strong>District 02 ‚Äî South Goa</strong></p>
<ul>
<li>üéØ <strong>Target clusters:</strong> 74<br />
</li>
<li>üìä <strong>Available IV units:</strong> 18<br />
</li>
<li>üìä <strong>District data rows:</strong> 520<br />
</li>
<li>üìä <strong>Unique IV units available:</strong> 18<br />
</li>
<li>‚ö†Ô∏è Sampled <strong>with replacement</strong> (needed 74, had 18)</li>
</ul>
<p>üìä <strong>IV Unit Frequency Distribution (Result of SRS)</strong></p>
<table>
<thead>
<tr class="header">
<th>T_Code</th>
<th>IV_Unit_No</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>003</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="even">
<td>004</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="odd">
<td>006</td>
<td>0001</td>
<td>7</td>
</tr>
<tr class="even">
<td>007</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>008</td>
<td>0001</td>
<td>4</td>
</tr>
<tr class="even">
<td>009</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0003</td>
<td>6</td>
</tr>
<tr class="even">
<td>009</td>
<td>0004</td>
<td>4</td>
</tr>
<tr class="odd">
<td>009</td>
<td>0005</td>
<td>2</td>
</tr>
<tr class="even">
<td>009</td>
<td>0006</td>
<td>4</td>
</tr>
<tr class="odd">
<td>010</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>010</td>
<td>0003</td>
<td>5</td>
</tr>
<tr class="odd">
<td>010</td>
<td>0004</td>
<td>7</td>
</tr>
<tr class="even">
<td>010</td>
<td>0005</td>
<td>1</td>
</tr>
<tr class="odd">
<td>012</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>013</td>
<td>0001</td>
<td>3</td>
</tr>
<tr class="odd">
<td>019</td>
<td>0001</td>
<td>5</td>
</tr>
<tr class="even">
<td>021</td>
<td>0001</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>‚úÖ <strong>Block Sampling Summary</strong><br />
- Town 003, IV 0001 ‚Üí 3 / 23 blocks<br />
- Town 004, IV 0001 ‚Üí 4 / 21 blocks<br />
- Town 006, IV 0001 ‚Üí 7 / 25 blocks<br />
- Town 007, IV 0001 ‚Üí 3 / 31 blocks<br />
- Town 008, IV 0001 ‚Üí 4 / 24 blocks<br />
- Town 009, IV 0001 ‚Üí 3 / 32 blocks<br />
- Town 009, IV 0003 ‚Üí 6 / 25 blocks<br />
- Town 009, IV 0004 ‚Üí 4 / 46 blocks<br />
- Town 009, IV 0005 ‚Üí 2 / 29 blocks<br />
- Town 009, IV 0006 ‚Üí 4 / 33 blocks<br />
- Town 010, IV 0001 ‚Üí 5 / 32 blocks<br />
- Town 010, IV 0003 ‚Üí 5 / 24 blocks<br />
- Town 010, IV 0004 ‚Üí 7 / 38 blocks<br />
- Town 010, IV 0005 ‚Üí 1 / 32 blocks<br />
- Town 012, IV 0001 ‚Üí 5 / 22 blocks<br />
- Town 013, IV 0001 ‚Üí 3 / 30 blocks<br />
- Town 019, IV 0001 ‚Üí 5 / 29 blocks<br />
- Town 021, IV 0001 ‚Üí 3 / 24 blocks</p>
<p>üìä <strong>Total selected blocks:</strong> 74</p>
</div>
<div id="geographic-coordinate-assignment-geocoding" class="section level2 hasAnchor">
<h2><strong>Geographic Coordinate Assignment (Geocoding)</strong><a href="cluster-selection-in-urban-areas.html#geographic-coordinate-assignment-geocoding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This step adds spatial coordinates to enable mapping and geographic analysis:</p>
<p><strong>Geocoding Process:</strong></p>
<p>1. <strong>Location Query</strong>: Constructs queries using ‚ÄúTown, District, State‚Äù format</p>
<p>2. <strong>Service Provider</strong>: Uses ArcGIS geocoding service via geopy library</p>
<p>3. <strong>Coordinate Extraction</strong>: Retrieves latitude and longitude for each location</p>
<p>4. <strong>Error Handling</strong>: Manages failed geocoding attempts gracefully</p>
<p><strong>Data Enhancement:</strong> - <strong>Spatial Coordinates</strong>: Adds <code>Latitude</code> and <code>Longitude</code> columns - <strong>Quality Reporting</strong>: Tracks successful vs.¬†failed geocoding attempts - <strong>Coverage Analysis</strong>: Reports geocoding success rates by district</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="cluster-selection-in-urban-areas.html#cb28-1" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb28-2"><a href="cluster-selection-in-urban-areas.html#cb28-2" tabindex="-1"></a>    <span class="co"># STEP 7: GEOCODING</span></span>
<span id="cb28-3"><a href="cluster-selection-in-urban-areas.html#cb28-3" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb28-4"><a href="cluster-selection-in-urban-areas.html#cb28-4" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üåç STEP 7: GEOCODING SELECTED LOCATIONS&quot;</span>)</span>
<span id="cb28-5"><a href="cluster-selection-in-urban-areas.html#cb28-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb28-6"><a href="cluster-selection-in-urban-areas.html#cb28-6" tabindex="-1"></a></span>
<span id="cb28-7"><a href="cluster-selection-in-urban-areas.html#cb28-7" tabindex="-1"></a>    locator <span class="op">=</span> geopy.geocoders.ArcGIS(user_agent<span class="op">=</span><span class="st">&quot;mygeocoder&quot;</span>)</span>
<span id="cb28-8"><a href="cluster-selection-in-urban-areas.html#cb28-8" tabindex="-1"></a></span>
<span id="cb28-9"><a href="cluster-selection-in-urban-areas.html#cb28-9" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb28-10"><a href="cluster-selection-in-urban-areas.html#cb28-10" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df_dist.empty:</span>
<span id="cb28-11"><a href="cluster-selection-in-urban-areas.html#cb28-11" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìç Geocoding for District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb28-12"><a href="cluster-selection-in-urban-areas.html#cb28-12" tabindex="-1"></a></span>
<span id="cb28-13"><a href="cluster-selection-in-urban-areas.html#cb28-13" tabindex="-1"></a>            <span class="cf">for</span> index, row <span class="kw">in</span> df_dist.iterrows():</span>
<span id="cb28-14"><a href="cluster-selection-in-urban-areas.html#cb28-14" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb28-15"><a href="cluster-selection-in-urban-areas.html#cb28-15" tabindex="-1"></a>                    <span class="co"># Create location query using town, district, and state</span></span>
<span id="cb28-16"><a href="cluster-selection-in-urban-areas.html#cb28-16" tabindex="-1"></a>                    location_query <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>row[<span class="st">&#39;District&#39;</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb28-17"><a href="cluster-selection-in-urban-areas.html#cb28-17" tabindex="-1"></a>                    location <span class="op">=</span> locator.geocode(location_query)</span>
<span id="cb28-18"><a href="cluster-selection-in-urban-areas.html#cb28-18" tabindex="-1"></a></span>
<span id="cb28-19"><a href="cluster-selection-in-urban-areas.html#cb28-19" tabindex="-1"></a>                    <span class="cf">if</span> location:</span>
<span id="cb28-20"><a href="cluster-selection-in-urban-areas.html#cb28-20" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> location.latitude</span>
<span id="cb28-21"><a href="cluster-selection-in-urban-areas.html#cb28-21" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> location.longitude</span>
<span id="cb28-22"><a href="cluster-selection-in-urban-areas.html#cb28-22" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;   ‚úÖ </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: (</span><span class="sc">{</span>location<span class="sc">.</span>latitude<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>location<span class="sc">.</span>longitude<span class="sc">:.4f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb28-23"><a href="cluster-selection-in-urban-areas.html#cb28-23" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb28-24"><a href="cluster-selection-in-urban-areas.html#cb28-24" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-25"><a href="cluster-selection-in-urban-areas.html#cb28-25" tabindex="-1"></a>                        df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-26"><a href="cluster-selection-in-urban-areas.html#cb28-26" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;   ‚ùå </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: Location not found&quot;</span>)</span>
<span id="cb28-27"><a href="cluster-selection-in-urban-areas.html#cb28-27" tabindex="-1"></a></span>
<span id="cb28-28"><a href="cluster-selection-in-urban-areas.html#cb28-28" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb28-29"><a href="cluster-selection-in-urban-areas.html#cb28-29" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;   ‚ùå Error geocoding </span><span class="sc">{</span>row[<span class="st">&#39;Town&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb28-30"><a href="cluster-selection-in-urban-areas.html#cb28-30" tabindex="-1"></a>                    df_dist.loc[index, <span class="st">&#39;Latitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-31"><a href="cluster-selection-in-urban-areas.html#cb28-31" tabindex="-1"></a>                    df_dist.loc[index, <span class="st">&#39;Longitude&#39;</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-32"><a href="cluster-selection-in-urban-areas.html#cb28-32" tabindex="-1"></a>                    </span>
<span id="cb28-33"><a href="cluster-selection-in-urban-areas.html#cb28-33" tabindex="-1"></a>            <span class="co"># Show geocoding summary for this district</span></span>
<span id="cb28-34"><a href="cluster-selection-in-urban-areas.html#cb28-34" tabindex="-1"></a>            geocoded_count <span class="op">=</span> df_dist[<span class="st">&#39;Latitude&#39;</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb28-35"><a href="cluster-selection-in-urban-areas.html#cb28-35" tabindex="-1"></a>            total_count <span class="op">=</span> <span class="bu">len</span>(df_dist)</span>
<span id="cb28-36"><a href="cluster-selection-in-urban-areas.html#cb28-36" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   üìä Geocoded </span><span class="sc">{</span>geocoded_count<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total_count<span class="sc">}</span><span class="ss"> locations (</span><span class="sc">{</span>geocoded_count<span class="op">/</span>total_count<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span></code></pre></div>
</details>
</div>
<div id="output-generation-and-final-documentation" class="section level2 hasAnchor">
<h2><strong>Output Generation and Final Documentation</strong><a href="cluster-selection-in-urban-areas.html#output-generation-and-final-documentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This final step generates comprehensive outputs and provides project completion summary:</p>
<p><strong>Output Files Generated:</strong></p>
<p>1. <strong>Excel Reports</strong>: Multi-sheet workbooks with one sheet per district - Contains all selected cluster details - Includes geographic coordinates - Formatted for field use</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Directory Structure</strong>: Creates organized folder system
<ul>
<li><code>map/</code>: Reserved for mapping outputs</li>
<li><code>temp/</code>: Temporary processing files</li>
<li><code>GIS/</code>: Geospatial data files</li>
</ul></li>
</ol>
<p><strong>Quality Assurance:</strong> - <strong>Sample Verification</strong>: Displays sample of selected clusters - <strong>Count Validation</strong>: Verifies cluster counts match allocation - <strong>Coordinate Check</strong>: Shows geocoding success rates</p>
<p><strong>Final Summary:</strong> - <strong>Iteration Tracking</strong>: Documents number of independent samples generated - <strong>File Naming</strong>: Uses standardized naming convention with state identifiers - <strong>Performance Metrics</strong>: Reports total clusters and processing statistics</p>
<p><strong>Deliverables:</strong> Ready-to-use cluster sampling results for urban survey implementation, complete with coordinates and detailed documentation for field teams.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="cluster-selection-in-urban-areas.html#cb29-1" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb29-2"><a href="cluster-selection-in-urban-areas.html#cb29-2" tabindex="-1"></a>    <span class="co"># STEP 8: GENERATE OUTPUT FILES</span></span>
<span id="cb29-3"><a href="cluster-selection-in-urban-areas.html#cb29-3" tabindex="-1"></a>    <span class="co"># =============================================================================</span></span>
<span id="cb29-4"><a href="cluster-selection-in-urban-areas.html#cb29-4" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üìÑ STEP 8: GENERATING OUTPUT FILES&quot;</span>)</span>
<span id="cb29-5"><a href="cluster-selection-in-urban-areas.html#cb29-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb29-6"><a href="cluster-selection-in-urban-areas.html#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="cluster-selection-in-urban-areas.html#cb29-7" tabindex="-1"></a>    <span class="co"># Generate Excel output</span></span>
<span id="cb29-8"><a href="cluster-selection-in-urban-areas.html#cb29-8" tabindex="-1"></a>    excel_filename <span class="op">=</span> <span class="ss">f&quot;Urban Report[EXCEL-</span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">]-</span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">.xlsx&quot;</span></span>
<span id="cb29-9"><a href="cluster-selection-in-urban-areas.html#cb29-9" tabindex="-1"></a>    extract_clusters_to_excel(selected_clusters, output_file<span class="op">=</span>excel_filename)</span>
<span id="cb29-10"><a href="cluster-selection-in-urban-areas.html#cb29-10" tabindex="-1"></a></span>
<span id="cb29-11"><a href="cluster-selection-in-urban-areas.html#cb29-11" tabindex="-1"></a>    <span class="co"># Create directories if they don&#39;t exist</span></span>
<span id="cb29-12"><a href="cluster-selection-in-urban-areas.html#cb29-12" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;map&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-13"><a href="cluster-selection-in-urban-areas.html#cb29-13" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;temp&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-14"><a href="cluster-selection-in-urban-areas.html#cb29-14" tabindex="-1"></a>    os.makedirs(<span class="st">&quot;GIS&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-15"><a href="cluster-selection-in-urban-areas.html#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="cluster-selection-in-urban-areas.html#cb29-16" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">‚úÖ PROCESSING COMPLETE FOR ITERATION </span><span class="sc">{</span>z<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-17"><a href="cluster-selection-in-urban-areas.html#cb29-17" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;üìä Summary of selected clusters:&quot;</span>)</span>
<span id="cb29-18"><a href="cluster-selection-in-urban-areas.html#cb29-18" tabindex="-1"></a>    <span class="cf">for</span> district_code, df_dist <span class="kw">in</span> selected_clusters.items():</span>
<span id="cb29-19"><a href="cluster-selection-in-urban-areas.html#cb29-19" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   District </span><span class="sc">{</span>district_code<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(df_dist)<span class="sc">}</span><span class="ss"> clusters selected&quot;</span>)</span>
<span id="cb29-20"><a href="cluster-selection-in-urban-areas.html#cb29-20" tabindex="-1"></a></span>
<span id="cb29-21"><a href="cluster-selection-in-urban-areas.html#cb29-21" tabindex="-1"></a>    <span class="co"># Display first few selected clusters for verification</span></span>
<span id="cb29-22"><a href="cluster-selection-in-urban-areas.html#cb29-22" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîç Sample of selected clusters:&quot;</span>)</span>
<span id="cb29-23"><a href="cluster-selection-in-urban-areas.html#cb29-23" tabindex="-1"></a>    sample_df <span class="op">=</span> pd.concat(selected_clusters.values()).head(<span class="dv">10</span>)</span>
<span id="cb29-24"><a href="cluster-selection-in-urban-areas.html#cb29-24" tabindex="-1"></a>    <span class="bu">print</span>(sample_df[[<span class="st">&#39;District&#39;</span>, <span class="st">&#39;Town&#39;</span>, <span class="st">&#39;IV_Unit_No&#39;</span>, <span class="st">&#39;Block_No&#39;</span>, <span class="st">&#39;Latitude&#39;</span>, <span class="st">&#39;Longitude&#39;</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb29-25"><a href="cluster-selection-in-urban-areas.html#cb29-25" tabindex="-1"></a></span>
<span id="cb29-26"><a href="cluster-selection-in-urban-areas.html#cb29-26" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ ALL ITERATIONS COMPLETED!&quot;</span>)</span>
<span id="cb29-27"><a href="cluster-selection-in-urban-areas.html#cb29-27" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìÅ Output files generated with prefix: Urban Report[EXCEL]-</span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>state_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-28"><a href="cluster-selection-in-urban-areas.html#cb29-28" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìä Total sample iterations: </span><span class="sc">{</span>multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-29"><a href="cluster-selection-in-urban-areas.html#cb29-29" tabindex="-1"></a></span>
<span id="cb29-30"><a href="cluster-selection-in-urban-areas.html#cb29-30" tabindex="-1"></a><span class="co"># Final summary</span></span>
<span id="cb29-31"><a href="cluster-selection-in-urban-areas.html#cb29-31" tabindex="-1"></a>total_clusters_generated <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">len</span>(df_dist) <span class="cf">for</span> df_dist <span class="kw">in</span> selected_clusters.values())</span>
<span id="cb29-32"><a href="cluster-selection-in-urban-areas.html#cb29-32" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìà Clusters per iteration: ~</span><span class="sc">{</span>total_clusters_generated<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-33"><a href="cluster-selection-in-urban-areas.html#cb29-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;üìà Total clusters across all iterations: ~</span><span class="sc">{</span>total_clusters_generated <span class="op">*</span> multiplier<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</details>
<div style="text-align: center;">
<iframe src="Urban Report[PDF-1]-Goa_30.pdf" width="100%" height="400px">
</iframe>
<iframe src="figure.html" width="100%" height="400px frameborder="0"></iframe>

</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cluster-selection-in-rural-areas.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
